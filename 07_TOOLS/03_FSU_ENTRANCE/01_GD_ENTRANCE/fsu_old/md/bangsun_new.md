# 邦讯门禁控制器协议解析文档
## 一、协议使用说明
### （一）提供内容
公司免费提供门禁控制器的动态连接库、底层通讯协议内容及简单编程案例，暂不提供更多案例。

### （二）适用场景
仅推荐用于门禁系统和考勤系统，不建议用于其他应用场合，避免因环境干扰导致返修率提高。

### （三）服务限制
仅提供底层通讯协议、动态连接库及简单案例，不提供电话、邮件等技术支持服务，也不提供本下载外的其他语言编程案例。

### （四）功能说明
门禁控制器绝大部分功能已在开发包内描述，个别功能处于测试阶段，暂不提供。

### （五）系统要求
动态库仅支持XP以上操作系统，不支持Windows2000及以下操作系统。

## 二、开发包可实现功能
### （一）基础功能
1. 时间相关：读取时间、校准时间
2. 记录相关：提取记录、删除记录
3. 权限相关：下传权限、修改权限、删除权限、清空权限、读取权限
4. 时段相关：修改时段、读取时段
5. 门控制相关：设置门在线、常开、常闭；设置开门延时
6. 网络相关：搜索TCPIP控制器、配置IP

### （二）特色功能
远程开门、启用密码键盘、启用报警门磁事件记录、单个控制器内双门或多门互锁、首卡开门、多卡开门、胁迫密码、超级密码开门、输”*卡号*密码#”开门、定时任务、扩展板设置、控制器恢复出厂化设置（格式化）

### （三）测试案例演示功能
1. 读取控制器运行信息（时间、刷卡记录数、权限数、最近一条刷卡记录、门磁状态、按钮状态、故障信息）
2. 读取控制器IP、设置IP（仅用于.NET控制器）
3. 校准控制器时间
4. 远程开1号门
5. 提取记录、删除已提取的记录
6. 发送权限操作（先清空权限，再添加权限）
7. 发送控制时段、实时监控

## 三、接口设计（给开发商的协议）
### （一）S/N序列号与产品对应关系及卡号说明
#### 1. 485控制器（串口通信速率为9600，N，8，1）
| 序列号范围 | 产品型号 |
| ---- | ---- |
| 11000-19999 | 1001 单门双向485控制器 |
| 21000-29999 | 1002 双门双向485控制器 |
| 41000-49999 | 1004 四门单向485控制器 |

#### 2. .NET控制器（采用UDP通信方式，默认端口是60000）
| 序列号范围 | 产品型号 |
| ---- | ---- |
| 30000-39999 | 1002.NET 单门双向.NET控制器 |
| 50000-59999 | 1001.NET 双门双向.NET控制器 |
| 60000-64999 | 1004.NET 四门单向.NET控制器 |

#### 3. 卡号说明
日常中ID卡或IC卡的卡号在本协议内由区号+ID号（依据Motorola卡定义）组成。以ID卡为例，平常说卡号25409969，在协议中区号=254，ID号=09969。

#### 4. 开发建议
从”读取运行状态信息”指令开始控制器操作，开发过程中可采用格式化[10FF]指令对设备恢复出厂化设置。

### （二）基本格式
#### 1. 短时间格式
##### （1）Time（HMS）（时分秒）
| Bit Position | 0-4 | 5-A | B-F |
| ---- | ---- | ---- | ---- |
| Length（bit） | 5 | 6 | 5 |
| Contents | Hours（时） | Minutes（分） | 2-second increments（2秒） |
| Value Range | 0–23 | 0–59 | 0-29 in 2-second intervals |

参考：WComm_UDP.dll库中的MSDateHmsToWCDateHms、WCDateToMSDate

##### （2）Date（YMD）（年月日）
| Bit Position | 0-6 | 7-A | B-F |
| ---- | ---- | ---- | ---- |
| Length（bit） | 7 | 4 | 5 |
| Contents | Year（年） | Month（月） | Day（日） |
| Value Range | 0–119（relative to 2000） | 1–12 | 1–31 |

参考：WComm_UDP.dll库中的MSDateYmdToWCDateYmd、WCDateToMSDate

总共32个BITS，合4个字节。

范例：[B3 02 0D 5D]，02B3[年月日] ，5D0D[时分秒]--2001年5月19日11时40分26秒

#### 2. 记录格式
卡号（4）+ 刷卡年月日（2）+刷卡时分秒（2）+ 记录状态（1）+ 记录选项（1），总共占10个字节。

##### （1）卡号说明
1. 标准8位卡号：由区号和ID号组成（其值为8位号码），卡号（4）= ID号(2，低在前)0xF126 + 区号(1)(0xFE) + 0x00(固定对齐)
2. 非标准10位卡号：由4个字节组成，低字节前，高字节在后

##### （2）读卡器与门对应关系
1. 单门双向或双门双向控制器：1/2号读卡器对应1号门，3/4号读卡器对应2号门
2. 四门单向控制器：读卡器与控制器一一对应

##### （3）记录选项说明
| Bit位 | 说明 |
| ---- | ---- |
| Bit3 | 刷卡时分秒是2秒为单位，若要精确到秒，则改为刷卡时间秒（V80驱动以上功能） |
| Bit2 | 1表示针对V80以上驱动的记录格式，0表示小于V80驱动的记录格式 |
| Bit1 | 保留 |
| Bit0 | 1表示该记录中卡号为非标准10位卡号，0表示为标准8位卡号（V80驱动以上功能） |

（完整卡号大于100表示正常的刷卡操作记录）

##### （4）正常刷卡操作记录状态说明
| 完整卡号 | 记录状态（16进制） | 正常操作 | 代表意义 |
| ---- | ---- | ---- | ---- |
| 大于100 | 00 | 允许通过 | 1号读卡器刷卡开门 |
| 大于100 | 01 | 允许通过 | 2号读卡器刷卡开门 |
| 大于100 | 02 | 允许通过 | 3号读卡器刷卡开门 |
| 大于100 | 03 | 允许通过 | 4号读卡器刷卡开门 |
| 大于100 | 80 | 禁止通过 | (1)号读卡器刷卡禁止通过: 原因不明 |
| 大于100 | 81 | 禁止通过 | (2)号读卡器刷卡禁止通过: 原因不明 |
| 大于100 | 82 | 禁止通过 | (3)号读卡器刷卡禁止通过: 原因不明 |
| 大于100 | 83 | 禁止通过 | (4)号读卡器刷卡禁止通过: 原因不明 |
| 大于100 | 90 | 禁止通过 | (1)号读卡器刷卡禁止通过: 没有权限 |
| 大于100 | 91 | 禁止通过 | (2)号读卡器刷卡禁止通过: 没有权限 |
| 大于100 | 92 | 禁止通过 | (3)号读卡器刷卡禁止通过: 没有权限 |
| 大于100 | 93 | 禁止通过 | (4)号读卡器刷卡禁止通过: 没有权限 |
| 大于100 | A0 | 禁止通过 | (1)号读卡器刷卡禁止通过: 密码不对 |
| 大于100 | A1 | 禁止通过 | (2)号读卡器刷卡禁止通过: 密码不对 |
| 大于100 | A2 | 禁止通过 | (3)号读卡器刷卡禁止通过: 密码不对 |
| 大于100 | A3 | 禁止通过 | (4)号读卡器刷卡禁止通过: 密码不对 |
| 大于100 | B0 | 禁止通过 | (1)号读卡器刷卡禁止通过: 系统有故障 |
| 大于100 | B1 | 禁止通过 | (2)号读卡器刷卡禁止通过: 系统有故障 |
| 大于100 | B2 | 禁止通过 | (3)号读卡器刷卡禁止通过: 系统有故障 |
| 大于100 | B3 | 禁止通过 | (4)号读卡器刷卡禁止通过: 系统有故障 |
| 大于100 | C0 | 禁止通过 | (1)号读卡器刷卡禁止通过: 反潜回, 多卡开门或多门互锁 |
| 大于100 | C1 | 禁止通过 | (2)号读卡器刷卡禁止通过: 反潜回, 多卡开门或多门互锁 |
| 大于100 | C2 | 禁止通过 | (3)号读卡器刷卡禁止通过: 反潜回, 多卡开门或多门互锁 |
| 大于100 | C3 | 禁止通过 | (4)号读卡器刷卡禁止通过: 反潜回, 多卡开门或多门互锁 |
| 大于100 | C4 | 禁止通过 | (1)号读卡器刷卡禁止通过: 反潜回 |
| 大于100 | C5 | 禁止通过 | (2)号读卡器刷卡禁止通过: 反潜回 |
| 大于100 | C6 | 禁止通过 | (3)号读卡器刷卡禁止通过: 反潜回 |
| 大于100 | C7 | 禁止通过 | (4)号读卡器刷卡禁止通过: 反潜回 |
| 大于100 | C8 | 禁止通过 | (1)号读卡器刷卡禁止通过: 多卡 |
| 大于100 | C9 | 禁止通过 | (2)号读卡器刷卡禁止通过: 多卡 |
| 大于100 | CA | 禁止通过 | (3)号读卡器刷卡禁止通过: 多卡 |
| 大于100 | CB | 禁止通过 | (4)号读卡器刷卡禁止通过: 多卡 |
| 大于100 | CC | 禁止通过 | (1)号读卡器刷卡禁止通过: 首卡 |
| 大于100 | CD | 禁止通过 | (2)号读卡器刷卡禁止通过: 首卡 |
| 大于100 | CE | 禁止通过 | (3)号读卡器刷卡禁止通过: 首卡 |
| 大于100 | CF | 禁止通过 | (4)号读卡器刷卡禁止通过: 首卡 |
| 大于100 | D0 | 禁止通过 | (1)号读卡器刷卡禁止通过: 门为常闭 |
| 大于100 | D1 | 禁止通过 | (2)号读卡器刷卡禁止通过: 门为常闭 |
| 大于100 | D2 | 禁止通过 | (3)号读卡器刷卡禁止通过: 门为常闭 |
| 大于100 | D3 | 禁止通过 | (4)号读卡器刷卡禁止通过: 门为常闭 |
| 大于100 | D4 | 禁止通过 | (1)号读卡器刷卡禁止通过: 互锁 |
| 大于100 | D5 | 禁止通过 | (2)号读卡器刷卡禁止通过: 互锁 |
| 大于100 | D6 | 禁止通过 | (3)号读卡器刷卡禁止通过: 互锁 |
| 大于100 | D7 | 禁止通过 | (4)号读卡器刷卡禁止通过: 互锁 |
| 大于100 | E0 | 禁止通过 | (1)号读卡器刷卡禁止通过: 卡过期或不在有效时段 |
| 大于100 | E1 | 禁止通过 | (2)号读卡器刷卡禁止通过: 卡过期或不在有效时段 |
| 大于100 | E2 | 禁止通过 | (3)号读卡器刷卡禁止通过: 卡过期或不在有效时段 |
| 大于100 | E3 | 禁止通过 | (4)号读卡器刷卡禁止通过: 卡过期或不在有效时段 |

（完整卡号小于100表示特殊操作记录）

##### （5）特殊操作记录状态说明
| 完整卡号 | 记录状态（16进制） | 正常操作 | 代表意义 |
| ---- | ---- | ---- | ---- |
| 0 | 00 | 按钮 | 1号门按钮动作 |
| 1 | 00 | 按钮 | 2号门按钮动作 |
| 2 | 00 | 按钮 | 3号门按钮动作 |
| 3 | 00 | 按钮 | 4号门按钮动作 |
| 0 | 03 | 远程开门 | 1号门远程开门动作 |
| 1 | 03 | 远程开门 | 2号门远程开门动作 |
| 2 | 03 | 远程开门 | 3号门远程开门动作 |
| 3 | 03 | 远程开门 | 4号门远程开门动作 |
| 5 | 00 | 超级密码开门 | 1号读卡器超级密码开门 |
| 5 | 01 | 超级密码开门 | 2号读卡器超级密码开门 |
| 5 | 02 | 超级密码开门 | 3号读卡器超级密码开门 |
| 5 | 03 | 超级密码开门 | 4号读卡器超级密码开门 |
| 8 | 00 | 门打开 | 1号门打开[门磁信号] |
| 9 | 00 | 门打开 | 2号门打开[门磁信号] |
| 10 | 00 | 门打开 | 3号门打开[门磁信号] |
| 11 | 00 | 门打开 | 4号门打开[门磁信号] |
| 12 | 00 | 门关闭 | 1号门关闭[门磁信号] |
| 13 | 00 | 门关闭 | 2号门关闭[门磁信号] |
| 14 | 00 | 门关闭 | 3号门关闭[门磁信号] |
| 15 | 00 | 门关闭 | 4号门关闭[门磁信号] |
| 0 | 81 | 胁迫报警 | 1号读卡器胁迫报警 |
| 1 | 81 | 胁迫报警 | 2号读卡器胁迫报警 |
| 2 | 81 | 胁迫报警 | 3号读卡器胁迫报警 |
| 3 | 81 | 胁迫报警 | 4号读卡器胁迫报警 |
| 0 | 82 | 门长时间未关报警 | 1号门长时间未关报警 |
| 1 | 82 | 门长时间未关报警 | 2号门长时间未关报警 |
| 2 | 82 | 门长时间未关报警 | 3号门长时间未关报警 |
| 3 | 82 | 门长时间未关报警 | 4号门长时间未关报警 |
| 0 | 84 | 非法闯入报警 | 1号门非法闯入报警 |
| 1 | 84 | 非法闯入报警 | 2号门非法闯入报警 |
| 2 | 84 | 非法闯入报警 | 3号门非法闯入报警 |
| 3 | 84 | 非法闯入报警 | 4号门非法闯入报警 |
| 4 | A0 | 火警 | 火警动作[针对整个控制器] |
| 6 | A0 | 强制 | 强制锁门[针对整个控制器] |

#### 3. 权限信息
每个权限占16个字节〔预设3万个权限〕，格式为：卡号（4）+ 备用1（2）+卡截止年月日（2）+门号（1）+密码（3）+控制时段索引号（4）

##### （1）权限发送规则
必须先发１号门（门号相同的，先发卡号小的，再发卡号大的），再发２号门…

##### （2）各字段说明
1. 门号：从01开始，最大为04；
2. 卡截止年月日：按短时间格式中的年月日进行定义，默认用[9F C7] 2099年12月31日；
3. 控制时段索引号：00—禁止；01—表示在有效期内，任意时间有效；
4. 密码用3个字节：默认为123456 [等于十六进制的40E201]；
5. 备用1：=0 表示普通用户组；>0表示此权限所属的特殊群组 （适用于多卡开门用户）。

#### 4. 控制时段
分为256个组，每组占24个字节，每组格式如下：星期控制（1字节，缺省值为7F）+ 下一个链接时段(缺省为0) + 保留（2字节，用0填充）+起始时分秒1（2字节）+终止时分秒1（2字节）+起始时分秒2（2字节）+终止时分秒2（2字节）+起始时分秒3（2字节）+终止时分秒3（2字节）+起始日期(2字节)+终止日期(2字节)+保留(4字节，用0填充)

##### （1）有效索引号
值范围（0--255）[在用户权限中使用到]。第0个控制时段组始终作为禁止刷卡时段组，第1个控制时段组始终作为任意时间有效组（0，1修改值无效）。2—255用户可自行修改。

##### （2）星期控制
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 0--表示受到时段控制；1--表示任意时间有效，即不受时段控制 | 日 | 六 | 五 | 四 | 三 | 二 | 一 |

如果七天都有效，则为7F；如果只有星期一到星期五有效，则为1F。

##### （3）控制逻辑
用于核实刷卡是否处于有效时间内进行。必须先满足起始日期和截止日期控制，再满足星期控制（当日有效），再核时分秒控制；必须完全满足3个控制（日期控制，星期控制，3个时分秒控制中的任意一个）才可通过。

##### （4）下一个链接时段
用于并列时段，如果此时段号不为FF或0，则引入相应号的时段来对刷卡操作作相应权限检查。当此时段不允许通过时，可以再查并列时段。

##### （5）起始日期和终止日期
按短时间格式中的年月日进行定义，默认起始日期用[21 00]= 2000年01月01日，默认终止日期用[9F 29]= 2020年12月31日。

#### 5. 首卡开门
1. 首卡开门的实现通过定时任务来完成；
2. 在设置权限时，要对拥有首卡权限的用户进行设置，参考权限信息（备用1的值=1）；
3. 首卡使用的状态：
    - 0x00刷首卡后作按正常处理；
    - 0x11刷首卡后，门切换到常开；
    - 0x12刷首卡后，门切换到常闭；
    - 0x13刷首卡后，门切换到在线；
    - 0x14只许首卡才能开门，刷首卡后，不切换。

##### （6）操作示例
例如：对于1号门早上8:00允许首卡刷卡后，其他人才能刷卡开门；下午18:30之后，只有首卡才能开门，刷首卡后，不切换。

操作步骤：
先发送2条指令：
F410360001 [启用定时任务指令]
F3100001指令
再发送：
F510000100000600407F9B1300 [第一个任务 0040 表示8点，7F-星期全部，9B13 一号门刷首卡后，门切换到在线。9B表示一号门，如果2号门则是9C，3号门是9D，4号门是9E]
F510000106000600987F9B1400 [第二个任务 0098 表示18:30，7F-星期全部，9B14 一号门只能首卡刷卡才能开门]

#### 6. 多卡开门(含多群组)
##### （1）总体要求设置
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0xB8 | 1号读卡器同时要到人数 | 00 | 00=[无多卡要求]；大于0表示要求到的人数 |
| 0xB9 | 2号读卡器同时要到人数 | 00 | 00=[无多卡要求]；大于0表示要求到的人数 |
| 0xBA | 3号读卡器同时要到人数 | 00 | 00=[无多卡要求]；大于0表示要求到的人数 |
| 0xBB | 4号读卡器同时要到人数 | 00 | 00=[无多卡要求]；大于0表示要求到的人数 |

##### （2）群组设置
| 地址位 | 1号读卡器同时要到人数 | 地址位 | 2号读卡器同时要到人数 | 地址位 | 3号读卡器同时要到人数 | 地址位 | 4号读卡器同时要到人数 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0xBC | 群1 | 0xC4 | 群1 | 0xCC | 群1 | 0xD4 | 群1 |
| 0xBD | 群2 | 0xC5 | 群2 | 0xCD | 群2 | 0xD5 | 群2 |
| 0xBE | 群3 | 0xC6 | 群3 | 0xCE | 群3 | 0xD6 | 群3 |
| 0xBF | 群4 | 0xC7 | 群4 | 0xCF | 群4 | 0xD7 | 群4 |
| 0xC0 | 群5 | 0xC8 | 群5 | 0xD0 | 群5 | 0xD8 | 群5 |
| 0xC1 | 群6 | 0xC9 | 群6 | 0xD1 | 群6 | 0xD9 | 群6 |
| 0xC2 | 群7 | 0xCA | 群7 | 0xD2 | 群7 | 0xDA | 群7 |
| 0xC3 | 群8 | 0xCB | 群8 | 0xD3 | 群8 | 0xDB | 群8 |

缺省情况下：各个群要到的人数=0，也就是只要是合法用户刷卡就可以开门。

##### （3）设置方式
通过”参数修改指令”设置各个群要求到的人数。

##### （4）操作示例
要求1号读卡器同时要3个人刷卡，其中必须有1人是主任。

操作步骤：
1. 将主任设为1号读卡器的群1成员；
2. 在设置权限时，主任的权限备用2的值=1 [参考权限信息]；
3. 发送指令：
F410B80003 3个人同时刷卡
F410BC0001 1号读卡器的1号群必须要有1 人到场

#### 7. 扩展板设置
通过”参数修改指令”设置地址位的值。

##### （1）1号扩展口设置
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x98 | 1号扩展口的报警源或者联动源 | 1 | 默认报警源1号门 |
| 0x99 | 1号扩展口的控制位 | 0 |  |
| 0x9A | 1号扩展口的事件类型 1 | 0x27 | 默认为胁迫/门开未关闭/非法闯入/火警 |
| 0x9B | 1号扩展口的事件类型2 | 0 |  |
| 0x9C | 1号扩展口的动作延时 [低位] | 0x64 | 动作延时10秒 |
| 0x9D | 1号扩展口的动作延时 [高位]，0x9C和0x9D组成一个双字节数，单位是0.1秒 | 0x00 |  |

##### （2）2号扩展口设置
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x9E | 2号扩展口的报警源或者联动源 | 2 | 默认报警源2号门 |
| 0x9F | 2号扩展口的控制位 | 0 | 硬件驱动V16才支持 |
| 0xA0 | 2号扩展口的事件类型1 | 0x27 | 默认为胁迫/门开未关闭/非法闯入/火警 |
| 0xA1 | 2号扩展口的事件类型2 | 0 |  |
| 0xA2 | 2号扩展口的动作延时 [低位] | 0x64 | 动作延时10秒 |
| 0xA3 | 2号扩展口的动作延时 [高位]，0xA2和0xA3组成一个双字节数，单位是0.1秒 | 0x00 |  |

##### （3）3号扩展口设置
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0xA4 | 3号扩展口的报警源或者联动源 | 4 | 默认报警源3号门 |
| 0xA5 | 3号扩展口的控制位 | 0 | 硬件驱动V16才支持 |
| 0xA6 | 3号扩展口的事件类型 1 | 0x27 | 默认为胁迫/门开未关闭/非法闯入/火警 |
| 0xA7 | 3号扩展口的事件类型2 | 0 |  |
| 0xA8 | 3号扩展口的动作延时 [低位] | 0x64 | 动作延时10秒 |
| 0xA9 | 3号扩展口的动作延时 [高位]，0xA8和0xA9组成一个双字节数，单位是0.1秒 | 0x00 |  |

##### （4）4号扩展口设置
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0xAA | 4号扩展口的报警源或者联动源 | 8 | 默认报警源4号门 |
| 0xAB | 4号扩展口的控制位 | 0 | 硬件驱动V16才支持 |
| 0xAC | 4号扩展口的事件类型 1 | 0x27 | 默认为胁迫/门开未关闭/非法闯入/火警 |
| 0xAD | 4号扩展口的事件类型2 | 0 |  |
| 0xAE | 4号扩展口的动作延时 [低位] | 0x64 | 动作延时10秒 |
| 0xAF | 4号扩展口的动作延时 [高位]，0xAE和0xAF组成一个双字节数，单位是0.1秒 | 0x00 |  |

##### （5）报警源/触发源说明
报警源或触发源通过位来指源头：Bit0=1表示1号门，Bit1=1表示2号门；Bit2=1表示3号门，Bit3=1表示4号门，这4个门可组合作为触发源，但组合时一定要注意合理性，实际使用中不能随意操作。

| 报警源/触发源 | Bit7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 说明 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 对应Bit位=1时表示来源于 |  |  |  |  | 4号门 | 3号门 | 2号门 | 1号门 |  |

##### （6）扩展口的控制位说明
| 控制位 | Bit7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 说明 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 对应Bit位=1时表示 |  |  |  |  |  | 如果此端口作为门未关闭报警输出时，门未关闭报警复位则输出立即停止(无延时) | 如果此端口作为门未关闭报警输出时，有门未关闭报警则一直输出(时间不少于最小延时) | 如果此端口作为非法闯入报警输出时，有非法闯入报警则一直输出 | Bit2的优先级高过bit1，也就是说两个同时设为1，则按bit2的执行 |

##### （7）事件类型1说明
| 事件类型1 | Bit7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 备注 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 对应Bit位=1时表示 |  |  | 火警 | 非法卡刷卡 | 联动 | 非法闯入 | 门开未关闭 | 胁迫 | 这些信号来自设定的门 |

##### （8）事件类型2说明
| 事件类型2 | Bit7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 备注 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明[只能选择其中一个为1] |  |  |  |  |  | 按钮互动 | 门磁互动 | 继电器互动 | 互动意思是保持一致的状态，不受延时限制 |

### （三）外部接口
#### 1. 通信基本格式(34字节帧)
##### （1）485控制器
串口通信速率为9600，N，8，1。

##### （2）.NET控制器
采用UDP通信方式，默认端口是60000。

##### （3）帧结构
PC与控制器采用固定帧长（34字节）通信，每个帧包含帧头（5字节）、数据帧（26字节）、帧尾（3字节）三部分。

| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 数据帧(无数据时用00填充) | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | XX | XX | 00（无数据时） | XX | 0D |

注：[L：低位字节；H：高位字节]

##### （4）各部分说明
1. 帧头—第0-4字节，共5个字节：
    - 起始位—第0字节，固定值为 [7E]；
    - 板地址—第1-2字节，共2字节，即产品序列号S/N，使用时要将S/N由十进制转换为十六进制，注意低位在前，高位在后；
    - 功能位—第3，4字节，低位在前，高位在后，为指令代码。
2. 数据帧—第5-30字节，共26个字节，没有数据时用00填充。
3. 帧尾—第31-33字节，共3个字节：
    - 校验和—第31-32字节[L：低位字节；H：高位字节]，值等于第1—30的字节和；
    - 终止位—第33位，固定值为 [0D]。

示例中的”XX”依据实际情况进行填入。在后面的指令描述中，有些不足34字节的指令描述，只写了”功能位”+有效的”数据帧”，实际发送时，要补齐：起始位/板地址，填充00/校验和/终止位。

#### 2. 参数修改指令
在以下的一些指令描述中，有些指定了参数的地址位，这些参数的值通过此指令来修改。

##### （1）发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 地址位 | 保留 | 设定值 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F4 | 10 | XX | 00 | 03 | 00 | XX | 0d |

##### （2）返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 返回值 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F4 | 10 | 03 | 00 | XX | 0d |

说明：指令执行成功则BYTE5返回值与设定的值相同。

#### 3. 参数读取指令
在以下的一些指令描述中，有些指定了参数的地址位，这些参数的值通过此指令来读取。

##### （1）发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 地址位 | 保留 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F1 | 10 | XX | 00 | 00 | XX | 0d |

##### （2）返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 参数值 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F1 | 10 | 03 | 00 | XX | 0d |

说明：指令执行成功则BYTE5返回指定地址的参数值。

#### 4. 读取运行状态信息[1081]
##### （1）发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-8 | 9-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 要读取的最新记录索引位 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 81 | 10 | 00 | 00 | XX | 0d |

说明：
最新记录索引位：如果是00000000或FFFFFFFF表明是最新的一条记录，否则读取指定位置的索引位。索引位的字节按低位到高位排列。[索引位从1开始计，1表示最早一条记录]

技巧说明：读取运行状态是实现监控的关键指令。在进行监控时，先读取最新记录索引位的记录。读取到最新的记录，同时可以获取到刷卡记录数。这时就可以用读取到刷卡记录数加1填充到要读取的最新记录索引位上，去读取运行状态，以便获取下一个记录。如果读取到了新的刷卡记录，就可以将索引位增1，否则保持索引位不变。这样就可以实现数据的实时监控。

遇到通信不上的处理，这时可对串口通信采取超时400-500毫秒作为出错，可重试一次，再接收不到数据，可认为设备与PC机间的不能通信。

##### （2）返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-11 | 12-13 | 14 | 15-16 | 17-25 | 26 | 27 | 28 | 29 | 30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 当前时间（年月日星期时分秒） | 刷卡记录数（L，H） | 扩展 | 权限数量（L，H） | 指定索引位置的刷卡记录值的前9个字节 | 继电器状态 | 门磁按钮状态 | 故障号 | 保留 | 刷卡记录最后一个字节 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 81 | 10 | 07 08 03 05 14 08 22 | 00 | 00 | 00 | FF | 00 | 00 | 00 | 00 | FF | XX | 0d |

说明：
1. 当前时间：是指控制器的时钟当前值；
2. 刷卡记录数：当前控制器中存储的刷卡记录个数，Byte[14]低四位+Byte[13]+Byte[12]；
3. 权限数量：当前控制器中存储的已注册权限个数，可用于发送完权限后，检查发送的与实际要求是否一致，或用于检查控制器上的权限个数，Byte[14]高四位+Byte[16]+Byte[15]；
4. 指定记录：要读取的最新记录索引位上的刷卡记录，如果无则全为FF，否则就是相应的记录值，其信息详见记录格式；
5. 继电器状态位：[0表示门上锁，1表示门开锁，正常门上锁时，值为0000]；
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 0 | 0 | 0 | 0 | 继4 | 继3 | 继2 | 继1 |
打开1号门时，继1=1；
6. 门磁按钮状态：
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 门磁4 | 门磁3 | 门磁2 | 门磁1 | 按钮4 | 按钮3 | 按钮2 | 按钮1 |
按钮状态：按钮按下时值为0，按钮松开时值为1；
门磁状态：门关闭时值为0，门打开时为1；
7. 故障号[0表示无故障，1表示有故障]：
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 0 | 0 | 0 | 网络芯片有故障 | 系统故障4 | 控制器时钟有故障 | 系统故障2 | 系统故障1 |

#### 5. 远程开门[109D]
##### （1）发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 门号 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 9D | 10 | 01 | 00 | XX | 0d |

说明：门号从1开始计，最大是4；只有门控制为在线时才起作用。

##### （2）返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 9D | 10 | 00 | XX | 0d |

BYTE5返回为00值。

#### 6. 设置时间[108B]
##### （1）发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 年 | 月 | 日 | 星期 | 时 | 分 | 秒 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 8B | 10 | 07 | 08 | 03 | 05 | 14 | 20 | 43 | 00 | XX | 0d |

说明：注意设置时间采用的是BCD码，设置时注意要作相应转换。

|  | 年 | 月 | 日 | 星期 | 时 | 分 | 秒 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|  | 07 | 08 | 03 | 05 | 14 | 20 | 43 |
| 表示 | 2007年 | 08月 | 03日 | 星期五 | 14点 | 20分 | 43秒 |

星期表示：
| 值 | 00 | 01 | 02 | 03 | 04 | 05 | 06 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 表示 | 星期日 | 星期一 | 星期二 | 星期三 | 星期四 | 星期五 | 星期六 |

##### （2）返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 年 | 月 | 日 | 星期 | 时 | 分 | 秒 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 8B | 10 | 07 | 08 | 03 | 05 | 14 | 20 | 43 | 00 | XX | 0d |

说明：返回控制器的日期和时间。

#### 7. 设置门控制参数(在线/延时)[108F]
##### （1）发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7-8 | 9-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 门号 | 控制方式 | 门延时（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 8F | 10 | 01 | 03 | 1E 00 | 00 | XX | 0d |

说明：
1. 门号从1开始计，最大是4；
2. 控制方式：1――常开[不受刷卡控制]；2—常闭[不受刷卡控制]；3—在线控制；
3. 门延时：以0.1秒为单位，001E表示3秒。

##### （2）返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7-8 | 9-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 门号 | 控制方式 | 门延时（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 8F | 10 | 01 | 03 | 1E 00 | 00 | XX | 0d |

返回的数据帧与设置的数据帧相同。

#### 8. 权限处理
##### （1）清空权限[1093]
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 93 | 10 | 00 | XX | 0d |

###### ② 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 成功或失败 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 93 | 10 | 01 | 00 | XX | 0d |

BYTE5 如果成功返回1，失败返回0。

##### （2）读取权限[1095]
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 权限索引号（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 95 | 10 | 01 00 | 00 | XX | 0d |

###### ② 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-8 | 9-10 | 11-12 | 13 | 14-16 | 17-20 | 21-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 卡号（L，H） | 备用 | 终止年月日（L，H） | 门号 | 密码 | 门号对应时段索引号（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 95 | 10 | 90 1E XX XX | XX XX | XX XX | XX | XX XX XX | XX XX XX XX | 00 | XX | 0d |

说明：卡号（4）+备用（2）+ 卡截止年月日（2）+ 门号（1）+ 密码（3）+ 控制时段索引号（4）[每个注册卡占16个字节]。如果返回的为16个FF或16个0，则表示无相应的注册卡记录。

##### （3）尾部加权限[109B]
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7-10 | 11-12 | 13-14 | 15 | 16-18 | 19-22 | 23-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 权限索引号（L，H） | 卡号（L，H） | 备用 | 终止年月日（L，H） | 门号 | 密码 | 门号对应时段索引（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | 40 | 9C | 9B | 10 | 01 00 | 9C 44 48 01 | 00 00 | 9f C7 | 01 | 40 E2 01 | 01 00 00 00 | 00 | XX | 0d |

说明：
1. 在指定位置增加：也是最尾的记录值，可能是最尾，也可能是最新的位置，前提是此位原记录应为FF(空，可加数据)；
2. 卡号（4）+备用（2）+ 卡截止年月日（2）+ 门号（1）+ 密码（3）+ 控制时段索引号（4）[每个注册卡占16个字节]；
3. 9B1001009C44480100009FC70140E20101000000 [密码为123456]；
4. 权限索引号：从1开始计算；
5. 权限发送时，必须先发１号门（门号相同的，先发卡号小的，再发卡号大的），再发２号门…；
6. 执行此指令之前先清空权限，然后从第１个开始进行发送。

###### ② 返回信息指令（控制器）
成功BYTE5返回1，失败返回0。

##### （4）添加或修改权限[1107] (此指令只适合1000个权限内的操作)
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7-10 | 11-12 | 13-14 | 15 | 16-18 | 19-22 | 23-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 空 | 卡号（L，H） | 备用1 | 终止年月日（L，H） | 门号 | 密码 | 门1-4时段（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | 40 | 9C | 07 | 11 | 00 00 | 9C 44 48 01 | 00 00 | 9f C7 | 01 | 40 E2 01 | 01 00 00 00 | 00 | XX | 0d |

说明：
1. 此指令只适合1000个权限内的操作，如果超过1000个则等待返回的时间可能会加长。超过1000个权限时，请建议使用清空权限，再采用尾部加权限方式重新上传权限；
2. 添加或修改指定的权限：(由卡号确定)；
3. 卡号（4）+备用（2）+ 卡截止年月日（2）+ 门号（1）+ 密码（3）+ 控制时段索引号（4）[每个注册卡占16个字节]；
4. 如果权限已存在时，只对针于权限与发出的卡号相同的权限进行修改，只改后12字节，前4个字节的卡号不变；
5. 如果权限不存在，则添加一个新的。

###### ② 返回信息指令（控制器）
成功BYTE5返回1，失败返回0。

##### （5）删除一个权限[1108] (此指令只适合1000个权限内的操作)
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7-10 | 11-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 空 | 卡号（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 08 | 11 | 00 00 | 9C 44 48 01 | 00 | XX | 0d |

说明：
1. 此指令只适合1000个权限内的操作，如果超过1000个则等待返回的时间可能会加长。超过1000个权限时，请建议使用清空权限，再采用尾部加权限方式重新上传权限；
2. 删除指定的权限：(由ID号+区号+门号确定)；
3. 卡号（4）+ “备用（2）+卡截止年月日（2）+ 门号（1）+ 密码（3）+ 控制时段索引号（4）”可以用00填充；
4. 如果存在且删除了，则返回成功信息；如果不存在，则返回失败信息。

###### ② 返回信息指令（控制器）
成功BYTE5返回1，失败返回0。

#### 9. 时段处理
##### （1）读取控制时段[1096]
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 时段索引号（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 96 | 10 | XX XX | 00 | XX | 0d |

###### ② 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7 | 8 | 9-10 | 11-12 | 13-14 | 15-16 | 17-18 | 19-20 | 21-22 | 23-24 | 25-26 | 27-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 时段索引号（L，H） | 星期控制 | 下一个链接时段 | 备用 | 起始时分秒1（L，H） | 终止时分秒1（L，H） | 起始时分秒2（L，H） | 终止时分秒2（L，H） | 起始时分秒3（L，H） | 终止时分秒3（L，H） | 起始日期（L，H） | 截止日期（L，H） | 保留 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | 40 | 9C | 96 | 10 | 02 00 | FF | 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 00 00 | XX | 0d |

说明：返回相应索引位的控制时段信息。注意0和1时段收到的数据是无意义的。0时段始终是禁止进入，1时段是任意时分秒有效[在有效年月日之内]。索引大于1的时段的初始状态为任意时间有效。

##### （2）修改控制时段[1097]
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7 | 8 | 9-10 | 11-12 | 13-14 | 15-16 | 17-18 | 19-20 | 21-22 | 23-24 | 25-26 | 27-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 时段索引号（L，H） | 星期控制 | 链接时段 | 备用 | 起始时分秒1（L，H） | 终止时分秒1（L，H） | 起始时分秒2（L，H） | 终止时分秒2（L，H） | 起始时分秒3（L，H） | 终止时分秒3（L，H） | 起始年月日（L，H） | 终止年月日（L，H） | 备用 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 97 | 10 | 02 00 | FF | 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 21 00 | 9f 29 | 00 00 00 00 | XX | 0d |

###### ② 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7 | 8 | 9-10 | 11-12 | 13-14 | 15-16 | 17-18 | 19-20 | 21-22 | 23-24 | 25-26 | 27-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 时段索引号（L，H） | 星期控制 | 链接时段 | 备用 | 起始时分秒1（L，H） | 终止时分秒1（L，H） | 起始时分秒2（L，H） | 终止时分秒2（L，H） | 起始时分秒3（L，H） | 终止时分秒3（L，H） | 起始年月日（L，H） | 终止年月日（L，H） | 备用 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 97 | 10 | 02 00 | FF | 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 00 00 | 21 00 | 9f 29 | 00 00 00 00 | XX | 0d |

说明：如果成功，返回一致的信息，否则返回的信息为乱码或0。

#### 10. 记录处理
##### （1）读取指定索引位的记录信息[108D]
###### ① 发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-8 | 9-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 记录索引号（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 8D | 10 | 01 00 00 00 | 00 | XX | 0d |

说明：记录索引位：5，6，7，8〔低位在前，高位在后〕，最大数为10万条以上，从1开始计数，如果是0或FFFFFFFF表示读取当前最新的一条记录），此指令用于提取记录时使用。

###### ② 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7 | 8 | 9-10 | 11-12 | 13-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 新记录卡ID号（L，H） | 商家号 | 刷卡状态 | 刷卡年月日（L，H） | 刷卡时分秒（L，H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 8D | 10 | 06 52 | 71 | 01 | b3 02 | 0d 5d | 00 | XX | 0d |

说明：要查询的刷卡记录，如果无记录，返回信息以”FFFFFFFF”填充BYTE(5,6,7,8)。

##### （2）清除指定数量的记录[108E] 

###### （一）指令帧结构（34字节完整帧）
| 总序号（BYTE） | 字节功能         | 说明                                                                 | 固定值/格式要求                          |
|----------------|------------------|----------------------------------------------------------------------|-----------------------------------------|
| 0              | 起始位           | 帧起始标识，固定不变                                                 | 0x7E                                    |
| 1-2            | 板地址（L-H）    | 控制器序列号S/N的十六进制转换值，低位在前、高位在后（例：S/N=40000→0x9C 0x40） | XX XX（需替换为实际设备地址）            |
| 3-4            | 功能位（L-H）    | 指令代码，清除记录功能固定为0x8E 0x10                                 | 0x8E 0x10                                |
| 5-8            | 要清除的记录数量 | 低位在前、高位在后，从1开始计数（例：清除10条→0x0A 0x00 0x00 0x00）   | N1 N2 N3 N4（N1=低位，N4=高位）         |
| 9-30           | 数据填充位       | 无额外数据时，统一填充0x00                                           | 00 00 ... 00（共22字节）                |
| 31-32          | 校验和（L-H）    | 计算范围：字节1-30的累加和，结果按低位在前、高位在后排列               | XX XX（按实际计算结果填充）              |
| 33             | 终止位           | 帧结束标识，固定不变                                                 | 0x0D                                    |


###### （三）发送指令示例（清除10条记录）
假设控制器S/N=40000（地址0x9C 0x40），清除数量=10（0x0A 0x00 0x00 0x00），完整指令帧（十六进制）：
```
7E 9C 40 8E 10 0A 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 58 04 0D
```
- 校验和计算：字节1-30累加和=0x0458→低位0x58、高位0x04。

###### （一）返回帧结构（34字节完整帧）
| 总序号（BYTE） | 字节功能         | 说明                                                                 | 固定值/反馈标识                          |
|----------------|------------------|----------------------------------------------------------------------|-----------------------------------------|
| 0              | 起始位           | 帧起始标识，固定不变                                                 | 0x7E                                    |
| 1-2            | 板地址（L-H）    | 与发送指令中的板地址一致，确认设备响应正确                             | XX XX（与发送地址相同）                  |
| 3-4            | 功能位（L-H）    | 与发送指令中的功能位一致，标识响应对应指令                             | 0x8E 0x10                                |
| 5              | 执行结果标识     | 成功清除返回0x00，失败返回非0值（如0x01=参数错误，0x02=无对应记录）   | 0x00（成功）/ 非0（失败）                |
| 6-30           | 数据填充位       | 无额外反馈数据，统一填充0x00                                           | 00 00 ... 00（共25字节）                |
| 31-32          | 校验和（L-H）    | 计算范围：字节1-30的累加和，结果按低位在前、高位在后排列               | XX XX（按实际计算结果填充）              |
| 33             | 终止位           | 帧结束标识，固定不变                                                 | 0x0D                                    |

###### （二）返回结果解读
1. 成功反馈：字节5=0x00，说明指定数量的记录已清除，剩余记录索引重新从1开始计数。
2. 失败反馈：
   - 字节5=0x01：清除数量超出控制器当前存储的记录数（例：存储8条却要求清除10条）。
   - 字节5=0x02：清除数量为0或非法值（需≥1）。
   - 字节5=0x03：通信校验错误，需重新发送指令。

说明：成功时，BYTE5返回00。

### 0.2.3.11 扩展功能
#### 0.2.3.11.1 设置读卡器是否使用密码键盘
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x26 | 1号读卡器是否启用密码键盘 | 00 | 缺省不启用密码键盘，00=不启用，01=启用 |
| 0x27 | 2号读卡器是否启用密码键盘 | 00 | 缺省不启用密码键盘，00=不启用，01=启用 |
| 0x28 | 3号读卡器是否启用密码键盘 | 00 | 缺省不启用密码键盘，00=不启用，01=启用 |
| 0x29 | 4号读卡器是否启用密码键盘 | 00 | 缺省不启用密码键盘，00=不启用，01=启用 |

- 1号读卡器启用密码键盘，指令：F410260001
- 2号读卡器启用密码键盘，指令：F410270001
- 3号读卡器启用密码键盘，指令：F410280001
- 4号读卡器启用密码键盘，指令：F410290001

不启用时，将”01”换成”00”即可。

#### 0.2.3.11.2 设置是否启用报警/门磁事件记录[10F4] –参数表
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x2D | 是否记录按钮事件 | 0x00 | 缺省不记录按钮事件，00=不启用，01=启用 |
| 0x2E | 是否记录报警事件 | 0x00 | 缺省不记录报警事件，00=不启用，01=启用 |
| 0xDC | 是否记录门磁事件[开门或关门的时间] | 0x00 | 缺省不记录门磁事件，00=不启用，01=启用 |
| 0x30 | 启用报警功能项 | 0x00 | 缺省不启用报警 |

0x30报警功能[0表示不启用，1表示启用相应报警]
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 保留 | 保留 | 胁迫密码必须有合法卡刷了之后才行 | 任何不开门的刷卡操作都当作"非法刷卡"输出报警 | 保留 | 非法闯入 | 门打开时间过长未关闭报警 | 胁迫报警 |

举例说明(发送指令)：
- F410300001 [启用胁迫报警]
- F410300002 [启用门打开时间过长报警]
- F410300004 [启用门未刷卡强制打开报警]
- F410300007 [同时启用胁迫+门打开时间过长+门未刷卡强制打开，1+2+4=7]
- F410300010 [启用不能开门的刷卡(也就是非法刷卡)报警]
- F410300020 [启用胁迫密码必须有合法卡刷了之后才行]
- F410300000 取消报警
- F4102d0001—设置记录按钮操作
- F4102d0000—取消记录按钮操作
- F4102e0001—设置记录报警事件操作
- F4102e0000—取消记录报警事件操作
- F410DC0001—设置记录门磁事件
- F410DC0000—取消记录门磁事件

#### 0.2.3.11.3 设置是否启用反潜回 [10F4] –参数表
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x2F | 启用反潜回 | 00 | 缺省不启用反潜回，00=不启用，01=启用 |
| 0xB0 | 读卡器性质 | 0A | 与反潜回配合使用 |

参数设置说明:
- 禁用反潜回，发送两条指令：F4102F0000、F410B0000A
- 启用反潜回则有以下四种情况进行设置：
  - 情况一：单门时，1、2号读卡器反潜；双门时，1、2号读卡器反潜，3、4号读卡器反潜；四门时，1、2号读卡器反潜，3、4号读卡器反潜。发送两条指令：F4102F0001、F410B000FA
  - 情况二：双门时，1、3号读卡器与2、4号读卡器反潜 [1、3进，2、4出]；四门时，1、3号读卡器与2、4号读卡器反潜 [1、3进，2、4出]。发送两条指令：F4102F0002、F410B000FA
  - 情况三：四门时，1号读卡器与2、3号读卡器反潜 [1进，2、3出]。发送两条指令：F4102F0003、F410B0007E
  - 情况四：四门时，1号读卡器与2、3、4号读卡器反潜 [1进，2、3、4出]。发送两条指令：F4102F0004、F410B000FE

#### 0.2.3.11.4 设置多门互锁[10F4] –参数表
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x1E | 1号门互锁 | 00 | 缺省不启用，00=不启用，01=启用 |
| 0x1F | 2号门互锁 | 00 | 缺省不启用，00=不启用，01=启用 |
| 0x20 | 3号门互锁 | 00 | 缺省不启用，00=不启用，01=启用 |
| 0x21 | 4号门互锁 | 00 | 缺省不启用，00=不启用，01=启用 |

具体使用描述如下：
1. 设置1/2号门互锁或3/4号门互锁，指令如下：
   - F4101E0001—设置1号门互锁 [2号门打开后，1号门不能再打开]
   - F4101F0001—设置2号门互锁 [1号门打开后，2号门不能再打开]
   - F410200001—设置3号门互锁 [4号门打开后，3号门不能再打开]
   - F410210001—设置4号门互锁 [3号门打开后，4号门不能再打开]
   - 若设1、2号门互锁，发送两条指令：F4101E0001、F4101F0001
   - 若设3、4号门互锁，发送两条指令：F410200001、F410210001
2. 清除互锁：
   - F4101E0000—取消1号门互锁
   - F4101F0000—取消2号门互锁
   - F410200000—取消3号门互锁
   - F410210000—取消4号门互锁
3. 设置多门互锁[注意只适用于四门控制器]：
   - 设置1、2、3号门互锁指令[要发三条指令]：F4101E0071、F4101F0071、F410200071
   - 设置1、2、3、4号门互锁指令[要发四条指令]：F4101E00F1、F4101F00F1、F4102000F1、F4102100F1

#### 0.2.3.11.5 设置胁迫密码[10F4] –参数表
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x5A | 胁迫密码的第一字节(低位) | 84 | 胁迫密码只有启用了胁迫报警才有效 |
| 0x5B | 胁迫密码的第二字节 | 94 |  |
| 0xB3 | 胁迫密码的第三字节 | FF |  |

参数设置说明：胁迫密码只有启用了胁迫报警才有效。

以设置胁迫密码123456为例，123456转换为十六进制是01E240，整个操作要发送三条指令：
- F4105A0040 [胁迫密码的第一字节低位字节]
- F4105B00E2 [胁迫密码的第二字节]
- F410B30001 [胁迫密码的第三字节]

整个控制器只能指定一个胁迫密码。

#### 0.2.3.11.6 设置或取消开门密码[10F4] –参数表
每个密码占用两个字节，如果无密码，则全用FF填充。
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x5C-0x63 | 1号读卡器4组密码 | 全FF | (无密码) 新密码不能是FFFF(对应十进制65535) |
| 0x64-0x6B | 2号读卡器4组密码 | 全FF | (无密码) |
| 0x6C-0x73 | 3号读卡器4组密码 | 全FF | (无密码) |
| 0x74-0x7B | 4号读卡器4组密码 | 全FF | (无密码) |

给1号读卡器添加两条开门密码(123456[十六进制01E240]，234567[十六进制039447])的步骤如下：
- F4105C0040 [123456密码低位字节]
- F4105D00E2 [123456密码高位字节]
- F4105E0047 [234567密码低位字节]
- F4105F0094 [234567密码高位字节]
- F4106000FF [FFFF无密码] --必须要
- F4106100FF [FFFF无密码] --必须要
- F4106200FF [FFFF无密码] --必须要
- F4106300FF [FFFF无密码] --必须要

#### 0.2.3.11.7 设置启用输入”*卡号*密码#”开门[10F4] –参数表
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0xB1 | 启用输入”ESC卡号ESC密码ENT”开门 | 0x00 | 缺省不启用，00=不启用 |

0xB1各Bit位说明[0表示不启用，1表示启用输入”*卡号*密码#”开门]
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 保留 | 保留 | 保留 | 保留 | 4号读卡器允许 | 3号读卡器允许 | 2号读卡器允许 | 1号读卡器允许 |

- 设置4个读卡器都要输入卡号密码开门的指令，要发送：F410B1000F
- 取消输入卡号密码开门的指令，要发送：F410B10000

#### 0.2.3.11.8 设置开门超时报警的时间长
| 地址位 | 说明 | 默认值 | 默认值说明 |
| ---- | ---- | ---- | ---- |
| 0x33 | 开门超时报警的时间长的低字节 | FA | 默认25秒，FA对应十进制是250，开门超时报警的时间长的单位是0.1秒 |
| 0xB2 | 开门超时报警的时间长的高字节 | 00 |  |

以设置延时26秒为例，系统单位是0.1秒，输入的值为260，对应的十六进制是104，要发送以下两条指令，才算完成：
- F410330004 [超时的低位字节04]
- F410B20001 [超时的高位字节01]

#### 0.2.3.11.9 定时任务的实现[10F5]
##### A．发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7-8 | 9 | 10-11 | 12 | 13 | 14 | 15 | 16-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 固定值 | 固定值 | 任务索引号 | 固定值 | 动作时间[时分秒] | 星期控制 | 门号 | 门控制方式 | 备用 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F5 | 10 | 00 | 01 | 00 00 | 06 | 00 01 | 00 | 01 | 00 | 00 | 00 | XX | 0d |

说明：
- 任务索引号是以06递增；
- 动作时间：参照短时间格式中的”时分秒”部分；
- 星期控制：(1-当前星期有效；0-当前星期无效)
| Bit位 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 说明 | 0 | 星期日 | 星期六 | 星期五 | 星期四 | 星期三 | 星期二 | 星期一 |
- 备用：缺省为0，如果不为0，则备用的值表示月份，而星期控制表示日期，形成以某月某日在动作时间时动作。

##### B. 返回指令(PC)
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7 | 8 | 9 | 10 | 11-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 动作时间[时分秒] | 星期控制 | 门号 | 门控制方式 | 备用 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F5 | 10 | 00 01 | 00 | 01 | 00 | 00 | 00 | XX | 0d |

如果成功，则返回的BYTE(5-10)与发送的BYTE(10-15)的值相同。

设定定时任务的指令操作流程：
1. 先发送两条指令：F410360001 [启用定时任务指令]、F3100001指令；
2. 再发送：
   - F510000100000600387F010100 [第一个任务 0038 表示7点，7F-星期全部，0101 一号门常开]
   - F510000106000600387F020100 [第二个任务 0038 表示7点，7F-星期全部，0201 二号门常开]
   - F51000010C000600387F030100 [第三个任务 0038 表示7点，7F-星期全部，0301 三号门常开]
   - F510000112000600387F040100 [第四个任务 0038 表示7点，7F-星期全部，0401 四号门常开]
   - F5100001180006C08B7F010300 [第五个任务 C08B表示17:30，7F-星期全部，0103 一号门在线]
   - F51000011E0006C08B7F020300 [第六个任务 C08B表示17:30，7F-星期全部，0203 二号门在线]
   - F5100001240006C08B7F030300 [第七个任务 C08B表示17:30，7F-星期全部，0303 三号门在线]
   - F51000012A0006C08B7F040300 [第八个任务 C08B表示17:30，7F-星期全部，0403 四号门在线]
3. 最后发送：0911 [作用：将上传的任务立即生效。由于执行时间相对长些，所以要作等待。此指令执行返回：BYTE5成功返回1，失败返回0]

取消定时任务的指令操作流程：取消定时任务指令：F410360000[关闭定时任务]

### 0.2.3.12 设备基本信息[1082]
#### A．发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 82 | 10 | 00 | XX | 0d |

#### B. 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-7 | 8 | 9 | 10-15 | 16-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 驱动发布日期（年月日） | 驱动版本 | 控制器型号 | 保留 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | 82 | 10 | 07 07 31 | 1A | 62 | 01 01 4B FF FD F0 | 00 | XX | 0d |

说明：
- 生产日期：070731表示2007年7月31日设计；
- 驱动版本：1A，用十进制表示就是26，也就是版本为26；
- 控制器型号：62表示的是双门双向控制器；其他值：64表示四门单向控制器，61表示单门双向控制器。

### 0.2.3.13 格式化[10FF]
#### A．发送指令（PC）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-6 | 7-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 选项值 | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | 40 | 9C | FF | 10 | 55 1C | 00 | XX | 0d |

说明：
- 此指令不返回信息；
- 它使控制器重新启动，并且所有参数恢复为出厂设置；
- 在控制器CPU运行指示灯正常闪烁后，可通过读取运行状态信息来确定指令的执行效果。

## 0.2.4 .NET控制器搜索及配置协议
### 0.2.4.1 搜索.NET设备[1101]
#### A．发送指令（PC）
采用UDP广播包方式，端口是60000，发出的数据包如下：
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | 00填充 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | FF | FF | 01 | 11 | 00 | XX | 0d |

说明：如果要获取某台控制器的网络设置信息，只要指定板地址就可以了。

#### B. 返回信息指令（控制器）
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-10 | 11-14 | 15-16 | 17-18 | 19-22 | 23-24 | 25-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | Mac地址 | IP地址 | 掩码 | 掩码 | 默认网关 | UDP口（L，H） | 保留为0 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | 10 | A4 | 01 | 11 | 00 57 47 01 A4 10 | C0 A8 A8 64 | FF FF | FF 00 | C0 A8 A8 FE | 00 00 | 00 | XX | 0d |

说明：
- 搜索到的控制器地址：A410（对应的十进制是42000）；
- MAC地址：00:57:47:01:A4:10；
- IP地址是：192.168.168.100 [对应的十六进制是：C0:A8:A8:64]；
- 掩码是：255.255.255.0[对应的十六进制是：FF:FF:FF:00]；
- 默认网关：192.168.168.254[对应的十六进制是：C0:A8:A8:FE]；
- UDP口：0000[表示采用的是默认的60000端口]。

### 0.2.4.2 配置TCPIP[11F2]
#### 发送指令（PC）
采用UDP广播包方式，端口是60000，发出的数据包如下：
| 总序号（BYTE） | 0 | 1 | 2 | 3 | 4 | 5-10 | 11-14 | 15-16 | 17-18 | 19-22 | 23-24 | 25-30 | 31-32 | 33 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 各字节位说明 | 起始位 | 板地址（L） | 板地址（H） | 功能位（L） | 功能位（H） | Mac地址 | 新IP地址 | 新掩码 | 新掩码 | 新默认网关 | 新UDP口 | 保留为0 | 校验和（L，H） | 终止位 |
| 值(hex) | 7E | XX | XX | F2 | 11 | 00 57 47 01 A4 10 | C0 A8 A8 64 | FF FF | FF 00 | C0 A8 A8 64 | 61 EA | 00 | XX | 0d |

说明：
- 指定要配置的控制器地址：A410（对应的十进制是42000）；
- MAC地址：00:57:47:01:A4:10 [与搜索到的地址保持一致，除非特殊情况下才变动]；
- 新IP地址：192.168.168.100 [对应的十六进制是：C0:A8:A8:64]；
- 新掩码是：255.255.255.0[对应的十六进制是：FF:FF:FF:00]；
- 新默认网关：192.168.168.254[对应的十六进制是：C0:A8:A8:FE]；
- 新UDP口：61EA[表示60001端口]。

#### B. 返回信息指令（控制器）
执行此条指令，不会有返回信息。要过3秒后，通过读取TCPIP信息来确认是否成功。在执行此条指令后，请等待3秒，再进行其他通信指令操作。

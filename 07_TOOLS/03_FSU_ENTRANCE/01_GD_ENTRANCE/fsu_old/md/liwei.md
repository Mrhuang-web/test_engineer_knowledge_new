# ACUC3.0门禁控制器协议（RS485/RS422通信）
## 1. 通信规范
### 1.1 通信速率与数据格式
#### 1.1.1 通信速率
支持9600/19200/2400 B/S等速率，设备内置速率切换机制。  
数据格式：1起始位、8数据位、1停止位，校验方式支持无校验/奇校验/偶校验/MARK(1)校验/SPACE(0)校验。

#### 1.1.2 信息交换的数据帧（命令数据包/信息数据包）
协议数据包基本格式：

| 序号 | 字段 | 字节数 | 符号 | 说明 |
|------|------|--------|------|------|
| 1 | 起始符 | 1 | SOI | 固定值7EH（START OF INFORMATION） |
| 2 | 版本 | 1 | VER | 通信协议版本（=10H，表示1.0） |
| 3 | 组内地址 | 1 | ADR | 设备RS485地址（有效值1-254） |
| 4 | 类码与组地址 | 1 | CID1 | D7-D4=8（环境控制类），D3-D0=分组号（0-15），支持16×254台设备分组 |
| 5 | 类别 | 1 | CID2/RTN | 下发时为CID2（命令分类码），响应时为RTN（执行结果） |
| 6 | 参数长度校验 | 2 | L.TH | 携带参数的长度标识（含校验位） |
| 7 | 参数 | N字节 | INFO | 下发为命令参数COMINFO，响应为返回数据DATAINFO |
| 8 | 帧校验 | 2 | CHK-SUM | 从VER到INFO末尾字节的ASCII码累加和（双字节，高位在前，模65536取补） |
| 9 | 结束符 | 1 | EOI | 固定值0DH（END OF INFORMATION） |

### 1.2 数据传输与超时错
#### 1.2.1 传输的方法
- SOI、EOI按单字节（HEX）直接发送；
- 其余字段（VER至CHK-SUM）按单字节拆分为高4位、低4位，按ASCII码发送（先高后低）。

SU与SM的通信类型分为三种：
1. 设置SM的权限确认；
2. 设置SM参数命令；
3. 读取SM信息的命令。

##### SU发送命令帧格式（设置/读取参数）
| 序号 | 字段 | 字节数 | 格式 | 说明 |
|------|------|--------|------|------|
| 1 | 起始符 | 1 | SOI | 7EH |
| 2 | 版本 | 1 | VER | 协议版本号 |
| 3 | 组内地址 | 1 | ADR | 设备地址 |
| 4 | 类码与组地址 | 1 | CID1 | 设备分类+分组码 |
| 5 | 类别 | 1 | CID2 | 命令分类码 |
| 6 | 参数长度校验 | 2 | L.TH | 参数长度标识 |
| 7 | 参数 | N | COMINFO | 命令参数（含命令分类、命令号、参数） |
| 8 | 帧校验 | 2 | SUM | 校验和 |
| 9 | 结束符 | 1 | EOI | 0DH |

##### SM对设置命令的应答帧格式
| 序号 | 字段 | 字节数 | 格式 | 说明 |
|------|------|--------|------|------|
| 1 | 起始符 | 1 | SOI | 7EH |
| 2 | 版本 | 1 | VER | 协议版本号 |
| 3 | 组内地址 | 1 | ADR | 设备地址 |
| 4 | 类码与组地址 | 1 | CID1 | 设备分类+分组码 |
| 5 | 类别 | 1 | RTN | 执行结果 |
| 6 | 参数长度校验 | 2 | 0,0 | 无参数标识 |
| 7 | 参数 | 无 | 无 | 无参数 |
| 8 | 帧校验 | 2 | SUM | 校验和 |
| 9 | 结束符 | 1 | EOI | 0DH |

##### SM对读取命令的返回帧格式
| 序号 | 字段 | 字节数 | 格式 | 说明 |
|------|------|--------|------|------|
| 1 | 起始符 | 1 | SOI | 7EH |
| 2 | 版本 | 1 | VER | 协议版本号 |
| 3 | 组内地址 | 1 | ADR | 设备地址 |
| 4 | 类码与组地址 | 1 | CID1 | 设备分类+分组码 |
| 5 | 类别 | 1 | RTN | 执行结果 |
| 6 | 参数长度校验 | 2 | L.TH | 返回数据长度标识 |
| 7 | 参数 | N | DATAINFO | 读取的参数信息 |
| 8 | 帧校验 | 2 | SUM | 校验和 |
| 9 | 结束符 | 1 | EOI | 0DH |

#### L.TH计算规则
1. 数据信息字节长度为L，ASCII码个数LENID=2L；
2. LENID按4位分组累加，模16取补得到LCHKSUM（高4位）；
3. 16位结构：LCHKSUM（4位）+ LENID（12位）；
4. 校验：4个4位分组累加和为0。

#### 1.2.2 超时错时间
500毫秒（未收到响应或响应错误则判定通信失败）。

### 1.3 设备应答
SM应答/返回的RTN基本值：

| RTN值 | 代表含义 |
|-------|----------|
| 00H | 正常执行命令 |
| 01H | VER不符，命令未执行 |
| 02H | 命令帧累加和校验错误 |
| 03H | 参数部分累加和校验错误 |
| 04H | 无效的CID2 |
| 05H | 无法识别的命令格式 |
| 06H | 命令帧数据信息部分无效 |
| 07H | 无设置/访问重要信息的权限 |
| E0H | 密码确认不正确 |
| E1H | 密码修改不成功 |
| E2H | 相应设置项存储空间已满 |
| E3H | 参数修改/删除不成功 |
| E4H | 相应设置项存储空间已空 |
| E5H | 内部无相应信息项 |
| E6H | 重复设置相同ID用户，保留原用户 |
| E7H | 重复设置相同卡号的RF卡给不同用户 |
| E8H | 重复设置完全相同的用户 |
| EFH | 未知错误 |

## 2. 通信命令的种类
SU与SM之间的通信分为三类：
1. 访问SM的权限确认通信命令；
2. 设置SM的参数命令；
3. 读取SM内部信息的命令。

## 3. 访问权限的确认（0x48）
SU设置SM重要信息、控制开门、读取授权用户信息前，需通过SM密码认证，获取操作权限。

### 3.1 访问权限确认（0XE0）
#### 命令格式
- CID2=48H
- COMMAND INFO：
  | COMMAND GROUP | COMMAND TYPE | DATA |
  |---------------|-------------|------|
  | 0XF0 | 0XE0 | 5字节SM密码（2字节系统密码+3字节BCD格式键盘密码） |

#### 响应说明
- 密码匹配：RTN=0（权限确认通过，权限保持约1分钟，每次正确设置延长1分钟）；
- 密码不匹配：RTN=E0H（未通过权限确认）。

### 3.2 访问权限的取消（0XE1）
#### 命令格式
- CID2=48H
- COMMAND INFO：无DATAF项
  | COMMAND GROUP | COMMAND TYPE |
  |---------------|-------------|
  | 0XF0 | 0XE1 |

#### 响应说明
- RTN=0（权限已取消）；
- RTN≠0（权限未取消）。

### 3.3 修改SM的访问密码（0XE2）
#### 命令格式
- CID2=48H（需先通过权限确认）
- COMMAND INFO：
  | COMMAND GROUP | COMMAND TYPE | DATAF1 | DATAF2 |
  |---------------|-------------|--------|--------|
  | 0XF0 | 0XE2 | 5字节新密码（2字节系统密码+3字节BCD键盘密码） | 1字节校验码（新密码5字节异或值） |

#### 响应说明
- RTN=0（密码修改成功）；
- RTN=E1H（修改不成功）。

#### 注意事项
新密码后3字节需为BCD码（键盘仅支持0-9数字输入），若含非BCD码则关闭键盘设置功能。

## 4. 设置命令（0x49）
SU通过权限认证后，可对SM所有工作参数进行设定，命令帧CID2=49H，COMMAND INFO格式如下：

| COMMAND GROUP | COMMAND TYPE | DATAF |
|---------------|-------------|------|
| 0XF1 | 0XE0至0XFF | 参数若干字节 |

响应说明：RTN=0（设置成功），非零值（设置不成功）。

### 4.1 设置日期时间的命令（0XE0）
#### 命令参数（DATAF=8字节BCD）
| 字段 | 字节数 | 范围 | 说明 |
|------|--------|------|------|
| 年 | 2 | 2000-2099 | 世纪+年（如2012=20H+12H） |
| 月 | 1 | 1-12 | BCD格式 |
| 日 | 1 | 1-31 | BCD格式 |
| 星期 | 1 | 1-7 | 7代表星期日 |
| 时 | 1 | 0-23 | BCD格式 |
| 分 | 1 | 0-59 | BCD格式 |
| 秒 | 1 | 0-59 | BCD格式 |

### 4.2 设置准进时段
#### 4.2.1 将准进时段、管理时段设置成缺省值（0XE1）
- COMMAND TYPE=0XE1，DATAF=1字节（=1）；
- 缺省设置：工作日/休息日/星期准进时段均为00:00-23:59（全天准进），管理时段（常开/常闭/二次加密/监控布防）均无效。

#### 4.2.2 置所有时段无效（0XE1）
- COMMAND TYPE=0XE1，DATAF=1字节（=0）；
- 所有准进时段、管理时段均无效。

#### 4.2.3 设置工作日的准进时段（0XE1）
- COMMAND TYPE=0XE1；
- DATAF=17字节：
  | GROUP No.（1字节，1-4） | 16字节准进时段描述列表 |
  |-------------------------|------------------------|
  | 时段编号（1-4） | 4组“起始时间-结束时间”（每组4字节BCD，如HH:MM(起始)+HH:MM(结束)） |

#### 4.2.4 设置非工作日（节假日/星期内休息日）的准进时段（0XE2）
- COMMAND TYPE=0XE2；
- DATAF=17字节：
  | 第1字节（固定=1） | GROUP No.（1字节=1） | 16字节准进时段描述列表 |
  |--------------------|-----------------------|------------------------|
  | 标识非工作日 | 时段编号 | 4组“起始时间-结束时间”（每组4字节BCD） |

#### 4.2.5 设定星期准进时间段列表（0XF1）
- COMMAND TYPE=0XF1，DATAF=26字节；
- 前2字节：表号（0-15）+星期（1-7）（如9,6=第10张表的星期六）；
- 第3-26字节：6个准进时段（每组4字节BCD，“起始时间-结束时间”）。

### 4.3 用户（准进人员）管理
#### 4.3.1 增加一个用户（至门控制器）（0XE3）
- COMMAND TYPE=0XE3，DATAF=16字节用户描述：
  | 卡片编号（5字节HEX，高位在前） | 用户编号ID（4字节BCD） | 用户密码（2字节BCD） | 有效期（4字节BCD，YYYY-MM-DD） | 用户权限（1字节） |
  |-------------------------------|-------------------------|-----------------------|--------------------------------|--------------------|
  | 唯一标识用户卡片 | 唯一用户ID | 个人密码 | 权限过期时间 | D7-D6=权限类型，D3-D0=时段表索引 |

#### 用户权限字节说明（D7-D0，D0为低位）
- D7-D6=00/01：一般用户（受星期准进时段限制），D3-D0指定时段表；
- D7-D6=10：一般用户（受工作日/休息日时段限制），D1-D0指定时段表（00=表1，01=表2，10=表3，11=表4）；
- D7-D6=11：特权用户（不受时段限制，受有效期限制）。

#### 响应说明
- RTN=0（设置成功）；
- RTN=E2H（存储空间已满）；
- RTN=E7H（卡号重复）；
- RTN=E6H（用户ID重复）；
- RTN=E8H（用户信息完全重复）。

#### 4.3.2 更新原用户某些信息（0XE3）
支持5种更新格式：
1. 16字节：5字节卡号+4字节ID+2字节密码+4字节有效期+1字节权限；
2. 12字节：5字节卡号+2字节密码+4字节有效期+1字节权限；
3. 6字节：5字节卡号+1字节权限；
4. 7字节：5字节卡号+2字节密码；
5. 9字节：5字节卡号+4字节有效期。

#### 4.3.3 删除用户卡（从门控制器内）（0XE4）
- COMMAND TYPE=0XE4，DATAF=6字节：
  | 1字节指引（=0） | 5字节卡片编号 |
  |------------------|---------------|
  | 按卡号检索 | 目标用户卡号 |

#### 4.3.4 删除用户编号（ID）（从门控制器内）（0XE4）
- COMMAND TYPE=0XE4，DATAF=6字节：
  | 1字节指引（=1） | 1字节00 + 4字节用户ID |
  |------------------|-----------------------|
  | 按用户ID检索 | 目标用户ID |

#### 4.3.5 全部删除用户（从门控制器内）（0XE4）
- COMMAND TYPE=0XE4，DATAF=6字节：
  | 1字节指引（=2） | 5字节全00 |
  |------------------|-------------|
  | 批量删除标识 | 删除所有用户 |

### 4.4 设定门的特性参数
#### 4.4.1 门锁继电器执行时间（单独设定）（0XE6）
- COMMAND TYPE=0XE6，DATAF=1字节（1-255）；
- 单位：0.1秒（例：50=5秒）。

#### 4.4.2 开门后等待进入的延时时间（单独设定）（0XE7）
- COMMAND TYPE=0XE7，DATAF=1字节（20-255）；
- 单位：0.1秒（例：50=5秒），超时未进入则报警（机械锁需“开门-关门”动作）。

#### 4.4.3 红外报警输出的被确认时间（单独设定）（0XE8）
- COMMAND TYPE=0XE8，DATAF=1字节（20-255）；
- 单位：0.1秒（例：50=5秒，报警发生后延时确认再输出）。

#### 4.4.4 设定异地报警的延时时间（单独设定）（0XE9）
- COMMAND TYPE=0XE9，DATAF=1字节（0-255）；
- 单位：0.1秒（0按256处理=25.6秒）。

#### 4.4.5 开启红外监控后的等待延时（0XEF）
- COMMAND TYPE=0XEF，DATAF=2字节；
- 第1字节=0，第2字节=延时时间（20-255，单位0.1秒，2-25.5秒）；
- 功能：开启红外后延时监测，避免开启者误报警。

#### 4.4.6 门磁、红外等感应器的特性（单独设定）（0XE5）
- COMMAND TYPE=0XE5，DATAF=1字节（第一控制字，D7-D0）：

| BIT位 | 控制说明 |
|-------|----------|
| D7 | 0=不监控门开关，1=监控（非正常开门/未关门/无机械关门动作报警） |
| D6 | 0=不监控红外，1=监控（非法进入报警，合法进入自动关闭） |
| D5 | 0=电磁锁断电/加电自动锁闭，1=需机械“开门-关门”动作锁闭 |
| D4 | 0=允许手动开门（短接电源地线），1=禁止 |
| D3 | 0=开门时门磁短路，关门时开路；1=开门时门磁开路，关门时短路 |
| D2 | 0=红外报警时短路，正常时开路；1=红外报警时开路，正常时短路 |
| D1 | 0=刷卡合法直接开门，1=刷卡后需密码确认 |
| D0 | 0=禁止键盘<ENT>键开门，1=允许 |

#### 4.4.7 联动及报警输出特性（0XFC）
- COMMAND TYPE=0XFC，DATAF=1字节（第二控制字，D7-D0）：

| BIT位 | 控制说明 |
|-------|----------|
| D7 | 联动输入CPLD1的有效电平 |
| D6 | 联动输入CPLD2的有效电平 |
| D5-D4 | 联动输入CPLD1/CPLD2的响应动作 |
| D3 | 0=报警时ALARM输出导通，1=开路 |
| D2 | 1=刷卡时主动上传维根数据，0=禁止 |
| D1 | 1=紧急事件输入闭合时闭门，0=常开 |
| D0 | 1=允许ID+密码开门，0=禁止 |

#### 4.4.8 整体设定（1）（0XE5）
- COMMAND TYPE=0XE5，DATAF=2字节：
  | 第1字节 | 第2字节 |
  |---------|---------|
  | 第一控制字（4.4.6节） | 第二控制字（4.4.7节） |

#### 4.4.9 整体设定（2）（0XE5）
- COMMAND TYPE=0XE5，DATAF=5字节：
  | 第1字节 | 第2字节 | 第3字节 | 第4字节 | 第5字节 |
  |---------|---------|---------|---------|---------|
  | 第一控制字 | 门锁继电器时间 | 开门延时时间 | 红外报警确认时间 | 异地报警延时时间 |

#### 4.4.10 整体设定（3）（0XE5）
- COMMAND TYPE=0XE5，DATAF=6字节：
  | 第1-5字节 | 第6字节 |
  |-----------|---------|
  | 同整体设定（2） | 第二控制字 |

#### 4.4.11 设定红外感应器在报警时的有效电平（0XF6）
- COMMAND TYPE=0XF6，DATAF=1字节；
- 0=低电平有效（继电器吸合），1=高电平有效（继电器断开）。

#### 4.4.12 设定门开关感应器在开门状态时的有效电平（0XF7）
- COMMAND TYPE=0XF7，DATAF=1字节；
- 0=低电平有效（继电器吸合），1=高电平有效（继电器断开）。

#### 4.4.13 设定门控电磁锁的（种类）特性（0XF9）
- COMMAND TYPE=0XF9，DATAF=1字节；
- 0=断电/加电自动锁闭（电控阴锁口），1=需机械动作锁闭（电脉冲锁）。

#### 4.4.14 设置系统支持维根感应头的种类及卡片编号的获取方法（0XEE）
- COMMAND TYPE=0XEE，DATAF=1字节：
  | D3-D0（维根类型） | D7-D4（卡号获取方式） |
  |-------------------|-----------------------|
  | 0=维根26，1=维根36，2=维根44，3=维根34 | 0=全部BIT，1=去校验位取全部，2=去校验位取低2字节，3=低3字节，4=低4字节，5=低5字节 |

#### 4.4.15 设定系统使用的感应卡种类（0XF2）
- COMMAND TYPE=0XF2，DATAF=1字节；
- 0=维根26，1=维根36，2=维根44，3=维根34（其它值无效）。

#### 4.4.16 设定系统感应卡编号的获取方法（0XF3）
- COMMAND TYPE=0XF3，DATAF=1字节；
- 与4.4.14节D7-D4定义一致。

### 4.5 设定门控器工作方式
#### 4.5.1 启用或关闭CHD805键盘<ENT>开门许可（0XF4）
- COMMAND TYPE=0XF4，DATAF=1字节；
- 0=关闭，1=启用。

#### 4.5.2 设定是否刷卡加密码（0XF5）
- COMMAND TYPE=0XF5，DATAF=1字节；
- 0=刷卡合法+准进时段即可开门，1=需额外输入用户密码。

#### 4.5.3 启用或关闭“手动开门按键”输入（0XF8）
- COMMAND TYPE=0XF8，DATAF=1字节；
- 0=启用，1=关闭（注意：与常规逻辑相反）。

#### 4.5.4 红外监控的布防与撤防（0XFA）
- COMMAND TYPE=0XFA，DATAF=1字节；
- 0=关闭监视，1=打开监视。

#### 4.5.5 门开关状态监控的布防与撤防（0XFB）
- COMMAND TYPE=0XFB，DATAF=1字节；
- 0=关闭监视，1=打开监视。

#### 4.5.6 布防与撤防（第一控制字）（0XE5）
- 同4.4.6节“门磁、红外等感应器的特性”，DATAF=1字节第一控制字。

#### 4.5.7 设定控制器的第二控制字（0XFC）
- 同4.4.7节“联动及报警输出特性”，DATAF=1字节第二控制字。

#### 4.5.8 设定控制器的第三控制字（0XFD）
- COMMAND TYPE=0XFD，DATAF=1字节（第三控制字，D7-D0）：

| BIT位 | 控制说明 |
|-------|----------|
| D7 | 1=启用常闭门时段，0=禁用 |
| D6 | 1=启用常开门时段（节假日/休息日除外），0=禁用 |
| D5 | 0=检查一般用户准进时段，1=不检查 |
| D4 | 0=检查一般用户有效期，1=不检查 |
| D3 | 1=开启胁迫报警，0=关闭 |
| D2 | 1=启用刷卡+密码时段，0=禁用 |
| D1 | 1=分体刷卡头需密码，0=无需 |
| D0 | 1=主体刷卡头需密码，0=无需 |

### 4.6 节假日管理
#### 4.6.1 设定星期内的休息日（0XEA）
- COMMAND TYPE=0XEA，DATAF=2字节（1-7，代表星期内休息日）；
- 例：7,0XFF=仅星期日休息。

#### 4.6.2 设定国家法定节假日（0XEB）
- COMMAND TYPE=0XEB，DATAF=2字节（MM-DD，BCD格式）；
- 最多存储40个节假日。

#### 4.6.3 删除一组节假日（0XEC）
- COMMAND TYPE=0XEC，DATAF=2字节（MM-DD，BCD格式）；
- 响应：RTN=0（删除成功），RTN=E5H（无该组节假日）。

#### 4.6.4 清空节假日列表（全部删除）（0XEC）
- COMMAND TYPE=0XEC，DATAF=2字节全00；
- 响应：RTN=0（删除成功），RTN=E4H（列表已空）。

### 4.7 记录区的管理
#### 4.7.1 初始化记录区（清空记录）（0XF0）
- COMMAND TYPE=0XF0，DATAF=5字节全0；
- 功能：清空所有历史记录。

#### 4.7.2 设定读指针（0XF0）（修改）
- COMMAND TYPE=0XF0，DATAF=5字节：
  | 4字节LOADP（低字节在前） | 1字节MF |
  |---------------------------|----------|
  | 下一次读取记录位置 | D7=记录区已满位，D0=覆盖位 |

#### 4.7.3 设定整个记录区指针（0XF0）（修改）
- COMMAND TYPE=0XF0，DATAF=9字节：
  | 4字节SAVEP（低字节在前） | 4字节LOADP（低字节在前） | 1字节MF |
  |---------------------------|---------------------------|----------|
  | 下一条记录存储位置 | 下一次读取记录位置 | D7=1允许读取全部记录，D7=0允许读取0至SAVEP-1 |

### 4.8 远程开关门
#### 4.8.1 单一放行（不带系统操作员信息）（0XED）
- COMMAND TYPE=0XED，DATAF=1字节；
- 1=开门，0=不操作。

#### 4.8.2 单一放行（带系统操作员信息）（0XED）
- COMMAND TYPE=0XED，DATAF=6字节：
  | 第1字节（1=开门，0=不操作） | 后5字节操作员编号 |
  |-----------------------------|-------------------|
  | 操作标识 | 存储于远程开门记录 |

#### 4.8.3 远程命令开门（立即常开一段时间）（0XFE）
- COMMAND TYPE=0XFE，DATAF=2字节；
- 第1字节=0（固定），第2字节=常开时间（1-255分钟）。

#### 4.8.4 远程命令门停止常开（0XFE）
- COMMAND TYPE=0XFE，DATAF=2字节；
- 第1字节=0（固定），第2字节=0（停止常开）。

#### 4.8.5 远程命令门立即常闭一段时间（布防）（0XFE）
- COMMAND TYPE=0XFE，DATAF=2字节；
- 第1字节=1（固定），第2字节=常闭时间（1-255分钟，期间不接受刷卡开门）。

#### 4.8.6 远程命令取消常闭（撤防）（0XFE）
- COMMAND TYPE=0XFE，DATAF=2字节；
- 第1字节=1（固定），第2字节=0（取消常闭）。

#### 4.8.7 声光报警器状态查询（0XFF）
- COMMAND TYPE=0XFF，DATAF=2字节；
- 第1字节=0（固定），第2字节=0（查询）；
- 响应：RTN=0（无告警），RTN=1（正在告警），RTN=2（未启用告警）。

#### 4.8.8 无条件启动声光报警器（0XFF）
- COMMAND TYPE=0XFF，DATAF=2字节；
- 第1字节=1（固定），第2字节=0（启动）。

#### 4.8.9 无条件停止声光报警器（0XFF）
- COMMAND TYPE=0XFF，DATAF=2字节；
- 第1字节=2（固定），第2字节=0（停止）。

#### 4.8.10 无条件禁用声光报警器（0XFF）
- COMMAND TYPE=0XFF，DATAF=2字节；
- 第1字节=3（固定），第2字节=0（禁用）。

#### 4.8.11 启用声光报警器（0XFF）
- COMMAND TYPE=0XFF，DATAF=2字节；
- 第1字节=4（固定），第2字节=0（启用）。

### 4.9 设置管理时段
#### 4.9.1 设置工作日内门常开时段（0XE2）
- COMMAND TYPE=0XE2，DATAF=17字节；
- 第1字节=5（固定），GROUP No.=1字节，16字节时段描述（4组“起始时间-结束时间”）；
- 功能：工作日内指定时段门常开，无需刷卡（节假日/休息日无效）。

#### 4.9.2 设置一天内门常闭时段（0XE2）
- COMMAND TYPE=0XE2，DATAF=17字节；
- 第1字节=7（固定），GROUP No.=1字节，16字节时段描述（4组“起始时间-结束时间”）；
- 功能：指定时段门常闭，刷卡无效。

#### 4.9.3 设置自动开启对红外、门开关的监控时段（0XE2）
- COMMAND TYPE=0XE2，DATAF=17字节；
- 第1字节=8（固定），GROUP No.=1字节，16字节时段描述（4组“起始时间-结束时间”）；
- 功能：指定时段自动监控门开关及红外。

#### 4.9.4 设置一天内二次加密时段（0XE2）
- COMMAND TYPE=0XE2，DATAF=17字节；
- 第1字节=6（固定），GROUP No.=1字节，16字节时段描述（4组“起始时间-结束时间”）；
- 功能：指定时段刷卡需输入个人密码（节假日/休息日同样生效）。

### 4.10 布防与撤防
#### 4.10.1 红外监控的布防与撤防（0XFA）
- 同4.5.4节，COMMAND TYPE=0XFA，DATAF=1字节（0=关闭，1=打开）。

#### 4.10.2 门开关状态监控的布防与撤防（0XFB）
- 同4.5.5节，COMMAND TYPE=0XFB，DATAF=1字节（0=关闭，1=打开）。

#### 4.10.3 设置自动开启对红外、门开关的监控时段（自动监控布防）（0XE2）
- 同4.9.3节。

#### 4.10.4 设置一天内门常闭时段（自动闭门布防）（0XE2）
- 同4.9.2节。

#### 4.10.5 远程命令即时布防（闭门布防）（0XFE）
- 同4.8.5节。

#### 4.10.6 远程命令撤消常闭安防（0XFE）
- 同4.8.6节。

#### 4.10.7 准进（二次加密）限制（布防）（0XE2）
- 同4.9.4节。

#### 4.10.8 布防撤防控制字
- 参考4.5.6（第一控制字）、4.5.7（第二控制字）、4.5.8（第三控制字）节。

### 4.11 设置DI3功能参数（0XD0）
- COMMAND TYPE=0XD0，DATAF=1字节；
- 0=不使用，1=作红外通道，2=消防告警联动通道，3=钥匙开门检测通道。

### 4.12 设置授权参数（0XD1）
- COMMAND TYPE=0XD1，DATAF=16字节；
- 功能：设置设备授权认证信息。

### 4.13 恢复出厂设置（0XD2）
- COMMAND TYPE=0XD2，DATAF=0字节；
- 功能：擦除整片FLASH，恢复默认参数。

## 5. 读取信息命令（0x4A）
SU可随时读取SM的历史记录、监控状态等信息，命令帧CID2=4AH，COMMAND INFO格式如下：

| COMMAND GROUP | COMMAND TYPE | DATAF |
|---------------|-------------|------|
| 0XF2 | 0XE0至0XEF | 1字节（读取记录命令时为2字节） |

### 5.1 读取SM的实时钟（0XE0）
- COMMAND TYPE=0XE0，DATAF=1字节=0；
- 响应DATAINFO=8字节BCD（年2+月1+日1+星期1+时1+分1+秒1），年范围2000-2099。

### 5.2 读取记录信息
#### 5.2.1 读取历史记录柜桶参数（0XE1）
- COMMAND TYPE=0XE1，DATAF=1字节=0；
- 响应DATAINFO=9字节：
  | 2字节BOTTOM（桶底） | 2字节SAVEP（新记录存储指针） | 2字节LOADP（读取指针） | 1字节MF（修改标志） | 2字节MAXLEN（最大记录数） |
  |----------------------|-------------------------------|-------------------------|----------------------|---------------------------|
  | 记录区起始地址（默认0） | 下一条记录存储位置 | 下一次读取位置 | D7=记录区已满，D0=覆盖位 | 固定为存储最大空间 |

#### 5.2.2 顺序读取一条历史记录（0XE2）
- COMMAND TYPE=0XE2，DATAF无或1字节（无定义）；
- 功能：从LOADP位置读取一条记录，LOADP自动+1；
- 响应DATAINFO=14字节（事件来源5+日期时间7+状态1+备注1），参考附录。

#### 5.2.3 随机读取记录（指定位置读取）（0XE2）
- COMMAND TYPE=0XE2，DATAF=2字节（低位在前，指定LOADP位置）；
- 功能：读取指定位置记录，不修改原LOADP；
- 响应DATAINFO=14字节，无效位置返回错误。

#### 5.2.4 附带顺序号读取记录（防止丢失记录）（0XEE）
- COMMAND TYPE=0XEE，DATAF=1字节=1；
- 响应DATAINFO=16字节（2字节LOADP值+14字节记录）。

#### 5.2.5 查询控制器的最新事件记录（0XEE）
- COMMAND TYPE=0XEE，DATAF=1字节=0；
- 响应DATAINFO=14字节（最新事件记录，含刷卡、告警、手动开门等）。

### 5.3 读取时段
#### 5.3.1 读取一组工作日准进时段（0XE3）
- COMMAND TYPE=0XE3，DATAF=1字节（1-4，指定组号）；
- 响应DATAINFO=16字节（4组“起始时间-结束时间”）。

#### 5.3.2 读取非工作日准进时段（0XE4）
- COMMAND TYPE=0XE4，DATAF=1字节=1；
- 响应DATAINFO=16字节（4组“起始时间-结束时间”）。

#### 5.3.3 读取星期一至星期日的准进时间表（0XEB）
- COMMAND TYPE=0XEB，DATAF=2字节（表号0-15+星期1-7）；
- 响应DATAINFO=24字节（6个准进时段，每组4字节BCD）。

#### 5.3.4 读取工作日内常开门时段（0XE4）
- COMMAND TYPE=0XE4，DATAF=1字节=5；
- 响应DATAINFO=16字节（4组“起始时间-结束时间”）。

#### 5.3.5 读取常闭门时段（0XE4）
- COMMAND TYPE=0XE4，DATAF=1字节=7；
- 响应DATAINFO=16字节（4组“起始时间-结束时间”）。

#### 5.3.6 读取刷卡加密码（二次加密）时段（0XE4）
- COMMAND TYPE=0XE4，DATAF=1字节=6；
- 响应DATAINFO=16字节（4组“起始时间-结束时间”）。

#### 5.3.7 读取红外、门磁自动布防时段（0XE4）
- COMMAND TYPE=0XE4，DATAF=1字节=8；
- 响应DATAINFO=16字节（4组“起始时间-结束时间”）。

### 5.4 读取用户信息
#### 5.4.1 读取已存储的用户数目（0XE5）
- COMMAND TYPE=0XE5，DATAF=1字节=0；
- 响应DATAINFO=2字节HEX（低字节在前，高字节在后），0000表示无用户。

#### 5.4.2 读取指定存储位置的用户登记资料（0XE6）
- COMMAND TYPE=0XE6，DATAF=2字节HEX（低位在前，指定存储位置）；
- 响应DATAINFO=16字节（卡号5+ID4+密码2+有效期4+权限1）；
- 无权限时RTN=E0H，无DATAINFO。

#### 5.4.3 查询指定用户编号（ID）的用户是否存在（0XE6）
- COMMAND TYPE=0XE6，DATAF=4字节用户ID；
- 响应DATAINFO=16字节（用户完整信息）；
- 无权限时RTN=E0H，无DATAINFO。

#### 5.4.4 查询指定卡号的用户卡是否存在（0XE6）
- COMMAND TYPE=0XE6，DATAF=6字节卡号；
- 响应DATAINFO=16字节（用户完整信息）；
- 无权限时RTN=E0H，无DATAINFO。

### 5.5 读取休息日、节假日
#### 5.5.1 读取星期内休息日（0XE9）
- COMMAND TYPE=0XE9，DATAF=1字节=0；
- 响应DATAINFO=2字节（1-7，代表休息日，非有效值无意义）。

#### 5.5.2 读取节假日（星期内休息日除外）（0XEA）
- COMMAND TYPE=0XEA，DATAF=1字节=0；
- 响应DATAINFO=1字节（节假日个数N）+2×N字节（MM-DD，BCD格式）。

### 5.6 远程监控（0XE7）
#### 方法1：COMMAND TYPE=0XE7，DATAF=1字节=0
响应DATAINFO=2字节：
- 第一字节（工作状态）：
  | BIT位 | 说明 |
  |-------|------|
  | D7 | 0=实时钟正常，1=异常 |
  | D6 | 0=存储器正常，1=异常 |
  | D5 | 0=电源正常，1=异常（电压低导致CPU复位） |
  | D4 | 保留 |
  | D3 | 0=不监控红外，1=监控 |
  | D2 | 0=不监控门开关，1=监控 |
  | D1 | 0=继电器关闭，1=加电驱动 |
  | D0 | 0=正常工作，1=报警状态 |

- 第二字节（线路状态）：
  | BIT位 | 说明 |
  |-------|------|
  | D7 | 紧急驱动输入 |
  | D6 | 联动输入2 |
  | D5 | 联动输入1 |
  | D4 | 0=联动输出继电器关闭，1=加电驱动 |
  | D3 | 0=门关闭，1=开启 |
  | D2 | 0=红外正常，1=报警 |
  | D1 | 0=手动按键松开，1=按下 |
  | D0 | 0=继电器关闭，1=加电驱动 |

#### 方法2：COMMAND TYPE=0XED，DATAF=1字节=0
响应DATAINFO=7字节：
- 第1字节（状态标志）：
  | BIT位 | 说明 |
  |-------|------|
  | D7 | 0=门常开无效，1=门常开 |
  | D6 | 0=门常闭无效，1=门常闭 |
  | D5 | 0=第2继电器未动作，1=动作 |
  | D4 | 0=消防联动无效，1=有效 |
  | D3 | 0=不监控门磁，1=监控 |
  | D2 | 0=不监控红外，1=监控 |
  | D1 | 0=门控继电器未动作，1=动作 |
  | D0 | 0=无报警输出，1=报警输出 |

- 第2字节（输入状态）：
  | BIT位 | 说明 |
  |-------|------|
  | D7 | 第二感应头对应门状态 |
  | D6 | IR/ID联动状态 |
  | D5 | HANDLE联动状态 |
  | D4 | 保留 |
  | D3 | 0=第一感应头门关闭，1=开启 |
  | D2 | IR/ID输入状态 |
  | D1 | HANDLE输入状态 |
  | D0 | 保留 |

- 第3-4字节：SAVEP（新记录存储指针）；
- 第5-6字节：LOADP（读取指针）；
- 第7字节：MF（修改标志）。

### 5.7 读取工作特性参数
#### 5.7.1 读取控制信息（0XE8）
##### 方法1：COMMAND TYPE=0XE8，DATAF=1字节=0
响应DATAINFO=5字节：
- 第1字节：第一控制字（同4.4.6节）；
- 第2字节：门锁继电器执行时间（0.1秒）；
- 第3字节：开门延时时间（0.1秒）；
- 第4字节：红外报警确认时间（0.1秒）；
- 第5字节：卡号获取方法控制字（同4.4.14节）。

##### 方法2：COMMAND TYPE=0XE8，DATAF=1字节=1
响应DATAINFO=6字节（前5字节同方法1，第6字节=异地报警驱动时间，0.1秒）。

##### 方法3：COMMAND TYPE=0XE8，DATAF=1字节=2
响应DATAINFO=30字节（控制器核心参数，含控制字、延时时间、地址、波特率等）。

#### 5.7.2 读取第二、第三控制字节（0XEC）
##### 方法1：COMMAND TYPE=0XEC，DATAF=1字节=0
响应DATAINFO=2字节：
- 第1字节：第二控制字（同4.4.7节）；
- 第2字节：第三控制字（同4.5.8节）。

##### 方法2：COMMAND TYPE=0XEC，DATAF=1字节=1
响应DATAINFO=4字节（前2字节同方法1，后2字节为备份）。

### 5.8 读取设备名称及版本号（0XEF）
- COMMAND TYPE=0XEF，DATAF=1字节=0；
- 响应格式：ACUC_MAINER-V3.xx.xxx-HW:x.xx；
- 说明：ACUC_MAINER=IC卡维护卡座，ACUC_READER=IC卡读卡器，ACUC_CTRLER=IC卡控制器；V3.xx.xxx=软件版本，HW:x.xx=硬件版本。

### 5.9 通信命令中的参数说明
1. 日期时间均为BCD格式（例：0X10=10月/10时）；
2. 数值/地址参数均为低字节在前、高字节在后（HEX/BCD格式）；
3. CID1高4位=8（门禁类），低4位=分组号（0-15），支持分组扩展。

### 5.10 读取DI3功能参数（0XD0）
- COMMAND TYPE=0XD0，DATAF=1字节；
- 响应DATAINFO=1字节（0=不使用，1=红外通道，2=消防联动，3=钥匙检测）。

### 5.11 读取授权信息（0XD1）
- COMMAND TYPE=0XD1，DATAF=0字节；
- 响应DATAINFO=16字节（设备授权认证信息）。

### 5.12 读取DI原始值（0XD2）
- COMMAND TYPE=0XD2，DATAF=0字节（生产自测用）；
- 响应DATAINFO=2字节（BIT位=1表示DI高电平，0表示低电平/不存在）。

## 6. 附录: 门控器(SM)的历史记录格式
每条记录14字节，格式：`事件来源(5字节) + 日期时间(7字节) + 状态(1字节) + 备注(1字节)`

### 备注字节（D7-D0）
- D7=0：记录未被SU读取；
- D7=1：记录已被SU读取。

### 常见记录类型（REMARK值）
| REMARK值 | 记录类型 | 事件来源 | 状态（STATUS）说明 |
|----------|----------|----------|-------------------|
| 0 | 刷卡开门 | 5字节卡号 | D7=0（未验密码）/1（已验），D6=门原状态，D5=是否进入，D4=是否关门 |
| 1 | ID+密码开门 | 00H+4字节ID | D7=1（已验密码），其余同REMARK=0 |
| 2 | 远程开门 | 5字节全0 | 同REMARK=0（D1=0） |
| 3 | 手动开门 | 5字节全0 | 同REMARK=0（D1=0） |
| 4 | 联动开门 | 5字节全0 | 同REMARK=0 |
| 5 | 报警/取消 | 4字节全0+1字节报警源 | AS=0（红外报警开始）/1（停止），2（非正常开门）等 |
| 6 | 掉电记录 | 重新上电时间（月/日/时/分/秒） | 上电时输入线状态 |
| 7 | 参数修改 | 4字节全0+1字节修改标记 | D0=改密码，D1=改门参数，D2=加用户等 |
| 8 | 无效卡刷卡 | 5字节卡号 | 同报警记录状态 |
| 9 | 卡过期 | 5字节卡号 | 同报警记录状态 |
| 10 | 无进权限 | 5字节卡号 | 同报警记录状态 |
| 11 | 密码三次错误 | 5字节卡号 | 同报警记录状态 |
| 22H | 消防联动开始/结束 | 5字节全0/00001 | 同报警记录状态 |
| 30H | 钥匙开门 | 5字节全0 | D6=门原状态，D5=是否进入，D4=是否关门 |

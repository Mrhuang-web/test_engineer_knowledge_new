# 01功能说明

```
仅做数据中心-核心机楼（通信枢纽楼）下的设备
	动环设备数据 - 与综资对应设备静态参数匹配
	同步周期如下
```

| ***\*设备类型\**** | ***\*设备子类\****                                           | ***\*更新周期\**** |
| ------------------ | ------------------------------------------------------------ | ------------------ |
| 变压器             | 全部                                                         | 15年               |
| 高压配电           | 全部                                                         | 15年               |
| 高压直流电源       | 全部                                                         | 10年               |
| 高压直流配电       | 全部                                                         | 15年               |
| 低压交流配电       | 全部                                                         | 15年               |
| 发电机组           | 全部                                                         | 15年               |
| 开关电源           | 全部                                                         | 12年               |
| 低压直流配电       | 全部                                                         | 15年               |
| UPS设备            | 全部                                                         | 10年               |
| 蓄电池             | 1.UPS铅酸电池                                                | 6年                |
|                    | 2.操作电源铅酸电池                                           | 8年                |
|                    | 3.发电机组铅酸电池                                           | 6年                |
|                    | 4.高压直流铅酸电池                                           | 8年                |
|                    | 5.开关电源锂电池                                             | 10年               |
|                    | 6.开关电源铅酸电池                                           | 8年                |
|                    | 7.直流屏铅酸电池                                             | 8年                |
| 空调               | 1.设备类型为普通空调时更新周期6年；                          | 6年                |
|                    | 2.设备类型为其他（机房专用空调、中央空调末端），设备子类为恒湿机、柜式空调 | 6年                |
|                    | 3.设备子类为风冷专用空调                                     | 8年                |
|                    | 4.设备类型为其他（机房专用空调、中央空调末端），设备子类为列间空调、嵌入式空调、热管背板、双冷源专用空调、水冷专用空调 | 10年               |
| 动环监控           | 1.设备子类为FSU、CSC、LSC                                    | 5年                |
|                    | 2.设备子类为蓄电池采集设备                                   | 8年                |

 

# 02数据来源

```
1、数据均来自于es（通过 zz_data_sync_info配置的批次号，到es中匹配对应月份下对应批次然后回显）
2、目前除了空间_数据中心是取动环数据库，其他都是走es
3、映射表、zz_data_sync_info（需要先修正好批次号）


涉及服务：
	hidden服务（后端明林，前端贵荣）
    composite-service,


涉及表：
    overdue_device_detail 超期服役-设备详情表’;
		有sys_device_id才会显示【这个是综资的设备id,需要用这个id结合触发curl,来实现与动环的关联】	
	overdue_device_type_dict 超期服役-配置字典表； — 20231108 逻辑从代码迁移到数据库表配置完成
	overdue_device_alert_monthly 超期服役-设备月度告警频次表’;


涉及curl：
	# 一次执行全部,但是会按顺序执行
	curl --location --request GET 'http://localhost:28028/v1/hiddenDanger/startOverdueAll'
	# 仅执行详情表
	curl --location --request GET  "http://localhost:28028/v1/hiddenDanger/startOverdue1"
    2.定时任务默认配置
        ${
            overdue.cron:0 0 4 * * ?
        }
    3、告警触发
        curl --location --request GET 'http://localhost:28028/v1/hiddenDanger/startOverdueAlert?202508'



主要逻辑：
	1、站点-机房与综资进行匹配
	2、匹配之后返回动环的站点名称-类型-机房-地市这些（其余的就是综资的设备数据）
	3、根据动环系统设备id来绑定动环设备（进行设备的故障告警频次统计） - 统计告警是根据es,alert告警索引来判断的[需要插入es的alert索引]
	前期测试问题：
		测试环境设备无power_device_id字段导致无法实现匹配，现在应该是拉了新的，是可以匹配到的了
	其余字段要求，看需求即可
	
	疑问：
		直接通过precinct_id 和 dh_id匹配就行了？，不需要匹配综资吗（不用关zz_data同步是吧，这块不影响？）
	

数据对应：
	overdue_device_detail表：
		device_code - 对应es设备中的res_code
```

# 03es查询语法

```
{
  "query": {
    "term": {
      "zh_label.keyword": {
        "value": "抚顺沈抚新城通信楼8层IDC机房-低压交流配电-7883"
      }
    }
  },
  "size": 10
}
```

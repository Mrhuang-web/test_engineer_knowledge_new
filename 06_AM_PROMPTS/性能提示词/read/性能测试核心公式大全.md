# 性能测试核心公式大全

## 一、响应时间相关公式

### 1. 平均响应时间（ART - Average Response Time）

**公式**：
```
ART = 总响应时间之和 / 总请求数
```

**符号说明**：
- `总响应时间之和`：所有请求的响应时间累加
- `总请求数`：测试期间发送的总请求数量

**应用场景**：
- 衡量系统的整体响应速度
- 评估用户的平均等待时间

**计算示例**：
- 10个请求的响应时间分别为：100ms, 200ms, 150ms, 300ms, 250ms, 180ms, 220ms, 190ms, 210ms, 230ms
- 总响应时间之和 = 100+200+150+300+250+180+220+190+210+230 = 2030ms
- 平均响应时间 = 2030ms / 10 = 203ms

### 2. 百分位数响应时间（Percentile Response Time）

**公式**：
- P50（中位数）：将所有响应时间从小到大排序，第50%位置的响应时间
- P90：将所有响应时间从小到大排序，第90%位置的响应时间
- P95：将所有响应时间从小到大排序，第95%位置的响应时间
- P99：将所有响应时间从小到大排序，第99%位置的响应时间

**符号说明**：
- Pxx：表示xx%的请求响应时间小于等于该值

**应用场景**：
- 更准确地反映大多数用户的体验
- 识别系统中的长尾延迟问题

**计算示例**：
- 10个请求的响应时间排序后：100ms, 150ms, 180ms, 190ms, 200ms, 210ms, 220ms, 230ms, 250ms, 300ms
- P50 = 第5个和第6个的平均值 = (200+210)/2 = 205ms
- P90 = 第9个值 = 250ms
- P95 = 第9.5个值 = (250+300)/2 = 275ms
- P99 = 第9.9个值 = 300ms

### 3. 响应时间标准差（Standard Deviation of Response Time）

**公式**：
```
σ = √[Σ(xi - μ)² / N]
```

**符号说明**：
- `σ`：标准差
- `xi`：单个请求的响应时间
- `μ`：平均响应时间
- `N`：总请求数

**应用场景**：
- 衡量响应时间的波动程度
- 评估系统的稳定性
- 标准差越小，系统响应越稳定

**计算示例**：
- 平均响应时间μ = 203ms（来自上面的示例）
- 方差 = [(100-203)² + (200-203)² + ... + (230-203)²] / 10
- 方差 = [10609 + 9 + 2809 + 9409 + 2209 + 529 + 289 + 169 + 49 + 729] / 10
- 方差 = 26810 / 10 = 2681
- 标准差σ = √2681 ≈ 51.78ms

## 二、吞吐量相关公式

### 1. TPS（Transactions Per Second）- 事务每秒

**公式1：基于总请求数**
```
TPS = 总请求数 / 测试持续时间（秒）
```

**公式2：基于并发用户数**
```
TPS = (并发用户数 × 1000) / 平均响应时间（ms）
```

**符号说明**：
- `总请求数`：测试期间完成的总请求数量
- `测试持续时间`：测试运行的总时间（秒）
- `并发用户数`：同时发送请求的用户数量
- `平均响应时间`：单个请求的平均处理时间（ms）

**应用场景**：
- 衡量系统的整体处理能力
- 评估系统的吞吐量上限

### 2. RPS（Requests Per Second）- 请求每秒

**公式**：
```
RPS = 总请求数 / 测试持续时间（秒）
```

**符号说明**：
- 同TPS公式1

**应用场景**：
- 衡量API接口的请求处理能力
- 适用于单个请求即为一个事务的场景

**与TPS的区别**：
- TPS关注的是业务事务，一个事务可能包含多个请求
- RPS关注的是HTTP请求，每个请求独立计算

### 3. 吞吐量（Throughput）- 数据传输速率

**公式**：
```
Throughput = 总数据量（字节） / 测试持续时间（秒）
```

**符号说明**：
- `总数据量`：所有请求和响应的数据大小总和
- `测试持续时间`：测试运行的总时间（秒）

**应用场景**：
- 衡量网络传输能力
- 评估系统的带宽使用情况
- 单位：通常以Mbps（兆位每秒）表示

**转换公式**：
```
Throughput(Mbps) = [总数据量（字节） × 8] / [测试持续时间（秒） × 10^6]
```

### 4. 点击率（Hit Rate）

**公式**：
```
Hit Rate = 总HTTP请求数 / 测试持续时间（秒）
```

**符号说明**：
- `总HTTP请求数`：测试期间发送的所有HTTP请求数量（包括静态资源请求）

**应用场景**：
- 衡量Web应用的页面访问热度
- 评估服务器的HTTP请求处理能力

## 三、并发用户数相关公式

### 1. 并发用户数（Concurrent Users）

**公式1：基于TPS和响应时间**
```
并发用户数 = (TPS × 平均响应时间（ms）) / 1000
```

**公式2：基于在线用户数**
```
并发用户数 = 在线用户数 × 会话期间请求数 / 会话持续时间（秒）
```

**符号说明**：
- `在线用户数`：系统中同时在线的用户数量
- `会话期间请求数`：单个用户在一个会话中发送的请求数量
- `会话持续时间`：单个用户会话的平均持续时间（秒）

**应用场景**：
- 估算系统需要支持的并发用户数量
- 规划系统的硬件配置

**计算示例**：
- 在线用户数：1000人
- 每个用户会话平均持续时间：300秒（5分钟）
- 每个会话平均发送请求数：60个
- 并发用户数 = 1000 × 60 / 300 = 200人

### 2. 峰值并发用户数（Peak Concurrent Users）

**公式**：
```
峰值并发用户数 = 平均并发用户数 × 峰值系数
```

**符号说明**：
- `平均并发用户数`：系统在正常情况下的平均并发用户数
- `峰值系数`：根据业务特点设定，通常为1.5-3.0

**应用场景**：
- 评估系统在峰值负载下的表现
- 设计系统的容灾能力

**计算示例**：
- 平均并发用户数：1000人
- 峰值系数：2.0
- 峰值并发用户数 = 1000 × 2.0 = 2000人

## 四、资源利用率相关公式

### 1. CPU利用率（CPU Utilization）

**公式**：
```
CPU利用率 = (CPU工作时间 / 总时间) × 100%
```

**符号说明**：
- `CPU工作时间`：CPU处于运行状态的时间
- `总时间`：统计的总时间段

**应用场景**：
- 衡量CPU资源的使用情况
- 识别CPU瓶颈

**计算示例**：
- 测试持续时间：60秒
- CPU工作时间：45秒
- CPU利用率 = (45 / 60) × 100% = 75%

### 2. 内存利用率（Memory Utilization）

**公式**：
```
内存利用率 = (已使用内存 / 总内存) × 100%
```

**符号说明**：
- `已使用内存`：当前系统已使用的内存大小
- `总内存`：系统的总物理内存大小

**应用场景**：
- 衡量内存资源的使用情况
- 识别内存泄漏问题

### 3. 磁盘利用率（Disk Utilization）

**公式**：
```
磁盘利用率 = (已使用磁盘空间 / 总磁盘空间) × 100%
```

**符号说明**：
- `已使用磁盘空间`：磁盘已使用的空间大小
- `总磁盘空间`：磁盘的总容量

**应用场景**：
- 衡量磁盘空间的使用情况
- 评估磁盘I/O瓶颈

### 4. 磁盘I/O利用率

**公式**：
```
磁盘I/O利用率 = (实际I/O传输速率 / 最大I/O传输速率) × 100%
```

**符号说明**：
- `实际I/O传输速率`：磁盘实际的读写速率
- `最大I/O传输速率`：磁盘的理论最大读写速率

**应用场景**：
- 衡量磁盘I/O的繁忙程度
- 识别磁盘I/O瓶颈

### 5. 网络利用率（Network Utilization）

**公式**：
```
网络利用率 = (实际网络吞吐量 / 最大网络带宽) × 100%
```

**符号说明**：
- `实际网络吞吐量`：测试期间的实际网络传输速率
- `最大网络带宽`：网络链路的最大理论带宽

**应用场景**：
- 衡量网络资源的使用情况
- 识别网络瓶颈

## 五、错误率相关公式

### 1. 错误率（Error Rate）

**公式1：基于总请求数**
```
错误率 = (错误请求数 / 总请求数) × 100%
```

**公式2：基于成功请求数**
```
错误率 = (错误请求数 / (成功请求数 + 错误请求数)) × 100%
```

**符号说明**：
- `错误请求数`：测试期间失败的请求数量
- `成功请求数`：测试期间成功的请求数量
- `总请求数`：成功请求数 + 错误请求数

**应用场景**：
- 衡量系统在压力下的稳定性
- 评估系统的可靠性

**计算示例**：
- 总请求数：1000
- 错误请求数：50
- 错误率 = (50 / 1000) × 100% = 5%

### 2. 成功率（Success Rate）

**公式**：
```
成功率 = (成功请求数 / 总请求数) × 100%
```

**符号说明**：
- 同错误率公式

**应用场景**：
- 与错误率互补，更直观地反映系统的成功处理能力
- 评估系统的可用性

**计算示例**：
- 总请求数：1000
- 成功请求数：950
- 成功率 = (950 / 1000) × 100% = 95%

## 六、带宽相关公式

### 1. 所需带宽（Required Bandwidth）

**公式**：
```
所需带宽（Mbps） = (每请求数据大小 × TPS × 8) / 10^6
```

**符号说明**：
- `每请求数据大小`：单个请求和响应的数据大小总和（字节）
- `TPS`：系统的事务处理能力（每秒）
- `8`：字节到比特的转换系数
- `10^6`：比特到兆比特的转换系数

**应用场景**：
- 估算系统所需的网络带宽
- 规划网络基础设施

**计算示例**：
- 每请求数据大小：10KB = 10240字节
- TPS：1000
- 所需带宽 = (10240 × 1000 × 8) / 10^6 = 81.92 Mbps

### 2. 实际带宽使用率

**公式**：
```
实际带宽使用率 = (实际吞吐量 × 8) / (网络带宽 × 10^6) × 100%
```

**符号说明**：
- `实际吞吐量`：测试期间的实际数据传输速率（字节/秒）
- `网络带宽`：网络链路的最大带宽（Mbps）

**应用场景**：
- 衡量网络资源的实际使用情况
- 识别网络瓶颈

**计算示例**：
- 实际吞吐量：10MB/s = 10485760字节/秒
- 网络带宽：100Mbps
- 实际带宽使用率 = (10485760 × 8) / (100 × 10^6) × 100% = 83.89%

## 七、其他重要公式

### 1. 思考时间（Think Time）

**公式**：
```
思考时间 = (总测试时间 - 总处理时间) / (总请求数 - 并发用户数)
```

**符号说明**：
- `总测试时间`：测试的总持续时间
- `总处理时间`：所有请求的响应时间总和
- `总请求数`：测试期间发送的总请求数量
- `并发用户数`：同时发送请求的用户数量

**应用场景**：
- 模拟真实用户的操作间隔
- 调整并发用户数与TPS的关系

**计算示例**：
- 总测试时间：60秒
- 总处理时间：10秒
- 总请求数：100
- 并发用户数：10
- 思考时间 = (60 - 10) / (100 - 10) ≈ 0.56秒 = 560ms

### 2. 会话率（Session Rate）

**公式**：
```
会话率 = 总会话数 / 测试持续时间（秒）
```

**符号说明**：
- `总会话数`：测试期间创建的总会话数量
- `测试持续时间`：测试的总持续时间（秒）

**应用场景**：
- 衡量系统的会话处理能力
- 评估系统在高会话率下的表现

### 3. 资源争用率（Resource Contention Rate）

**公式**：
```
资源争用率 = (等待资源时间 / 总处理时间) × 100%
```

**符号说明**：
- `等待资源时间`：请求等待资源的时间总和
- `总处理时间`：所有请求的处理时间总和

**应用场景**：
- 识别系统中的资源争用问题
- 评估资源分配的合理性

### 4. 吞吐量效率（Throughput Efficiency）

**公式**：
```
吞吐量效率 = 实际TPS / 理论TPS × 100%
```

**符号说明**：
- `实际TPS`：测试中实际测得的TPS
- `理论TPS`：根据系统配置计算的理论最大TPS

**应用场景**：
- 评估系统的实际性能与理论性能的差距
- 识别系统的性能瓶颈

## 八、性能测试永恒公式汇总

### 1. 核心三角关系
```
并发用户数 = (TPS × 平均响应时间) / 1000
TPS = (并发用户数 × 1000) / 平均响应时间
平均响应时间 = (并发用户数 × 1000) / TPS
```

### 2. 扩展公式
```
总请求数 = TPS × 测试持续时间
总测试时间 = 总请求数 / TPS
```

## 九、不同场景下的公式应用

### 1. 基准测试
- 重点关注：平均响应时间、成功率、资源利用率
- 核心公式：平均响应时间、成功率、资源利用率公式

### 2. 负载测试
- 重点关注：TPS、响应时间、资源利用率
- 核心公式：TPS公式、响应时间百分位数、资源利用率公式

### 3. 压力测试
- 重点关注：最大TPS、性能拐点、错误率
- 核心公式：TPS公式、错误率公式、资源利用率公式

### 4. 稳定性测试
- 重点关注：长时间下的响应时间变化、资源利用率趋势、错误率
- 核心公式：平均响应时间、错误率、资源利用率公式

### 5. 并发测试
- 重点关注：并发用户数、响应时间、TPS
- 核心公式：并发用户数公式、TPS公式、响应时间公式

## 十、公式使用注意事项

1. **明确公式适用场景**：不同公式适用于不同的测试场景，选择合适的公式
2. **注意单位一致性**：公式中的单位要保持一致（如毫秒 vs 秒，字节 vs 比特）
3. **结合多指标分析**：单一公式的结果可能有误导性，结合多个指标综合分析
4. **考虑上下文环境**：公式结果受测试环境、数据量、业务逻辑等因素影响
5. **与业务需求结合**：性能测试结果最终要与业务需求对比，验证是否满足要求
6. **关注趋势变化**：不仅看绝对值，还要关注指标随时间或并发数的变化趋势
7. **区分理论与实际**：理论公式是估算，实际测试结果可能有差异
8. **明确统计范围**：确保公式中的输入数据来自相同的统计范围

## 十一、总结

性能测试公式是评估系统性能的重要工具，但公式只是手段，不是目的。在实际性能测试中，需要结合业务场景、系统架构、用户体验等多方面因素，综合分析测试结果。

建议在性能测试中：
1. 明确测试目标和指标
2. 选择合适的测试工具和方法
3. 正确应用性能测试公式
4. 综合分析测试结果
5. 提出针对性的优化建议

通过合理使用这些公式，可以更准确地评估系统性能，找出性能瓶颈，为系统优化提供数据支持。
# 01业务解析

```
1、分功率因数和畸变率两个tab

2、两者均通过es->fsu_20230721_01-32抽数再存储到->dws_power_harmonic_20230721_01-32
	服务：scheduledtask-service：
	curl：curl -X GET "http://localhost:28034/v1/powerAndHarmonic/getInsertEsResult?endDate=2025-12-19&precinctId=01-32-11-02-02&startDate=2025-12-22" -H "accept: application/json"
	
	或是设置nacos中定时任务
	00:50:09.006  INFO 7 --- [ MyScheduler-19] c.a.g.s.s.schedule.TimerExecutorService  : 提交任务，名称=功率因素和谐波监控定时任务,cron=0 0 2 * * ?



3、有功与无功及功率因素-区分
	功率因数是衡量用电效率的指标（范围0-1），越接近1说明电能利用率越高
    有功功率P：真正做功的功率（单位：kW）
    无功功率Q：交换但不消耗的功率（单位：kvar）

4、整定时间点
	（15分的倍数 ，一天有24*4-96个点）   -- 取值为向后15分钟内最靠近该整定时间的数据
	整定时间点：系统固定时间（如每15分钟）自动采集一次数据
	测点数值：每个时间点测到的功率数值
	null不包含：如果某次采集失败（显示null/空值），不算进统计
	举例说明：
        假设监测1小时（整定间隔15分钟）的有功功率P：
        0:00 → 30kW
        0:15 → 32kW
        0:30 → null（设备断线）
        0:45 → 28kW
        则：
            平均值 = (30 + 32 + 28) ÷ 3 = 30kW（null那次直接忽略）
            最大值 = 32kW
            最小值 = 28kW
    系统每5分钟采集一次实际数据
    	| 实际采集时间    | 采集值 |
        | --------- | --- |
        | **02:14** | 100 |
        | 02:19     | 105 |
        | **02:31** | 110 |
        | 02:36     | 108 |
        02:15这个点 → 显示100（因为02:14在[02:15-02:30)范围内，且离02:15最近）
		02:30这个点 → 显示110（因为02:31在[02:30-02:45)范围内，且离02:30最近）


5、总结：
	算功率因数时，如果拿不到总功率数据就手动加；
	算统计值时，只取正常采集的数据点，采失败的空值一律跳过
```



```
任务日志：
2023-07-27T16:36:57.929+08:00 INFO 8 —- [io-28034-exec-2] c.a.m.s.s.s.PowerAndHarmonicService : 功率因数和谐波监控插入数据至新索引开始
2023-07-27T16:37:02.166+08:00 INFO 8 —- [pool-9-thread-5] c.a.m.s.s.s.PowerAndHarmonicService : 01-32-10-04-23-01开始插入数据,数据总数1440
2023-07-27T16:37:02.200+08:00 INFO 8 —- [pool-9-thread-5] c.a.m.s.e.PowerAndHarmonicEsHelper : 创建索引—dws_power_harmonic_20230701_01-32
2023-07-27T16:37:04.030+08:00 INFO 8 —- [pool-9-thread-5] c.a.m.s.e.PowerAndHarmonicEsHelper : 设置mapping—dws_power_harmonic_20230701_01-32
2023-07-27T16:37:04.647+08:00 INFO 8 —- [pool-9-thread-5] c.a.m.s.s.s.PowerAndHarmonicService : 01-32-10-04-23-01插入数据结束
2023-07-27T16:37:04.648+08:00 INFO 8 —- [io-28034-exec-2] c.a.m.s.s.s.PowerAndHarmonicService : 功率因数和谐波监控插入数据至新索引总耗时: 6s
2023-07-27T16:37:07.851+08:00 INFO 8 —- [ Timer-0] c.a.m.s.e.QueueHelper : 批处理[1440]条提交到es成功 ！,耗时：0.23秒

重跑需要清理index（dws_power_harmonic_20230701_01-32）和服务缓存(重启服务)
```



# 02功率因数表

```
功率因数
    整定时间点：（15分的倍数 ，一天有24*4-96个点）   -- 取值为向后15分钟内最靠近该整定时间的数据
    总有功功率P和总无功功率Q，如果没有取值使用分项累加（如果系统没有直接给出总功率值，就把所有设备的功率加起来）
    平均值 时间段内整定时间点测点数值的平均数（值是null不包含） -- [时间段内也就是选择的时间范围]
    最大值 时间段内整定时间点测点数值的最大数（值是null不包含）
    最小值 时间段内整定时间点测点数值的最小数（值是null不包含）
    
涉及设备测点如下，
    高压配电
        有功功率Pa 001311 kW
        有功功率Pb 001312 kW
        有功功率Pc 001313 kW
        无功功率Qa 001314 kvar
        无功功率Qb 001315 kvar
        无功功率Qc 001316 kvar
        总有功功率P 001325 kW
        总无功功率Q 001326 kvar
    	功率因数 001323
    低压交流配电
        有功功率Pa 002307 kW
        有功功率Pb 002314 kW
        有功功率Pc 002321 kW
        无功功率Qa 002306 kvar
        无功功率Qb 002313 kvar
        无功功率Qc 002320 kvar
        总有功功率P 002344 kW
        总无功功率Q 002345 kvar
        总功率因数 002324
    UPS设备
        输出有功功率Pa 008338 kW
        输出有功功率Pb 008339 kW
        输出有功功率Pc 008340 kW
        功率因数 008322
        输出总有功功率P 008342 kW
    智能电表
        有功功率Pa 092308 kW
        有功功率Pb 092309 kW
        有功功率Pc 092310 kW
        功率因数 092314
        总有功功率 092330 kW
```

# 03功率因数表详情

```
详情中趋势图数据，每15分钟(02:15[02:15-02:30);02:30;02:45)展示一个点,取值为向后15分钟内最靠近该整定时间的数据
	整定时间点（15分的倍数 ，一天有24*4-96个点）

```

# 04畸变率

```
畸变率
	整定时间点：（15分的倍数 ，一天有24*4-96个点） 			-- 取值为向后15分钟内最靠近该整定时间的数据
    平均值 时间段内整定时间点测点数值的平均数（值是null不包含） 	-- [时间段内也就是选择的时间范围]
    最大值 时间段内整定时间点测点数值的最大数（值是null不包含）
    最小值 时间段内整定时间点测点数值的最小数（值是null不包含）


低压交流配电
    电压畸变率 002328 %
    总电流畸变率 002329 %
智能电表
    电压畸变率 092327 %
    总电流畸变率 092328 %

```

# 05畸变率详情

```
详情中趋势图数据，每15分钟(02:15[02:15-02:30);02:30;02:45)展示一个点,取值为向后15分钟内最靠近该整定时间的数据
	整定时间点（15分的倍数 ，一天有24*4-96个点）
```

# 06导出限制

```
列表导出限制[两个tab导出均限制]
	在composite中配置 - nacas的yaml配置
	powerfactor:
		exportdatasize: 1000
```


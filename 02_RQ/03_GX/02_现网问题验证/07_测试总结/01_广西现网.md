# 01总结

```
补充

1、中屏首页
	疑问点：pue怎么对【取的是什么时间段的】
	数据中心：21
	枢纽楼：51
	// 设备Top10 (全部：1,2)
	/v1/currentmonitor/getDeviceTypeTop10Stat				返回正常						验证		综合监控-设备top 
																									枢纽机房：6153，数据：8697  14850
																								getDeviceDetailList
																									数据中心传成了6
	// 隐患分布(全部：1,2)
	/v1/hiddenDanger/data/cityCount 						返回正常						验证		隐患统计-实时隐患
																									站点类型，地区划分
																									数据中心-南宁1
																									枢纽楼 - 南宁20，白色8
	// 动环关键设备统计(全部：1,2)					
	/v1/configManagement/screen/countDeviceTypeFrom			返回正常						验证		综合监控-动环设备  
																									枢纽变压：21，数据：51
																									总数 枢纽：13376，数据：13498
	// 隐患统计(全部：1,2)
	/v1/hiddenDanger/data/levelCount						返回正常						验证		隐患统计-实时隐患
																									数据中心：南宁1 - 四级
																									枢纽楼 - 南宁20，百色8 - 四级
	// 机房类型分布 (全部：1,2)
	/v1/currentmonitor/getRoomKindStat						返回正常						验证		综合监控-机房分布选数据中心+枢纽 = 450
																									数据：83
																									枢纽：367
																									数据中心传成了6
	// 容量预警 (全部：1,2)
	/v1/alerts/sortCapacityCountInArea						传参正常						验证		容量-容量预警统计
																									数据：0
																									枢纽：0

	/v1/alerts/countCapacityFromArea						传参正常						验证		容量-容量预警统计
																									容量预警信息统计-不取高压直流

																								全部时报错

	//  负载率(全部：1,2)
	/v1/configManagement/screen/countCapacity  				传参正常						验证		容量-对应设备-容量详情
																									主用 = 所有单台额定
																									已用 = 单台最大工作

																								全部时报错，单条件成功

	站点类型分布(全部：1,2)
	/v1/currentmonitor/getSiteTypeStat						传参正确						验证		监控视图-站点
																									只返回了数据中心
																									数据中心传1，传成了6
	(综合监控-中屏首页)---切换站点类型
	// 重要告警(全部：1,2)
	/v1/alerts/	
	/v1/alertFilterCondition/listIndexShowFilterStat		传参正确						验证		监控视图-站点

																								全部时报错，单条件成功

	// 超期服役  (全部：1,2)											
	/v1/configManagement/screen/countOverTimeDeviceView		传参正确						验证		资源-超期服役
																									数据-地市：，枢纽-地市：
																									数据-设备：，枢纽-设备：

																								全部时报错，单条件成功

	// 站点能耗TOP10(全部：1,2)										
	/v1/energy/getStationTop								传参正确						验证		资源-超期服役
																									
																									数据中心传成了3
																									
	// 告警统计(全部：1,2)											
	/v1/currentmonitor/v1/configManagement/getAlertCount	传参正确						验证		


	// pue top5(全部：1,2)
	/v1/energy_n/queryPueTop									返回正常





2、容量分析下所有tab的容量详情的历史，图标时间标签优化
	容量管理下，变压器，高压直流电源容量分析，容量预警信息统计的容量历史



3、月度统计表
	energy_formula_config
	energy_formula_config_copy...
	t_zz_space_resource 


4、超期服役（是否在网问题）
	看lifecycle_status（有三种类型）
	SELECT * FROM overdue_device_detail LIMIT 10;
	SELECT * FROM t_zz_power_device LIMIT 10;
	

5、设备风险
	查看是否属于综资设备
		SELECT ts.city_id,ts.county_id,ts.zh_label,ts2.zh_label,tp.* FROM t_zz_power_device tp
			JOIN t_zz_space_resources ts ON tp.related_site = ts.int_id 
			JOIN t_zz_space_resources ts2 ON tp.related_room = ts2.int_id LIMIT 10 ;
	（涉及服务）
	
	
7、运行分析-字典表维护
	服务对应（）
	去重设备

8、能耗估算
	SELECT tc3.precinct_name,tc2.precinct_name,tc.precinct_name,ea.*  from energy_audit_estimates ea
			join t_cfg_precinct tc on ea.precinct_id = tc.precinct_id
			JOIN t_cfg_precinct tc2 ON tc.up_precinct_id = tc2.precinct_id
			JOIN t_cfg_precinct tc3 ON tc2.up_precinct_id = tc3.precinct_id
			WHERE ea.ups_estimates != 'NULL';
	能耗数据稽核
		能耗稽核总数据（根据能耗稽核估算，可以看没各子项的数据）
			子项数根据用电关系配置
			根据能耗管理-能耗自查验收也可查看
	能耗稽核报表
		异常站次　－－　来源于能耗数据稽核的统计
		存在站点类型为空：因为ｔ＿ｃｆｇ＿ｐｒｅｃｉｎｔ　中没有对应站点

9、综合监控-拓扑评估【不是很理解】
	补充好像有sql

10、运行分析-有效性稽核
	设备完整性 - 信号要求接入数量  -- 具体根据接入的市哪些测点
		SELECT * FROM t_cfg_device LIMIT 10;
		SELECT * FROM t_cfg_device WHERE device_id = '17446809784244488';
		SELECT * FROM t_cfg_metemodel_detail WHERE model_id = '00001008000002827767'
		
11、综合监控
	站点显示（动环和综资）
		t_zz_power_specialty（通过一个字段取判断 -- 会自动跑脚本生成的）
		这里存放综资所有的属性 - 站点，机房，省份，等等还有设备
		

12、隐患统计（存在一点疑虑）
	第一步，根据precinct_id和mete_code
		获取机房下，对应测点的设备id和设备code和设备name
		SELECT b.device_id,b.device_code,b.device_name,a.device_type,a.mete_code,a.mete_name,
			a.alarm_explain,b.precinct_id,c.precinct_name,c.resource_code,d.dict_note
			FROM t_cfg_mete a,t_cfg_device b,t_cfg_precinct c,t_cfg_dict d
			WHERE a.device_type = b.device_type AND b.precinct_id = c.precinct_id AND a.mete_code = {mete_code} 
			AND b.device_type = d.dict_code AND d.col_name = 'device_type'
			AND c.precinct_name = '{precinct_name}'
   	第二步，根据获取的precinct_id和device_id到综资表中匹配
		SELECT * FROM `t_zz_space_resources` WHERE precinct_id = '{cls.precinct_id[:-3]}'
		SELECT * FROM `t_zz_power_specialty` WHERE device_id = '{cls.device_id}'
	满足的条件
		1、动环设备下的设备存在
		2、存在的设备的device_id，在综资里面有对应映射
		3、同时动环设备下的设备所在站点也要存在综资映射表中
	
		【判断是否在综资设备里面有对应的，保证devcie_id对应的同时，还要确保device_code也对应】
		SELECT * FROM `t_zz_power_specialty` WHERE device_id IN 
		(SELECT b.device_id
			FROM t_cfg_mete a,t_cfg_device b,t_cfg_precinct c,t_cfg_dict d
			WHERE a.device_type = b.device_type AND b.precinct_id = c.precinct_id AND a.mete_code = '017012'
			AND b.device_type = d.dict_code AND d.col_name = 'device_type')
	
		【确保上面查询出来的设备所对应的动环站点，也在综资存在】
		SELECT * FROM `t_zz_space_resources` WHERE precinct_id = '01-07-05-02-39-02';
		
		【修改device_code】
		SELECT * FROM t_cfg_device WHERE device_id = '00541006000000106478';
		
		【拿站点名】
		SELECT * FROM t_cfg_precinct where precinct_id = '01-07-21-01-01-03' ;
		
		【最后取动环的参数进行请求】
		SELECT b.device_id,b.device_code,b.device_name,a.device_type,a.mete_code,a.mete_name,
			a.alarm_explain,b.precinct_id,c.precinct_name,c.resource_code,d.dict_note
			FROM t_cfg_mete a,t_cfg_device b,t_cfg_precinct c,t_cfg_dict d
			WHERE a.device_type = b.device_type AND b.precinct_id = c.precinct_id AND a.mete_code = '017012'
			AND b.device_type = d.dict_code AND d.col_name = 'device_type'
			  
			  AND b.device_id = '00781006000003663228'
			  LIMIT 10;

		
		
	所以？
		我只要通过最后一个sql，查出对应设备后，把设备的id拿到综资，把综资的code拿到id？
		然后再把precinct_id随意放？
		只要建立起关联，就可以了？
```


# 透传业务协议 ## A2.1 透传串口数据 ### 命令说明 - 命令号：0x0001 - 命令描述：该命令用于透传串口数据包，分为上行（FSU=>SC）和下行（SC =>FSU）两个方向  ### 下行方向（SC =>FSU） |地址|协议字段|字段长度|字段描述|默认值| |---|---|---|---|---| |0|P_header|1 byte|协议包的开始标识ff|0xFF| |1-20|P_dest_addr|20bytes|目标设备地址|FSU的ID| |21-28|P_src_addr|8byte|源设备地址|SC的地址取值为00| |29|P_subDevType|1 byte|子设备类型：<br/>1：串口设备<br/>2：USB设备<br/>3：IP网络设备|1| |30|P_subDev_addr|1 byte|透传模块：Bit0~4:串口号；Bit5~8：表示虚拟设备号（即串口总线模式下的地址号）；<br/>当子设备类型为USB/IP时，此字段为00。|| |31-32|P_pLen|2 byte|协议族数据包长度|5+N| |33|RtnFlag|1byte|设置/应答类型|0xee| |34-35|CommType|2 bytes|命令编号|0x0001| |36-37|透传数据长度|2 byte|透传数据长度|| |38-(38+N-1)|透传数据|N byte|数据内容|| |38+N|P_verify|1 byte|协议包的校验字段，采用异或校验，在数据转义之前，对协议数据计算校验值，计算时不包含包头和包尾|| |39+N|P_tailer|1 byte|协议包的结束标识fe|0xFE|  ### 上行方向（FSU=>SC） |地址|协议字段|字段长度|字段描述|默认值| |---|---|---|---|---| |0|P_header|1 byte|协议包的开始标识ff|0xFF| |1-8|P_dest_addr|8bytes|目标设备地址|SC的地址取值为0x00| |9-28|P_src_addr|20byte|源设备地址|FSU的ID| |29|P_subDevType|1 byte|子设备类型：<br/>1：串口设备<br/>2：USB设备<br/>3：IP网络设备|1| |30|P_subDev_addr|1 byte|透传模块：Bit0~4:串口号；Bit5~8：表示虚拟设备号（即串口总线模式下的地址号）；<br/>当子设备类型为USB/IP时，此字段为00。|| |31-32|P_pLen|2 byte|协议族数据包长度|5+N| |33|RtnFlag|1byte|设置/应答类型|0x00| |34-35|CommType|2 bytes|命令编号|0x0001| |36-37|透传数据长度|2 byte|透传数据长度|| |38-(38+N-1)|透传数据|N byte|数据内容|| |38+N|P_verify|1 byte|协议包的校验字段，采用异或校验，在数据转义之前，对协议数据计算校验值，计算时不包含包头和包尾|| |39+N|P_tailer|1 byte|协议包的结束标识fe|0xFE|  ## A2.2 FSU透传通道心跳 ### 命令说明 - 命令号：0x0002 - 命令描述：FSU定时（例如：每隔120秒）向SC发送一个心跳包数据，SC根据接收心跳消息的情况进行链路连接状态的判断。当SC在360秒内未收到任何心跳消息时，则认为SC和FSU之间的透传通道中断。 - 数据方向：FSU => SC  ### 命令数据 |地址|协议字段|字段长度|字段描述|默认值| |---|---|---|---|---| |0|P_header|1 byte|协议包的开始标识ff|0xFF| |1-8|P_addr|8bytes|目标设备地址|SC的地址为0x00| |9-28|P_src_addr|20bytes|源设备地址|FSU的ID| |29|P_subDevType|1 byte|子设备类型：<br/>1：串口设备<br/>2：USB设备<br/>3：IP网络设备|1| |30|P_subDev_addr|1 byte|透传模块：Bit0~4:串口号；Bit5~8：表示虚拟设备号（即串口总线模式下的地址号）；<br/>当子设备类型为USB/IP时，此字段为00。|| |31-32|P_pLen|2 byte|协议族数据包长度|3| |33|RtnFlag|1byte||0xED| |34-35|CommandType|2 byte|命令号|0x0002| |36|P_verify|1 byte|协议包的校验字段，采用异或校验，在数据转义之前，对协议数据计算校验值，计算时不包含包头和包尾|| |37|P_tailer|1 byte|协议包的结束标识fe|0xFE|  ## A.3 转义字段说明 如第2节所述，每个协议的包头、包尾分别固化取值为0xFF和0xFE，当协议包头和包尾之间的数据出现0xFF、0xFE或0xFD时，需要转义，转义规则如下： - 0xFF：0xFD 0x00 - 0xFE：0xFD 0x01 - 0xFD：0xFD 0x02  在FSU与SC之间的透传接口传输的上下行数据都需要转义，实际传输的内容是转义后的数据。
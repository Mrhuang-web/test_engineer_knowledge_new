# 广西绿智楼宇越权测试用例

## 一、测试概述

### 1.1 测试目的
- 验证绿智楼宇系统的权限控制机制是否有效
- 检测系统是否存在未授权访问、水平越权和垂直越权问题
- 确保不同角色的权限配置在接口层面正确生效

### 1.2 测试范围
- 系统四个功能模块：楼宇基础信息维护、电表基础信息维护、电表日用电量、楼宇其他能源消耗量
- 覆盖新增、查询、导出、导入、编辑、删除等操作

### 1.3 测试方法
- 角色矩阵分析法
- 参数替换法
- 会话互换法
- 脏URL扫描法

## 二、角色定义与权限矩阵

### 2.1 角色定义

| 角色名称 | 角色描述 | 可访问地市 |
|---------|----------|------------|
| 超级管理员 | 所有功能权限 | 所有地市 |
| 系统管理员 | 所有功能权限，但无系统配置权限 | 所有地市 |
| 南宁管理员 | 负责南宁市数据管理 | 南宁市 |
| 柳州管理员 | 负责柳州市数据管理 | 柳州市 |
| 只读用户 | 仅可查看和导出数据 | 所有地市 |
| 受限用户 | 仅可新增和导入数据 | 南宁市 |

### 2.2 权限矩阵

| 功能模块 | 操作 | 超级管理员 | 系统管理员 | 南宁管理员 | 柳州管理员 | 只读用户 | 受限用户 |
|---------|------|------------|------------|------------|------------|----------|----------|
| 楼宇基础信息维护 | 新增 | √ | √ | √ | √ | × | √ |
| | 查询 | √ | √ | √ | √ | √ | × |
| | 导出 | √ | √ | √ | √ | √ | × |
| | 导入 | √ | √ | √ | √ | × | √ |
| | 编辑 | √ | √ | √ | √ | × | × |
| | 删除 | √ | √ | √ | √ | × | × |
| 电表基础信息维护 | 新增 | √ | √ | √ | √ | × | √ |
| | 查询 | √ | √ | √ | √ | √ | × |
| | 导出 | √ | √ | √ | √ | √ | × |
| | 导入 | √ | √ | √ | √ | × | √ |
| | 编辑 | √ | √ | √ | √ | × | × |
| | 删除 | √ | √ | √ | √ | × | × |
| 电表日用电量 | 查询 | √ | √ | √ | √ | √ | × |
| | 导出 | √ | √ | √ | √ | √ | × |
| 楼宇其他能源消耗量 | 新增 | √ | √ | √ | √ | × | √ |
| | 查询 | √ | √ | √ | √ | √ | × |
| | 导出 | √ | √ | √ | √ | √ | × |
| | 导入 | √ | √ | √ | √ | × | √ |
| | 编辑 | √ | √ | √ | √ | × | × |
| | 删除 | √ | √ | √ | √ | × | × |

## 三、越权测试用例

### 3.1 未授权访问测试

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-001 | 未授权查询楼宇基础信息 | 1. 不登录系统，直接访问楼宇基础信息查询接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-002 | 未授权新增楼宇基础信息 | 1. 不登录系统，直接访问楼宇基础信息新增接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-003 | 未授权编辑楼宇基础信息 | 1. 不登录系统，直接访问楼宇基础信息编辑接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-004 | 未授权删除楼宇基础信息 | 1. 不登录系统，直接访问楼宇基础信息删除接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-005 | 未授权导出楼宇基础信息 | 1. 不登录系统，直接访问楼宇基础信息导出接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-006 | 未授权导入楼宇基础信息 | 1. 不登录系统，直接访问楼宇基础信息导入接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-007 | 未授权查询电表基础信息 | 1. 不登录系统，直接访问电表基础信息查询接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-008 | 未授权新增电表基础信息 | 1. 不登录系统，直接访问电表基础信息新增接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-009 | 未授权编辑电表基础信息 | 1. 不登录系统，直接访问电表基础信息编辑接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-010 | 未授权删除电表基础信息 | 1. 不登录系统，直接访问电表基础信息删除接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-011 | 未授权导出电表基础信息 | 1. 不登录系统，直接访问电表基础信息导出接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-012 | 未授权导入电表基础信息 | 1. 不登录系统，直接访问电表基础信息导入接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-013 | 未授权查询电表日用电量 | 1. 不登录系统，直接访问电表日用电量查询接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-014 | 未授权导出电表日用电量 | 1. 不登录系统，直接访问电表日用电量导出接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-015 | 未授权查询楼宇其他能源消耗量 | 1. 不登录系统，直接访问楼宇其他能源消耗量查询接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-016 | 未授权新增楼宇其他能源消耗量 | 1. 不登录系统，直接访问楼宇其他能源消耗量新增接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-017 | 未授权编辑楼宇其他能源消耗量 | 1. 不登录系统，直接访问楼宇其他能源消耗量编辑接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-018 | 未授权删除楼宇其他能源消耗量 | 1. 不登录系统，直接访问楼宇其他能源消耗量删除接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-019 | 未授权导出楼宇其他能源消耗量 | 1. 不登录系统，直接访问楼宇其他能源消耗量导出接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |
| TC-020 | 未授权导入楼宇其他能源消耗量 | 1. 不登录系统，直接访问楼宇其他能源消耗量导入接口<br>2. 验证返回结果 | 返回401 Unauthorized | | |

### 3.2 水平越权测试（同级别角色）

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-021 | 南宁管理员查询柳州楼宇基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇基础信息查询接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 只能返回南宁市数据或返回403 Forbidden | | |
| TC-022 | 南宁管理员新增柳州楼宇基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇基础信息新增接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-023 | 南宁管理员编辑柳州楼宇基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇基础信息编辑接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-024 | 南宁管理员删除柳州楼宇基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇基础信息删除接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-025 | 南宁管理员查询柳州电表基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用电表基础信息查询接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 只能返回南宁市数据或返回403 Forbidden | | |
| TC-026 | 南宁管理员新增柳州电表基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用电表基础信息新增接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-027 | 南宁管理员编辑柳州电表基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用电表基础信息编辑接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-028 | 南宁管理员删除柳州电表基础信息 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用电表基础信息删除接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-029 | 南宁管理员查询柳州电表日用电量 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用电表日用电量查询接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 只能返回南宁市数据或返回403 Forbidden | | |
| TC-030 | 南宁管理员导出柳州电表日用电量 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用电表日用电量导出接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-031 | 南宁管理员查询柳州楼宇其他能源消耗量 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇其他能源消耗量查询接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 只能返回南宁市数据或返回403 Forbidden | | |
| TC-032 | 南宁管理员新增柳州楼宇其他能源消耗量 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇其他能源消耗量新增接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-033 | 南宁管理员编辑柳州楼宇其他能源消耗量 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇其他能源消耗量编辑接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-034 | 南宁管理员删除柳州楼宇其他能源消耗量 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用楼宇其他能源消耗量删除接口，参数中指定地市为"柳州市"<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-035 | 参数替换法水平越权 | 1. 使用南宁管理员账号登录，获取token<br>2. 调用查询接口，将请求中的cityId替换为柳州的ID<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-036 | 会话互换法水平越权 | 1. 使用南宁管理员账号登录，获取token<br>2. 使用柳州管理员账号登录，获取一条查询记录的ID<br>3. 使用南宁管理员的token，调用查看接口访问柳州管理员的数据ID<br>4. 验证返回结果 | 返回403 Forbidden | | |

### 3.3 垂直越权测试（低权限→高权限）

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-037 | 只读用户越权新增楼宇基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇基础信息新增接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-038 | 只读用户越权编辑楼宇基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇基础信息编辑接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-039 | 只读用户越权删除楼宇基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇基础信息删除接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-040 | 只读用户越权导入楼宇基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇基础信息导入接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-041 | 只读用户越权新增电表基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用电表基础信息新增接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-042 | 只读用户越权编辑电表基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用电表基础信息编辑接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-043 | 只读用户越权删除电表基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用电表基础信息删除接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-044 | 只读用户越权导入电表基础信息 | 1. 使用只读用户账号登录，获取token<br>2. 调用电表基础信息导入接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-045 | 只读用户越权新增楼宇其他能源消耗量 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量新增接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-046 | 只读用户越权编辑楼宇其他能源消耗量 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量编辑接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-047 | 只读用户越权删除楼宇其他能源消耗量 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量删除接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-048 | 只读用户越权导入楼宇其他能源消耗量 | 1. 使用只读用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量导入接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-049 | 受限用户越权查看楼宇基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇基础信息查看接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-050 | 受限用户越权导出楼宇基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇基础信息导出接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-051 | 受限用户越权编辑楼宇基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇基础信息编辑接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-052 | 受限用户越权删除楼宇基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇基础信息删除接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-053 | 受限用户越权查看电表基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用电表基础信息查看接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-054 | 受限用户越权导出电表基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用电表基础信息导出接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-055 | 受限用户越权编辑电表基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用电表基础信息编辑接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-056 | 受限用户越权删除电表基础信息 | 1. 使用受限用户账号登录，获取token<br>2. 调用电表基础信息删除接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-057 | 受限用户越权查看电表日用电量 | 1. 使用受限用户账号登录，获取token<br>2. 调用电表日用电量查看接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-058 | 受限用户越权导出电表日用电量 | 1. 使用受限用户账号登录，获取token<br>2. 调用电表日用电量导出接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-059 | 受限用户越权查看楼宇其他能源消耗量 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量查看接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-060 | 受限用户越权导出楼宇其他能源消耗量 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量导出接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-061 | 受限用户越权编辑楼宇其他能源消耗量 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量编辑接口<br>3. 验证返回结果 | 返回403 Forbidden | | |
| TC-062 | 受限用户越权删除楼宇其他能源消耗量 | 1. 使用受限用户账号登录，获取token<br>2. 调用楼宇其他能源消耗量删除接口<br>3. 验证返回结果 | 返回403 Forbidden | | |

## 四、功能测试用例

### 4.1 楼宇基础信息维护

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-063 | 新增楼宇基础信息 | 1. 使用超级管理员账号登录<br>2. 进入楼宇基础信息维护页面<br>3. 点击"新增"按钮<br>4. 填写表单信息<br>5. 点击"保存"按钮<br>6. 验证是否新增成功 | 新增成功，数据显示在列表中 | | |
| TC-064 | 查询楼宇基础信息 | 1. 使用系统管理员账号登录<br>2. 进入楼宇基础信息维护页面<br>3. 输入查询条件（如地市名称）<br>4. 点击"查询"按钮<br>5. 验证查询结果 | 显示符合条件的数据 | | |
| TC-065 | 导出楼宇基础信息 | 1. 使用报表分析师账号登录<br>2. 进入楼宇基础信息维护页面<br>3. 点击"导出"按钮<br>4. 选择导出格式<br>5. 点击"确认"按钮<br>6. 验证是否导出成功 | 导出成功，下载文件包含所有数据 | | |
| TC-066 | 编辑楼宇基础信息 | 1. 使用南宁管理员账号登录<br>2. 进入楼宇基础信息维护页面<br>3. 选择一条数据，点击"编辑"按钮<br>4. 修改表单信息<br>5. 点击"保存"按钮<br>6. 验证是否编辑成功 | 编辑成功，数据已更新 | | |
| TC-067 | 删除楼宇基础信息 | 1. 使用柳州管理员账号登录<br>2. 进入楼宇基础信息维护页面<br>3. 勾选一条数据，点击"删除"按钮<br>4. 在确认对话框中点击"确认"按钮<br>5. 验证是否删除成功 | 删除成功，数据从列表中移除 | | |
| TC-068 | 导入楼宇基础信息 | 1. 使用受限用户账号登录<br>2. 进入楼宇基础信息维护页面<br>3. 点击"导入"按钮<br>4. 选择导入文件<br>5. 点击"确认"按钮<br>6. 验证是否导入成功 | 导入成功，数据显示在列表中 | | |

### 4.2 电表基础信息维护

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-069 | 新增电表基础信息 | 1. 使用超级管理员账号登录<br>2. 进入电表基础信息维护页面<br>3. 点击"新增"按钮<br>4. 填写表单信息<br>5. 点击"保存"按钮<br>6. 验证是否新增成功 | 新增成功，数据显示在列表中 | | |
| TC-070 | 查询电表基础信息 | 1. 使用系统管理员账号登录<br>2. 进入电表基础信息维护页面<br>3. 输入查询条件（如电表ID）<br>4. 点击"查询"按钮<br>5. 验证查询结果 | 显示符合条件的数据 | | |
| TC-071 | 导出电表基础信息 | 1. 使用报表分析师账号登录<br>2. 进入电表基础信息维护页面<br>3. 点击"导出"按钮<br>4. 选择导出格式<br>5. 点击"确认"按钮<br>6. 验证是否导出成功 | 导出成功，下载文件包含所有数据 | | |

### 4.3 电表日用电量

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-072 | 查询电表日用电量 | 1. 使用系统管理员账号登录<br>2. 进入电表日用电量页面<br>3. 设置查询条件（如抄表日期范围）<br>4. 点击"查询"按钮<br>5. 验证查询结果 | 显示符合条件的数据 | | |
| TC-073 | 导出电表日用电量 | 1. 使用报表分析师账号登录<br>2. 进入电表日用电量页面<br>3. 设置查询条件<br>4. 点击"导出"按钮<br>5. 选择导出格式<br>6. 点击"确认"按钮<br>7. 验证是否导出成功 | 导出成功，下载文件包含符合条件的数据 | | |

### 4.4 楼宇其他能源消耗量

| 测试用例ID | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 备注 |
|------------|----------|----------|----------|----------|------|
| TC-074 | 新增楼宇其他能源消耗量 | 1. 使用超级管理员账号登录<br>2. 进入楼宇其他能源消耗量页面<br>3. 点击"新增"按钮<br>4. 填写表单信息<br>5. 点击"保存"按钮<br>6. 验证是否新增成功 | 新增成功，数据显示在列表中 | | |
| TC-075 | 查询楼宇其他能源消耗量 | 1. 使用系统管理员账号登录<br>2. 进入楼宇其他能源消耗量页面<br>3. 输入查询条件（如楼宇名称）<br>4. 点击"查询"按钮<br>5. 验证查询结果 | 显示符合条件的数据 | | |
| TC-076 | 导出楼宇其他能源消耗量 | 1. 使用报表分析师账号登录<br>2. 进入楼宇其他能源消耗量页面<br>3. 点击"导出"按钮<br>4. 选择导出格式<br>5. 点击"确认"按钮<br>6. 验证是否导出成功 | 导出成功，下载文件包含所有数据 | | |

## 五、测试执行计划

### 5.1 测试准备
- 创建测试账号，分配相应角色和数据权限
- 准备测试数据，包括楼宇基础信息、电表基础信息等
- 配置测试环境，确保系统正常运行

### 5.2 测试执行
1. 执行未授权访问测试（TC-001~TC-002）
2. 执行水平越权测试（TC-003~TC-005）
3. 执行垂直越权测试（TC-006~TC-009）
4. 执行功能测试（TC-010~TC-023）

### 5.3 测试工具
- Postman：用于接口测试
- Burp Suite：用于越权测试和漏洞扫描
- 浏览器开发者工具：用于前端权限验证

## 六、测试结果分析

### 6.1 预期结果
- 所有未授权访问测试用例应返回401 Unauthorized
- 所有越权测试用例应返回403 Forbidden
- 所有功能测试用例应返回200 OK并执行成功

### 6.2 缺陷分级
- 严重：未授权访问、垂直越权
- 中等：水平越权
- 轻微：权限配置不准确

### 6.3 修复建议
- 确保所有接口都进行身份验证
- 实现细粒度的数据权限控制
- 对所有接口进行权限校验
- 统一错误码返回格式

## 七、测试总结

- 本次测试覆盖了绿智楼宇系统的所有功能模块和操作
- 重点测试了未授权访问、水平越权和垂直越权问题
- 验证了不同角色的权限配置是否正确生效
- 确保了系统在接口层面的权限控制机制有效

通过本次测试，可以评估绿智楼宇系统的权限控制机制是否符合安全要求，发现并修复潜在的越权问题，提高系统的安全性和可靠性。

---

**测试用例编制人**：测试工程师
**测试用例审核人**：系统架构师
**测试用例批准人**：项目经理
**测试用例编制日期**：2026-01-18
**测试用例生效日期**：2026-01-19
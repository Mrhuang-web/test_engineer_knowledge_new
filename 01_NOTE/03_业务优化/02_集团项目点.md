# 水资源【B接口类】

## 业务逻辑

- **用水关系**
  - 数据中心站点下、有楼栋【楼栋类型：生产楼】、楼栋下有机房、机房下面设备有数据
  - 通过配置设备，记录设备上水资源的数据情况【每个设备都有测点】 - 是否触发才会生成报表统计呢
- **水资源看板**
  - 水资源地图：各省份下对应数据中心的楼栋下各设备的水资源情况
  - 用水WUE：有用水量楼栋 - 对应楼栋的用电量才会记录【用水量/用电量】
  - 用水趋势：
- **用水分析**
- **水资源报表**

## 涉及库表

- 公共表
  - t_cfg_dict ：字典配置【查看楼栋类型：生产楼等情况】
  - t_cfg_precinct：查看楼栋的类型【因为计算只计算生产楼的】
  - t_cfg_metedetail：设备测点编码，设备id等记录
- 水资源设备测点来源
  - 
  - water表
  - 是否也是设备通过接口传递给kafka，同步到es和redis中，再进行持久化的

## 测试数据准备



## 测试方法

- 需要找对应it用电量
  - 能耗日报、能耗统计报、能耗月报







# 能耗【B接口】

- 能耗-能耗报表-能耗月报-月度统计表

## 需求概述

- 只针对“月度统计表”，增加每月+汇总的“IDC机房IT用电”，
- 计算方法：Σ站点下所有IDC机房的日IT用电量，
- 没有IDC机房或都没有配置机房IT用电关系的站点用“--/--”表示。
- 有IT能耗配置关系的，按累计数字显示（保留2为小数点）。

## 涉及库表

- 公共表：t_cfg_dict 字典表  -- 查询IDC机房对应id  room_kind - 2
- 数据表：
  - 占位置



## 测试方法

- 页面层面：
  - 能耗月报表中 - 月度统计表 - 查看该站点下  IDC类型机房且配置关系的 - IT用电量
  - 能耗月报表中 - 楼栋月度统计表 - 查看该站点下数据之和是否一致【如果机房类型变更-数据是否会实时更新】
- 接口层面：
  - 能耗月报表中 - 月度统计表 和 能耗月报表中 - 楼栋月度统计表 引用同个接口，但是参数不同
  - 运算结果不同，月度统计表 - it统计是站点下所有机房之和，楼栋月度统计表只是该楼栋之下所有机房之和
  - 因此校验计算是需要注意
- 数据层面：
  - 能耗 - 能耗配置 - 用电关系中，查看对应站点 it汇总情况，到数据库查看对应时间点位下测点的数据

​		

## 测试数据准备

- 目前思路：
  - 在指定区域生成站点，站点下创建多中机房【含IDC类型】
  - 对机房下进行测点造数，到机房中配置用电关系
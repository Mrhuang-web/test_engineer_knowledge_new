# 能耗-能耗月报-月度统计表

- 疑点：
  - 数据表对应关系，造数只需要造测点数据吗【这个不用触发器，直接用数据库数据即可】
  - 只是小改动，原先的数据已经没问题，现在只是IDC统计的校验即可
  - 为什么有些机房下面有测点可以选，有些没有呢【因为机房或站点下没建立设备】
  - 核心机房是哪些

## 需求概述

- 只针对“月度统计表”，增加每月+汇总的“IDC机房IT用电”，
- 计算方法：Σ站点下所有IDC机房的日IT用电量，
- 没有IDC机房或都没有配置机房IT用电关系的站点用“--/--”表示
- 有IT能耗配置关系的，按累计数字显示（保留2为小数点）

## 涉及库表

- 公共表：
  - t_cfg_dict 字典表  -- 查询IDC机房对应id  room_kind - 2
  - 
- 数据表：
  - energy_device_mete_202501：能耗设备通道用电表 【基础数据 - 通过设备id和站点匹配】
  - energy_month_summary：能耗月统计（区域）【区下各站点分类汇总的数据】

## 测试方法❤

- 页面层面【因为这里直接调用的楼栋的-->且前面测点数据已经测过的，只需要验证计算是否正确即可】：
  - 注意：不涉及定时器之类的东西，就是简单汇总而已
  - 能耗月报表中 - 月度统计表 - 查看该站点下  IDC类型机房且配置关系的 - IT用电量
  - 能耗月报表中 - 机房月度统计表 - 查看该机房下数据之和是否一致【机房类型变更-数据是否会实时更新】
  - 验证月度统计表中每一层页面是否都有该字段 -- 导出是否都有该字段，且数据正确
    - 即从省-市-区-楼栋等条件下
  - 验证月度统计表中，数据是否跟-->该站点下（IDC）机房类型汇总的一致
  - 验证核心机房下的是否正常
  - 还需要验证机房月度 -- > 里面it用量也是新增的
  - 上述步骤需要多两组数据进行验证
- 接口层面：
  - 涉及接口：http://10.1.203.38:18580/spider/web/v1/energy/getAllMonthData?
  - 能耗月报表中 - 月度统计表 和 能耗月报表中 - 楼栋月度统计表 引用同个接口，但是参数不同
  - 运算结果不同，月度统计表 - it统计是站点下所有机房之和，楼栋月度统计表只是该楼栋之下所有机房之和，因此校验计算是需要注意
- 数据层面：
  - 能耗 - 能耗配置 - 用电关系中，查看对应站点 it汇总情况，到数据库查看对应时间点位下测点的数据

## 测试数据准备

- 目前思路：
  - 在指定区域生成站点，站点下创建多中机房【含IDC类型】
  - 对机房下进行测点造数，到机房中配置用电关系

​	
# 00动环与综资关联【重点】

```
动环（综资）
省（所属省份）
	市（所属地市）
		区（所属区县）
			动环站点（【动环数据中心】数据中心-园区；【动环核心机楼-枢纽楼】站点；【动环其他站点】）
				楼栋（【动环楼栋】站点）		
					机房
						设备系统类型
									设备系统名称
												设备名称
														测点（信号编码+信号通道）
						设备类型（无设备系统）
									设备名称
											测点（信号编码+信号通道）




补充描述1：
	动环/综资的核心机楼（核心站点、核心站点（配套），包含数据中心楼栋 - 通信枢纽楼+楼栋）
补充描述2：
	动环中数据中心大部分需要以这个形式 - 数据中心（站点）-楼栋（站点）的形式，
	接入的数据中心是接入到站点中的
```



# 01监控视图

```
最完善的层级

中国移动
	省
		市
			区
				站点
					机楼[数据中心才需要]
						楼层
							机房
								设备类型
										设备
											测点（信号id），信号名称，信号值






(有区域 -> 对应t_cfg_precinct)
(有站点 -> 对应t_cfg_site: ’is_belongIDC’， 用于区别是否是数据中心(0/1); 而dc_class是指归属何种类型的数据中心，如跨省数据中心)
(有机楼[也叫楼栋] -> 对应building_mapping)
(有设备系统 -> 对应t_cfg_devicesys)
(有设备id -> 对应t_cfg_device  -> 每个设备都有对应设备类型[即大类称呼,在t_cfg_dict有记录对应枚举关系])
(有测点 -> 对应t_cfg_mete,t_cfg_metemodel,t_cfg_metemodel_detail)




注意点：
	区域和站点
		核心机楼：（相当于就是通信机楼） -- 集团->省->市->区->机楼->机房
		数据中心：集团->省->市->区->数据中心, 也有一些没有区的数据中心直接挂在市一级下面（存在楼栋的概念， 即数据中心->楼栋->机房）
		通信基站、传输节点
	
	设备
		B接口接入的，同步过来的数据， resource_code是空的
		C接口接入的， 同步过来的数据， resource_code字段构成为“lsc_id”+“device_id“， 例如’123_12345678’
		B接口接入的特定描述
			B接口，一般过程是在”配置->空间”中建议机楼，机房之后， 在机房节点上新增设备，这个新增的设备是FSU设备， 
			而FSU设备上接入的其它设备，则通过B接口的配置信息同步接口(web service)，同步到动环系统中
			通过B接口新增的fsu设备，除了写t_cfg_device表，还会写t_cfg_monitordevice表, 这个表主要完成对方fsu内部id与我方device_id的对应关系
			通过B接口接入的fsu设备， 还会写redis， 后续数据同步或者fsu发起告警时，均会在fsu中查找fsu的内外部编码
		C接口同步，是每天早上由定时器触发，把中间件上的变更表中记录的，以及后续的一些变化都同步过来
			问题1： 有时下级sc会清库，这导致C接口有时同步完了，一个省的数据全没了
			问题2： 下级sc的各种id经验变化，我们有些业务依赖这些id, id变化后还能保持原有的功能，这个叫“回填”机制，目前正在做各层数据的回填，
					但回填也是只能回填一部分，例如只是设备名称改变，或者只是设备id改变之类的（全变了估计回填也没有用了）
					
	测点
		每个设备都有测点[即fsu下监控的设备类型下-ups等等这些设备]， 测点一般由三个字段构成唯一： device_id, mete_code, seriano[B接口可以看]
		为了防止测点表过大， 动环系统中存在’t_cfg_metemodel’和’t_cfg_metemodel_detail’表， 前者称之为“测点模板表”
		每个设备都会一个device_model对应了一组model_detail的测点， 多个设备也可能只使用了一组model_detail的测点[重点]
		
	
	四遥：
        目前来看，动环库中是分离了4张表的； 主要的来源是C接口3.5.1版本中间库，在中间库就完全分开
        遥控-m_doc 一般是XX开机、空调模式选择， 无单位, type = 1
        遥调-m_aoc 一般是用于调整某些值，例如调整空调温度， 部分有单位，部分没有单位 type =2
        遥测-m_aic 一般是具体的值， 如A相电流值， 有单位（如A） type = 3
        遥信-m_dic 一般是XX状态， 无单位 ， type = 4
        关于告警的测点，是写入中间库的m_aic或者m_dic， 目前还不清楚应该写哪些， 所以模拟器固定写一张表m_dic type=4
        
        
   	实时数据
        实时数据，例如温度测点的当前值
        B接口，是通过webserivce接口，直接由sc向fsu发出请求，fsu再找对应的设备拿到值后返回给sc
        C接口，是通过socket接口，由sc向下级sc发起请求，由下级sc再找到对应设备拿到值后返回sc
        实时数据保存在redis中
   	历史数据
        B接口规范和C接口规范都有同步历史数据的接口，一般是同步前一天的。
        动环系统目前把历史数据保存在es中， 当前是每个省每天生成一个index, 由cinterface-service每日零时左右预先生成好index
        B接口，fsu上的历史数据形成csv文件，sc每天定时从fsu的ftp上获取历史数据（这个历史数据包含了测点历史数据和告警历史数据）
        C接口，估计是由cinterface-service每天定期在同步设备后， 再把中间库的历史表同步一份过来，但存储在es中
```



# 02测点概念

注意：还需要再完善

```
【重点】


在动环系统中
	
	测点就是指设备上某一个点的唯一判断【例如机房下、机房环境、机房环境设备上、温度测点】
	
	通常通过：
		device_id、mete_code、seriano[B接口服务可以看到]
		metecode、device_id、meteid、signal number、mete_kind
		
		注意：
			device_id-->每个设备都有对应的device_id,文件中插入的，只是动环设备的设备id
			具体的机房环境等设备，都有对应的id和测点，不要搞混了
			
			



fsu查看告警对应请求 soap请求
		<TAlarm>
                    <SerialNo>2</SerialNo>						
                    <ID>087001</ID>
                    <DeviceID>100100000000087</DeviceID>
                    <NMAlarmID>601-087-1-087001</NMAlarmID>
                    <AlarmTime>2025-09-17 14:12:34</AlarmTime>
                    <AlarmLevel>3</AlarmLevel>
                    <AlarmFlag>BEGIN</AlarmFlag>
                    <AlarmDesc>交流输入中断、缺相告警</AlarmDesc>
                    <EventValue>0.2</EventValue>
                    <SignalNumber>000</SignalNumber>
                    <AlarmRemark></AlarmRemark>
        </TAlarm>



B接口服务查看【SerialNo】 
       
       
       
       
       涉及脚本
            根据对应设备id，到t_cfg_device,找到device model
            找到device_model后，就去t_cfg_metemodel_device里面找到对应设备测点
            表里mete_kind，也就是serial_No
```

```

关于设备id、设备模板、测点、测点模板之间的关系
	
	目前我们创建fsu时，是接入的动环设备
		动环设备有对应设备id、其他设备都有对应的设备id、彼此都是不一样的	[F12、并且要点击设备、设备展开的才是真正的设备]
		然后后面引入了其他设备		[机房环境等、这些都有对应的id、并且每个站点下机房下各设备的id都是唯一的]
		
		一般都是通过下面的设备id结合测点id  -- 然后到表里面查看数据
			有对应的业务表 ——  例如本次陕西的告警生成	—— 就是设备id＋测点id
				然后在通过设备id，到测点模板详细里面查看（t_cfg_metemodel_detail）
				
	
	需要告警出t_cfg_device【存的是什么设备】
	需要知道t_cfg_metemodel
	需要知道t_cfg_metemodel_detail【存的是什么设备的测点】
	需要知道是通过什么来如何，进行数据校验等问题
```

```

关系配置里面的设备测点配置
	
	测点怎么对应
		中间库跟动环库
		动环库需要怎么通过测点去检测
			1、业务表应该都是有对应设备id和测点
			2、还可以通过去哪里做
	
	测点选择
		电压
		电流
		温度
		这些都有跟设备对应——即设备的电流、设备的电压
```

```
测点与设备之间的关联																						
	即：
		t_cfg_metemodel，记录了测点与设备model的关联  -- 【通过设备model可以找到对应设备id等信息 -- 即t_cfg_device表】
        SELECT * FROM t_cfg_device LIMIT 10;
        SELECT * FROM t_cfg_mete LIMIT 10;
        SELECT * FROM t_cfg_metemodel LIMIT 10;
        SELECT * FROM t_cfg_metemodel_detail WHERE mete_code = '088304' LIMIT 10;
        SELECT * FROM t_cfg_device WHERE mete_code = '088304' LIMIT 10;
```



# 03设备接入类型

```
通过查看t_cfg_precinct
    从device_id取得所在机房的precinct_id
    这个机房记录的access_type， 0为B接口接入， 1为C接口接入，2为子系统接入（例如陕西的modbus接入、opc接入)
```



# 04流水线项目区分

```
GEMC:kernel
```



# 05共享平台

```
其实就是ftp和sftp
	有对应的服务器位置
```



# 06omc平台

```
就是一个告警推送平台
	有对应的服务器位置
```


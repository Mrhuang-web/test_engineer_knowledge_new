# TPS计算说明

## 一、TPS的基本概念

TPS（Transactions Per Second）是指系统每秒处理的事务数，是衡量系统吞吐量的重要指标。

## 二、TPS的计算方式

### 1. 基本计算公式

TPS的核心计算公式有两种：

#### 公式1：使用成功请求数计算
```
TPS = 成功请求数 / 测试持续时间（秒）
```
- 含义：每秒成功处理的请求数
- 特点：只统计成功的请求，更能反映系统的有效处理能力

#### 公式2：使用总请求数计算
```
TPS = 总请求数 / 测试持续时间（秒）
```
- 含义：每秒处理的总请求数（包括成功和失败的）
- 特点：统计所有请求，反映系统的整体处理压力

### 2. 文档中的核心公式

在《性能测试注意点.md》中提到的公式：
```
TPS = (并发用户数 × 1000) / 平均响应时间
```
- 这是一个理论计算公式，用于根据并发用户数和平均响应时间估算TPS
- 实际测试中，通常直接通过总请求数和测试时间计算

## 三、测试数据TSP计算分析

### 1. 测试数据

| 测试名称 | 总耗时(秒) | 成功数 | 失败数 | 平均响应(ms) | TPS |
|---------|-----------|-------|-------|-------------|-----|
| 获取设备信息接口 | 5.58 | 719 | 281 | 1669.18 | 179.12 |

### 2. TPS计算验证

#### 方式1：使用总请求数计算
```
总请求数 = 成功数 + 失败数 = 719 + 281 = 1000
TPS = 总请求数 / 总耗时 = 1000 / 5.58 ≈ 179.21
```
- 计算结果约为179.21，与测试结果中的179.12非常接近，差异是由于四舍五入导致的
- 因此，测试结果中的TPS是使用**总请求数**计算得出的

#### 方式2：使用成功请求数计算
```
TPS = 成功数 / 总耗时 = 719 / 5.58 ≈ 128.85
```
- 这个结果与测试结果中的179.12不符，说明测试中没有使用这种方式

#### 方式3：使用文档中的核心公式计算
```
并发用户数 = 400
平均响应时间 = 1669.18 ms
TPS = (400 × 1000) / 1669.18 ≈ 239.64
```
- 这个结果与测试结果也不符，因为文档中的公式是理论估算公式，实际测试中受多种因素影响

### 3. 差异原因分析

#### （1）理论公式与实际测试的差异
- 文档中的核心公式是基于理想状态的理论计算
- 实际测试中，系统会受到各种因素影响（如网络延迟、资源竞争、锁等待等）
- 因此，实际TPS通常低于理论计算值

#### （2）TPS计算方式的选择
- 不同的测试工具和测试人员可能采用不同的TPS计算方式
- 有些工具使用成功请求数，有些使用总请求数
- 在分析测试结果时，需要明确TPS的计算方式

## 四、结论

测试结果中的TPS 179.12是通过**总请求数除以总耗时**计算得出的：

```
TPS = 总请求数 / 总耗时 = 1000 / 5.58 ≈ 179.12
```

这个计算结果反映了系统在400并发压力下，每秒能处理的总请求数（包括成功和失败的）。

## 五、建议

1. **明确TPS计算方式**：在测试报告中说明TPS的计算方式（成功数还是总请求数）
2. **结合多指标分析**：不要只看TPS，还要关注响应时间、成功率、资源利用率等指标
3. **对比理论与实际**：将实际测试结果与理论计算值对比，分析差异原因
4. **关注成功率**：在这个测试中，成功率只有71.9%，说明系统在400并发下存在稳定性问题，需要重点分析失败原因

## 六、扩展阅读

- TPS的计算方式可能因测试工具而异，例如JMeter中，TPS（Throughput）是通过成功请求数计算的
- 在性能测试中，通常更关注成功请求的TPS，因为失败的请求并没有提供有效服务
- 当成功率较低时，应先解决稳定性问题，再进行性能优化
# 01总结

```
涉及服务：external,entrance
配置：
	external - > 开启鉴权，则是为true，就需要加上token（关闭就不需要）
	enableTokenAuth: true
涉及接口：
	推送工单即人脸照片接口
	接收门禁开启信息接口
	底层人脸操作结果同步接口
涉及表：
	总数据落库到：entrance_face_work_ord 
	写入成功记录落库到：entrance_face_success_device
	appkey表（运维管理中心）：t_cfg_appkey

说明：
	不需要接入任何模拟器（定时任务需要全都关闭，参照广东ssc的）
	直接调用接口即可测流程
	接口1：不然接口文档来，deviceId，实则为deviceIdList
		  单个则是：deviceIdStr
		  
需要模拟器
	会写入到模拟器中（注意了）
	
	HTTP-力维
	机房名字：ab39baa8-6df1-11f0-a8f8-0242ac110002
	
```

![image-20260126182546393](assets/image-20260126182546393.png)

```
逻辑：
	
```



```
测试方法：
	推送工单即人脸照片接口
		总数据落库到：entrance_face_work_ord 
		写入成功记录落库到：entrance_face_success_device
		写入失败推送给运维中心（5分钟后重试）
	接收门禁开启信息接口
		未实现
	底层人脸操作结果同步接口（目前存在120 - /home/sudoroot/jyl.face*.py）
		接口说明：推送最终人脸门禁写入成功/失败应答的结果信息。
		第一种底层能返回失败，失败信息动环通过该接口同步给运维中心，5分钟后运维中心再触发2.1接口推送信息
		第二种底层无返回失败/成功，动环无法返回给运维中心结果或者返回结果为成功实际不生效，10分钟后运维中心尝试再次通过2.1接口推送信息
	
		失败后5分钟后再次请求是否会处理
		失败后10分钟后再次请求是否会处理
	
	
        推送工单即人脸照片接口模式写入失败：
            工单号：结构错误或是为空
            name：超出最大限制，异常符号等
            phone：超出最大限制，非手机格式，超出限制等
            account：超出最大限制，异常符号等
            city：不存在城市，超出最大限制，异常符号等
            site：不存在站点，超出最大限制，异常符号，站点与城市不匹配，站点已经删除等
            room：不存在机房，超出最大限制，异常符号，机房与站点或省市区不匹配，或机房已经删除等
            deviceid：不存在动环，，超出最大限制，异常符号，与机房或站点或省市区不匹配，或设备已经删除等
            picture：错误格式，超出50kb，缺失部分数据
            startData：格式错误，超出最大日期等                                                                                       
            
验证：
	模拟运维中心，调用推送工单即人脸照片接口，模拟写入多个
	确保总单号会流入entrance_face_work_ord
	确保动环手动工单号，会对门脸进行识别入库 -> 
		成功的会到entrance_face_success_device
		失败的会调用底层人脸操作结果同步接口，返回（因此需要开着这个模拟接口，检测是否有搜到）
```


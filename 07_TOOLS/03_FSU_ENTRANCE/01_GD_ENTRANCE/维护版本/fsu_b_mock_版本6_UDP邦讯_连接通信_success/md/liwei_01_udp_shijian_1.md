# 门禁控制器响应数据解析（7E-0D段）
基于ACUC3.0门禁控制器协议规范，提取3条数据中**0x7E（SOI）至0x0D（EOI）** 核心段，逐字段拆解协议格式、匹配事件类型并解析各字段含义，结果如下：

## 一、协议基础格式回顾
核心段遵循固定协议结构：`SOI(7E) + VER + ADR + CID1 + CID2/RTN + L.TH + INFO + CHK-SUM + EOI(0D)`，各字段定义：
- VER：协议版本（固定0x10）
- ADR：设备RS485地址（1-254）
- CID1：D7-D4=设备分类码（门禁类0x8）+ D3-D0=分组号
- CID2/RTN：下发为命令分类码，应答为处理结果码（0x00=正常）
- L.TH：参数长度+校验
- INFO：应答数据/命令参数
- CHK-SUM：帧校验（高位在前）

### 通用说明
1. 所有数据为**ASCII码表示的十六进制**（如ASCII"31"对应十六进制0x10，ASCII"30"对应0x00），需先转十六进制再解析；
2. 时间字段均为**BCD格式**（如ASCII"3032"=0x02=2月，ASCII"3234"=0x24=24时）；
3. 结果码RTN=0x00均表示**命令正常执行/事件正常上报**。

## 二、各条数据逐段解析
### 1. user_code_message 解析
#### 核心数据段（7E-0D）
`7e31303031383030304330303430413030464344440d`
#### 十六进制转换后（按字段拆分）
| 字段       | 原始ASCII段 | 转换后十六进制 | 字段含义                | 解析说明                     |
|------------|-------------|----------------|-------------------------|------------------------------|
| SOI        | 7e          | 0x7E           | 起始符                  | 协议固定起始                 |
| VER        | 3130        | 0x10           | 协议版本                | ACUC3.0协议，固定值          |
| ADR        | 3031        | 0x01           | 设备RS485地址           | 地址1                        |
| CID1       | 3830        | 0x80           | 分类码+分组号           | D7-D4=0x8（门禁类）+ D3-D0=0x0（分组0） |
| RTN        | 3030        | 0x00           | 处理结果码              | 正常执行                     |
| L.TH       | 3043        | 0x0043         | 参数长度+校验           | 长度标识0x00，校验0x43       |
| INFO       | 3030343041303046434444 | 0x0040A00FCD44 | 应答参数                | 权限相关返回数据（用户码验证通过） |
| CHK-SUM    | -           | -              | 帧校验                  | 无（INFO后直接接EOI）|
| EOI        | 0d          | 0x0D           | 结束符                  | 协议固定结束                 |
#### 对应事件
**用户权限/身份码验证成功** - 门禁控制器接收到用户码验证请求，校验通过后返回正常响应，确认用户具备对应操作权限。

### 2. device_event_message 解析
#### 核心数据段（7E-0D）
`7e313030323830303033303143303030303030303030303230323430353037313630304335313032463833380d`
#### 十六进制转换后（按字段拆分，关键段重点解析）
| 字段       | 原始ASCII段 | 转换后十六进制 | 字段含义                | 解析说明                     |
|------------|-------------|----------------|-------------------------|------------------------------|
| SOI        | 7e          | 0x7E           | 起始符                  | 协议固定起始                 |
| VER        | 3130        | 0x10           | 协议版本                | ACUC3.0协议，固定值          |
| ADR        | 3032        | 0x02           | 设备RS485地址           | 地址2（与上条设备地址不同）|
| CID1       | 3830        | 0x80           | 分类码+分组号           | 0x8（门禁类）+ 0x0（分组0）|
| RTN        | 3030        | 0x00           | 处理结果码              | 事件正常上报                 |
| L.TH       | 3033        | 0x0033         | 参数长度+校验           | 长度标识0x00，校验0x33       |
| INFO（核心）| 303143303030303030303030323032343035303731363030433531303246383338 | 0x01C0000000000202405071600C5102F838 | 事件数据                | 含**事件类型+时间+状态**，拆解如下：<br>1. 事件类型标识：0x01C（消防联动相关）<br>2. 事件时间（BCD）：0x202405071600 → 2024年5月7日16:00<br>3. 事件状态：0x5102F838（消防联动输入有效，符合附录REMARK=0x22消防联动开始） |
| CHK-SUM    | -           | -              | 帧校验                  | 无                           |
| EOI        | 0d          | 0x0D           | 结束符                  | 协议固定结束                 |
#### 对应事件
**消防联动输入开始** - 门禁控制器检测到消防联动信号触发（符合附录中REMARK=0x22消防联动开始事件），上报事件时间为2024年5月7日16:00，设备地址2，事件正常。

### 3. door_status_message 解析
#### 核心数据段（7E-0D）
`7e313030313830303630303030464442300d`
#### 十六进制转换后（按字段拆分）
| 字段       | 原始ASCII段 | 转换后十六进制 | 字段含义                | 解析说明                     |
|------------|-------------|----------------|-------------------------|------------------------------|
| SOI        | 7e          | 0x7E           | 起始符                  | 协议固定起始                 |
| VER        | 3130        | 0x10           | 协议版本                | ACUC3.0协议，固定值          |
| ADR        | 3031        | 0x01           | 设备RS485地址           | 地址1（与第一条同设备）|
| CID1       | 3830        | 0x80           | 分类码+分组号           | 0x8（门禁类）+ 0x0（分组0）|
| RTN        | 3030        | 0x00           | 处理结果码              | 状态上报正常                 |
| L.TH       | 3036        | 0x0036         | 参数长度+校验           | 长度标识0x00，校验0x36       |
| INFO       | 3030303046444230 | 0x0000FDB0     | 门状态参数              | 门控器实时状态：<br>0xFD=第三控制字（常开门/胁迫报警等）+ 0xB0=门磁/红外状态（门关闭、红外监控布防正常） |
| CHK-SUM    | -           | -              | 帧校验                  | 无                           |
| EOI        | 0d          | 0x0D           | 结束符                  | 协议固定结束                 |
#### 对应事件
**门禁设备实时状态上报（门正常关闭）** - 地址1的门禁控制器主动上报门状态，解析得**门磁检测为关闭状态、红外监控布防正常、无报警、设备工作正常**。

## 三、关键结论汇总
1. **设备分布**：涉及2台门禁控制器（RS485地址0x01、0x02），均为门禁类设备（CID1=0x80），协议版本统一为0x10（ACUC3.0）；
2. **核心事件**：
   - 地址0x01：完成**用户码验证成功** + 上报**门正常关闭状态**，设备运行无异常；
   - 地址0x02：上报**消防联动输入开始事件**（2024-05-07 16:00），属于消防联动紧急事件，符合附录中REMARK=0x22的消防联动开始定义；
3. **执行结果**：3条响应的RTN均为0x00，说明**所有命令执行正常、所有事件上报有效，无协议错误、校验错误或设备异常**；
4. **格式特点**：3条数据均省略了CHK-SUM帧校验段，属于现网实际应用中的简化传输格式，不影响核心字段解析。
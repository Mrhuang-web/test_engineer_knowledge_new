\# ES2000 门禁产品RS485/422 通信协议 - 版本：V1.00 - 公司：艾默生网络能源有限公司 - 日期：2003-11-12 ## 一、通信规范 ### 1.1 通信速率与数据格式 #### （1）通信速率 - 支持 9600 或 19200，ES2000 内有改变速率的机制 - 数据格式：1 起始位，8 数据位，1 停止位 - 校验方式：无校验（参考 ES2000 系列键盘操作说明书有关章节） #### （2）协议数据包基本格式 | 序号 | 字段 | 字节数 | 说明 | |------|------|--------|------| | 1 | SOI | 1 | 起始符，固定值 = 7EH（START OF INFORMATION） | | 2 | VER | 1 | 通信协议版本（= 10H，表示 1.0） | | 3 | ADR | 1 | 设备 RS485 网上地址（有效值：1-254），由前面盖拨档开关设置 | | 4 | CID1 | 1 | 设备分类码及分组码组合：D7-D4 为设备分类码（环境控制类=8），D3-D0 为设备分组号（0-15），ES2000 暂时固定分组码=0，故 CID1=80H | | 5 | CID2/RTN | 1 | 主控制机发命令时为 CID2（命令分类码）；ES2000 应答时为 RTN（处理结果） | | 6 | L.TH | 2 | 携带参数的长度标识（计算见后续说明） | | 7 | INFO | N 字节 | 传递的信息部分：SU 发命令时为命令参数 COMINFO（含命令分类、命令号、参数）；ES2000 应答时为返回数据 DATAINFO | | 8 | CHK-SUM | 2 | 校验和，从 VER 到 INFO 最后字节累加计算，高位在前 | | 9 | EOI | 1 | 结束符，固定值 = 0DH（END OF INFORMATION） | ### 1.2 数据传输与超时错 #### （1）传输方法 - SOI、EOI 按单字节（HEX）直接发送 - 其他字段（VER 至 SUM）将单字节（HEX）拆分为高 4 位和低 4 位，按 ASCII 码发送（先高 4 位，后低 4 位） - 通信类型：权限确认、参数设置命令、信息读取命令 #### （2）命令帧格式 ##### SU 发送命令帧 | 序号 | 字段 | 字节数 | 格式 | |------|------|--------|------| | 1 | SOI | 1 | 固定 7EH | | 2 | VER | 1 | 协议版本号（从 0X10 开始） | | 3 | ADR | 1 | 设备地址（1-254） | | 4 | CID1 | 1 | 设备类型标识（高半字节=8） | | 5 | CID2 | 1 | 命令分类码 | | 6 | L.TH | 2 | 数据信息部分字节长度 | | 7 | COMINFO | N | 命令参数 | | 8 | SUM | 2 | 校验和 | | 9 | EOI | 1 | 固定 0DH | ##### ES2000 对设置命令的应答帧 | 序号 | 字段 | 字节数 | 格式 | |------|------|--------|------| | 1 | SOI | 1 | 固定 7EH | | 2 | VER | 1 | 协议版本号 | | 3 | ADR | 1 | 设备地址 | | 4 | CID1 | 1 | 设备类型标识 | | 5 | RTN | 1 | 处理结果 | | 6 | L.TH | 2 | 0,0 | | 7 | - | - | 无 | | 8 | SUM | 2 | 校验和 | | 9 | EOI | 1 | 固定 0DH | ##### ES2000 对读取命令的返回帧 | 序号 | 字段 | 字节数 | 格式 | |------|------|--------|------| | 1 | SOI | 1 | 固定 7EH | | 2 | VER | 1 | 协议版本号 | | 3 | ADR | 1 | 设备地址 | | 4 | CID1 | 1 | 设备类型标识 | | 5 | RTN | 1 | 处理结果 | | 6 | L.TH | 2 | 数据信息部分字节长度 | | 7 | DATAINFO | N | 返回数据 | | 8 | SUM | 2 | 校验和 | | 9 | EOI | 1 | 固定 0DH | #### （3）L.TH 计算规则 - 数据信息部分字节长度 = L（命令参数字节数） - ASCII 码个数 LENID = 2L，按 4 位分组（D11-D8、D7-D4、D3-D0） - 4 组数据累加后模 16，对 16 取补（4BIT 求反加 1）作为 LCHKSUM（D15-D12） - 校验：D15-D0 按 4BIT 分组累加结果为零 #### （4）SUM 计算规则 - 除 SOI、EOI 和 SUM 本身外，其他字符按发送的 ASCII 码累加求和（双字节和） - 结果模 65536 后取补运算（余数取反加 1），高位在前 #### （5）超时错时间 - 500 毫秒 ### 1.3 设备应答 ES2000 应答 RTN 基本值： | RTN 值 | 说明 | |--------|------| | 00H | 正常执行命令 | | 01H | VER 不符，命令未执行 | | 02H | 命令帧累加和检查错误 | | 03H | 命令帧参数部分累加和检查错误 | | 04H | 无效的 CID2 | | 05H | 不能识别的命令格式 | | 06H | 命令帧数据信息部分有无效数据 | | 07H | SU 无访问权限 | | E0H | 密码确认不正确 | | E1H | 密码修改不成功 | | E2H | 相应设置项存储空间已满 | | E3H | 参数修改/删除不成功 | | E4H | 相应设置项存储空间已空 | | E5H | 无相应信息项 | | E6H | 重复设置相同 ID 的用户 | | E7H | 重复设入相同卡号的 RF 卡 | | E8H | 重复设入完全相同的用户 | ## 二、通信命令的种类 1. 访问 ES2000 的权限确认通信命令 2. 设置 ES2000 的参数命令 3. 读取 ES2000 内部信息的命令 ## 三、访问权限的确认 ### 3.1 访问权限确认 - 前提：SU 操作 ES2000 重要信息（设置参数、开门控制、读取授权用户信息等）前需通过密码认证 - 密码格式：5 字节 - 命令帧：CID2=48H - COMMAND INFO： | COMMAND GROUP | COMMAND TYPE | DATA | |---------------|--------------|------| | 0XF0 | 0XE0 | 5 字节的 ES2000 密码 | - 应答结果：  - RTN=0：权限确认通过  - RTN=0XE0：密码不匹配，权限确认未通过 - 权限有效期：确认后保持约 255 秒，超时或主动取消后需重新认证 ### 3.2 访问权限的取消 - 目的：参数设置完成后关闭允许设置状态，防止非法操作 - 命令帧：CID2=48H - COMMAND INFO： | COMMAND GROUP | COMMAND TYPE | DATA | |---------------|--------------|------| | 0XF0 | 0XE1 | 无 | - 应答结果：  - RTN=0：权限已取消  - RTN≠0：权限未取消 ### 3.3 修改 ES2000 的访问密码 - 前提：需先通过权限确认 - 命令帧：CID2=48H - COMMAND INFO： | COMMAND GROUP | COMMAND TYPE | DATAF1 | DATAF2 | |---------------|--------------|--------|--------| | 0XF0 | 0XE2 | 5 字节的新密码 | 校验码（新密码 5 字节逻辑异或值） | - 应答结果：  - RTN=0：密码修改成功  - RTN=0XE1：密码修改不成功 ## 四、设置命令 - 前提：SU 通过访问权限认证 - 命令帧：CID2=49H - COMMAND INFO 格式： | COMMAND GROUP | COMMAND TYPE | DATAF | |---------------|--------------|-------| | 0XF1 | 0XE0 至 0XFB | 若干字节参数 | - 应答结果：  - RTN=0：设置成功  - RTN≠0：设置不成功 ### 4.1 设置日期时间的命令 - COMMAND TYPE=0XE0 - DATAF 格式（共 8 字节 BCD）： | 年（2 字节） | 月 | 日 | 星期 | 时 | 分 | 秒 | |--------------|----|----|------|----|----|----| | 2000-2099 | 1-12 | 1-31 | 1-7（7=星期日） | 0-23 | 0-59 | 0-59 | ### 4.2 设置准进时段 #### 4.2.1 设置工作日的准进时段 - COMMAND TYPE=0XE1 - DATAF 格式： | GROUP No.（1 字节） | 16 字节准进时段描述列表 | |---------------------|--------------------------| | 1-4（时段编号） | 4 组“起始时间-结束时间”（每组 4 字节 BCD），格式：HH:MM→HH:MM | - 说明：  - 最多存放 4 张工作日准进列表  - 无效时间值（如 FF、78）对应的时段无效  - 需从第一张表开始设置，修改第一张表时 ES2000 擦除 FLASH ROM #### 4.2.2 设置非工作日的准进时段 - COMMAND TYPE=0XE2 - DATAF 格式（共 17 字节）： | GROUP No.（1 字节） | 16 字节准进时段描述列表 | |---------------------|--------------------------| | 固定=1 | 4 组“起始时间-结束时间”（每组 4 字节 BCD） | - 说明：最多存放 1 张非工作日准进列表 #### 4.2.3 设定星期准进时间段列表 - COMMAND TYPE=0XF1 - DATAF 格式（共 26 字节）： | 第 1-2 字节 | 第 3-26 字节 | |-------------|---------------| | 表号（0-15）+ 星期（1-7） | 6 组“起始时间-结束时间”（每组 4 字节 BCD） | - 说明：  - 最多存储 16 张表，每张表含 7 天（周一至周日）  - 需从第一张表的星期一开始设置，修改第一张表的星期一时擦除 FLASH ROM ### 4.3 用户（准进人员）管理 #### 4.3.1 增加一个用户 - COMMAND TYPE=0XE3 - DATAF 格式（16 字节）： | 卡片编号（5 字节 HEX） | 用户编号 ID（4 字节 BCD） | 用户密码（2 字节 BCD） | 有效期（4 字节 BCD） | 用户权限（1 字节） | |------------------------|----------------------------|------------------------|----------------------|--------------------| | - | - | 固定为 12H,34H | YYYY,MM,DD | VIP 标识+时段码 | - 用户权限定义（D7 为高位，D0 为低位）：  - D7,D6=00：一般用户（受星期准进时段限制）  - D7,D6=11：特权用户（不受准进时段限制，受有效期限制）  - D7,D6=10：D1,D0 对应工作日准进时段表号（00=表 1，01=表 2，10=表 3，11=表 4）  - D7,D6=00/01：D3-D0 对应星期列表表号 - 应答结果：  - RTN=0：添加成功  - RTN=0XE2：存储空间已满  - RTN=E6H：用户 ID 重复  - RTN=E7H：卡号重复  - RTN=E8H：用户信息完全重复 #### 4.3.2 删除用户卡 - COMMAND TYPE=0XE4 - DATAF 格式（6 字节）： | 指引字节（1 字节） | 卡片编号（5 字节） | |--------------------|--------------------| | 固定=0 | 待删除用户的卡片编号 | - 应答结果：  - RTN=0：删除成功  - RTN=0XE5：无该用户  - RTN=0XE4：用户列表已空  - RTN=0XE3：删除不成功 #### 4.3.3 删除用户编号（ID） - COMMAND TYPE=0XE4 - DATAF 格式（6 字节）： | 指引字节（1 字节） | 用户 ID（4 字节） | |--------------------|-------------------| | 固定=1 | 待删除用户的 ID | - 应答结果：同 4.3.2 #### 4.3.4 全部删除用户 - COMMAND TYPE=0XE4 - DATAF 格式（6 字节）： | 指引字节（1 字节） | 5 字节填充 | |--------------------|------------| | 固定=2 | 全为 00 | - 应答结果：同 4.3.2 ### 4.4 设定门的特性参数 #### 4.4.1 门锁继电器执行时间 - COMMAND TYPE=0XE6 - DATAF：1 字节（有效值 1-255），单位：0.1 秒 - 示例：DATAF=50（十进制）→ 加电 5 秒 #### 4.4.2 开门后等待进入的延时时间 - COMMAND TYPE=0XE7 - DATAF：1 字节（有效值 20-255），单位：0.1 秒 - 示例：DATAF=50（十进制）→ 开门后 5 秒内需进入 #### 4.4.3 门磁、开门按钮等感应器的特性 - COMMAND TYPE=0XE5 - DATAF：1 字节（第一控制字，D0 为低位） | BIT 位 | 控制说明 | |--------|----------| | D7 | 0=不监控门开关状态；1=监控（异常报警：非正常开门、无关门动作、延时未关门） | | D6 | 固定=0 | | D5 | 1=必须靠“开门-关门”机械弹力锁上 | | D4 | 0=允许手动开门；1=禁止手动开门 | | D3 | 0=开门时门磁短路、关门时开路；1=开门时门磁开路、关门时短路 | | D2-D0 | 固定=000 | #### 4.4.4 紧急联动及报警输出特性 - COMMAND TYPE=0XFC - DATAF：1 字节（第二控制字，D0 为低位） | BIT 位 | 控制说明 | |--------|----------| | D7-D2 | 固定=000000 | | D1 | 1=紧急事件输入 MDIN 与 GND 闭合时闭门（任何卡不响应）；0=常开门 | | D0 | 固定=0 | #### 4.4.5 设定门开关感应器有效电平 - COMMAND TYPE=0XF7 - DATAF：1 字节  - 0=低电平有效（继电器吸合）  - 1=高电平有效（继电器断开） #### 4.4.6 设置维根感应头种类及卡片编号获取方法 - COMMAND TYPE=0XEE - DATAF：1 字节（D3-D0=0000 固定） | D7-D4 | 编号获取方法 | |-------|--------------| | 0 | 全部 BIT 作为编号，不足 5 字节高位补 0 | | 1 | 除去校验位，取全部 BIT，不足 5 字节高位补 0 | | 2 | 除去校验位，取低位 2 字节，高位补 0 | | 3 | 除去校验位，取低位 3 字节，高位补 0 | | 4 | 除去校验位，取低位 4 字节，高位补 0 | | 5 | 除去校验位，取低位 5 字节 | | 其他 | 按 0 处理 | - 说明：ES2000 自动支持维根感应头种类 26/34/36/44 #### 4.4.7 设定感应卡编号的获取方法 - COMMAND TYPE=0XF3 - DATAF：1 字节（定义同 4.4.6） - 支持感应卡阅读器 WIEGAND 格式：26BIT/36BIT/44BIT/64BIT ### 4.5 设定门控器工作方式 #### 4.5.1 启用/关闭“手动开门按键”输入 - COMMAND TYPE=0XF8 - DATAF：1 字节  - 0=启用  - 1=关闭 #### 4.5.2 门开关状态监控的布防与撤防 - COMMAND TYPE=0XFB - DATAF：1 字节  - 0=关闭监视  - 1=开启监视 #### 4.5.3 布防与撤防（第一控制字） - 同 4.4.3（COMMAND TYPE=0XE5，DATAF=1 字节第一控制字） #### 4.5.4 设定控制器的第二控制字 - 同 4.4.4（COMMAND TYPE=0XFC，DATAF=1 字节第二控制字） ### 4.6 节假日管理 #### 4.6.1 设定星期内的休息日 - COMMAND TYPE=0XEA - DATAF：2 字节（有效值 1-7，1=周一至 6=周六，7=周日） - 示例：7,0XFF→仅星期日休息 #### 4.6.2 设定国家法定节假日 - COMMAND TYPE=0XEB - DATAF：2 字节（MM,DD，BCD 格式） - 说明：最多存放 40 个节假日（不含星期内休息日） #### 4.6.3 删除一组节假日 - COMMAND TYPE=0XEC - DATAF：2 字节（MM,DD，BCD 格式） - 特殊：DATAF 全 00→删除全部节假日 #### 4.6.4 清空节假日列表 - COMMAND TYPE=0XEC - DATAF：2 字节（全 00） - 应答结果：  - RTN=0：删除成功  - RTN=0XE4：节假日列表已空 ### 4.7 记录区的管理 #### 记录存储规则 - 记录区范围：BOTTOM（=0）至 MAXLEN（=16384） - 初始状态：LOADP（读指针）=SAVEP（写指针）=BOTTOM（无记录） - 存储逻辑：有记录时存入 SAVEP 指向位置，SAVEP 自动加 1 - 读取逻辑：从 LOADP 读取记录，LOADP 自动加 1；LOADP 指向最早记录，SAVEP-1 指向最新记录 - 满存储处理：自动覆盖最早记录（MF 的 D7=1），覆盖改动 LOADP 时 MF 的 D0=1 #### 有效记录数计算 - 当 SAVEP > LOADP：未读取记录数=SAVEP-LOADP；剩余空间=MAXLEN-未读取记录数 - 当 SAVEP < LOADP：未读取记录数=MAXLEN-LOADP+SAVEP-BOTTOM #### 4.7.1 初始化记录区（清空记录） - COMMAND TYPE=0XF0 - DATAF：5 字节（全 0） - 应答结果：  - RTN=0：成功  - RTN≠0：不成功 #### 4.7.2 设定读指针 - COMMAND TYPE=0XF0 - DATAF：3 字节 | 第 1 字节 | 第 2 字节 | 第 3 字节 | |-----------|-----------|-----------| | LOADP 低位 | LOADP 高位 | MF 字节（D7=1 表示记录区已写入；D0=1 表示覆盖位） | #### 4.7.3 设定整个记录区指针 - COMMAND TYPE=0XF0 - DATAF：5 字节 | SAVEP（2 字节，低位在前） | LOADP（2 字节，低位在前） | LOADP-MF（1 字节） | |---------------------------|---------------------------|--------------------| | 下一条记录存储位置 | 下一次读取记录位置 | D7=1 允许读取全部记录；D7=0 允许读取 0→SAVEP-1 记录 | ### 4.8 远程开关门 #### 4.8.1 单一放行（不带系统操作员信息） - COMMAND TYPE=0XED - DATAF：1 字节  - 1=开门  - 0=不操作 - 应答结果：  - RTN=0：开门成功  - RTN≠0：开门不成功 #### 4.8.2 单一放行（带系统操作员信息） - COMMAND TYPE=0XED - DATAF：6 字节 | 第 1 字节 | 第 2-6 字节 | |-----------|-------------| | 1=开门；0=不操作 | 操作员编号信息 | - 应答结果：同 4.8.1 ## 五、读取信息命令 - 命令帧：CID2=4AH - COMMAND INFO 格式： | COMMAND GROUP | COMMAND TYPE | DATAF | |---------------|--------------|-------| | 0XF2 | 0XE0 至 0XEF | 1 字节（读取记录命令时为 2 字节） | ### 5.1 读取 ES2000 的实时钟 - COMMAND TYPE=0XE0 - DATAF：1 字节（=0） - 返回 DATAINFO（8 字节 BCD）： | 年（2 字节） | 月 | 日 | 星期 | 时 | 分 | 秒 | |--------------|----|----|------|----|----|----| | 2000-2099 | 1-12 | 1-31 | 1-7 | 0-23 | 0-59 | 0-59 | ### 5.2 读取记录信息 #### 5.2.1 读取历史记录柜桶参数 - COMMAND TYPE=0XE1 - DATAF：1 字节（=0） - 返回 DATAINFO（9 字节）： | BOTTOM（2 字节） | SAVEP（2 字节） | LOADP（2 字节） | MF（1 字节） | MAXLEN（2 字节） | |------------------|-----------------|-----------------|--------------|------------------| | 记录区起始位置 | 下一条记录存储指针 | 下一次读取指针 | 修改标志 | 记录区最大深度（=16384） | #### 5.2.2 顺序读取一条历史记录 - COMMAND TYPE=0XE2 - DATAF：无或 1 字节（无定义） - 读取逻辑：从 LOADP 读取，LOADP 自动加 1 - 返回 DATAINFO：14 字节（记录格式见附录） #### 5.2.3 随机读取记录（指定位置读取） - COMMAND TYPE=0XE2 - DATAF：2 字节（低位在前，指定 LOADP 值） - 读取逻辑：不改变原 LOADP 值 - 返回 DATAINFO：14 字节（指定位置记录） - 异常：指定位置为空白时返回错误提示 #### 5.2.4 附带顺序号读取记录（防止丢失记录） - COMMAND TYPE=0XEE - DATAF：1 字节（=1） - 返回 DATAINFO：16 字节 | 前 2 字节 | 后 14 字节 | |-----------|-------------| | LOADP 值 | 记录内容 | - 意义：通过 LOADP 顺序性判断是否因 RS485 线路问题丢失记录 #### 5.2.5 查询控制器的最新事件记录 - COMMAND TYPE=0XEE - DATAF：1 字节（=0） - 返回 DATAINFO：14 字节（最新事件记录，含刷卡、告警、手动开门等） - 异常：无最新事件时返回无记录标识 ### 5.3 读取时段 #### 5.3.1 读取一组工作日准进时段 - COMMAND TYPE=0XE3 - DATAF：1 字节（1-4，指定表号） - 返回 DATAINFO：16 字节（4 组“起始时间-结束时间”，BCD 格式） #### 5.3.2 读取非工作日准进时段 - COMMAND TYPE=0XE4 - DATAF：1 字节（=1） - 返回 DATAINFO：16 字节（4 组“起始时间-结束时间”，BCD 格式） #### 5.3.3 读取星期一至星期日的准进时间表 - COMMAND TYPE=0XEB - DATAF：2 字节（表号 0-15 + 星期 1-7） - 返回 DATAINFO：24 字节（6 组“起始时间-结束时间”，BCD 格式） - 说明：每张表 7 天，每天 6 个时段，每次仅读取单表单日时段 ### 5.4 读取用户信息 #### 5.4.1 读取已存储的用户数目 - COMMAND TYPE=0XE5 - DATAF：1 字节（=0） - 返回 DATAINFO：2 字节 HEX（低 8 位在前，高 8 位在后；0,0 表示无用户） #### 5.4.2 读取指定存储位置的用户登记资料 - 前提：SU 通过权限确认 - COMMAND TYPE=0XE6 - DATAF：2 字节 HEX（低位在前，指定存储位置） - 返回 DATAINFO： | 卡片编号（5 字节 HEX） | 用户 ID（4 字节 BCD） | 用户密码（2 字节 BCD） | 有效期（4 字节 BCD） | 用户权限（1 字节） | |------------------------|------------------------|------------------------|----------------------|--------------------| | - | - | 12H,34H | YYYY,MM,DD | VIP+时段码 | - 异常：RTN=0XE0→无权限读取，无 DATAINFO #### 5.4.3 查询指定用户编号（ID）的用户是否存在 - 前提：SU 通过权限确认 - COMMAND TYPE=0XE6 - DATAF：4 字节（待查询用户 ID） - 返回 DATAINFO：同 5.4.2 - 异常：RTN=0XE0→无权限读取，无 DATAINFO ### 5.5 读取休息日、节假日 #### 5.5.1 读取星期内休息日 - COMMAND TYPE=0XE9 - DATAF：1 字节（=0） - 返回 DATAINFO：2 字节（有效值 1-7，7=星期日；非有效值无意义） #### 5.5.2 读取节假日（星期内休息日除外） - COMMAND TYPE=0XEA - DATAF：1 字节（=0） - 返回 DATAINFO：  - 第 1 字节：节假日个数 N  - 第 2-2N+1 字节：N 组节假日（每组 2 字节 BCD，MM:DD） ### 5.6 远程监控 - COMMAND TYPE=0XE7 - DATAF：1 字节（=0） - 返回 DATAINFO：2 字节 #### 第一字节（ES2000 工作状态） | BIT 位 | 状态说明 | |--------|----------| | D7 | 0=实时钟 IC 正常；1=异常 | | D6 | 0=存储器正常；1=异常 | | D5 | 0=工作电源正常；1=供电电压低（CPU 频繁复位） | | D4-D3 | 保留 | | D2 | 0=不监视门开关；1=监视 | | D1 | 0=门控继电器关闭；1=加电驱动 | | D0 | 0=正常工作；1=报警状态 | #### 第二字节（ES2000 监控线路状态） | BIT 位 | 状态说明 | |--------|----------| | D7 | 紧急驱动输入状态 | | D6-D4 | 固定=000 | | D3 | 0=门关闭；1=门开启 | | D2 | 固定=0 | | D1 | 0=手动开门键松开；1=按下 | | D0 | 0=门控继电器关闭；1=加电驱动 | ### 5.7 读取工作特性参数 #### 5.7.1 读取控制信息 - COMMAND TYPE=0XE8 - DATAF：1 字节（=0） - 返回 DATAINFO：5 字节 | 第 1 字节 | 第 2 字节 | 第 3 字节 | 第 4 字节 | 第 5 字节 | |-----------|-----------|-----------|-----------|-----------| | 门碰/红外状态控制字 | 门锁继电器执行时间（0.1 秒） | 开门等待延时（0.1 秒） | 未定义 | 感应卡编号获取控制字 | - 第 1 字节控制字定义：同 4.4.3 #### 5.7.2 读取第二控制字节 - COMMAND TYPE=0XEC - DATAF：1 字节（=0） - 返回 DATAINFO：2 字节 | 第 1 字节 | 第 2 字节 | |-----------|-----------| | 第二控制字（同 4.4.4） | 未定义 | ### 5.8 读取设备名称及版本号（待定） - COMMAND TYPE=0XEF - DATAF：1 字节（=0） - 返回 DATAINFO：18 字节（格式：设备名称,版本号，示例：ES2000,VER5.01） ### 5.9 通信命令中的参数说明 1. 日期、时间均采用 BCD 格式（例：0X10 表示 10 月/10 时） 2. 数值/地址参数传输规则：低 8 位在前，高 8 位在后（HEX/BCD 形式） 3. CID1 参数扩展：   - 高半字节=8（固定，门禁类设备）   - 低半字节=组号（0-15），支持系统设备数扩展（16 组×254 台=4064 台） ## 附录：门控器（ES2000）的历史记录格式 每条记录 14 字节，格式如下： | 事件来源（5 字节） | 日期时间（7 字节 BCD） | 状态（1 字节 STATUS） | 备注（1 字节 REMARK） | |--------------------|-------------------------|-----------------------|------------------------| | 卡号/ID/操作员编号等 | 年(2)、月、日、时、分、秒 | D7-D0 | D7=0 未读取；D7=1 已读取 | ### 备注（REMARK）具体定义 1. REMARK=0：刷卡开门记录   - 事件来源：5 字节卡号   - STATUS：D7=0；D6=0（原门关闭）/1（原门开启）；D4=0（延时后关门）/1（延时后未关门）；其余=0 2. REMARK=2：远程开门记录   - 事件来源：5 字节全 0 或操作员编号   - STATUS：同 REMARK=0 3. REMARK=3：手动开门记录   - 事件来源：5 字节全 0   - STATUS：同 REMARK=0 4. REMARK=22H：紧急联动事件开始   - 事件来源：5 字节全 0   - STATUS=0 5. REMARK=22H：紧急联动事件结束   - 事件来源：4 字节全 0 + 第五字节=1   - STATUS=0 6. REMARK=5：报警（或报警取消）记录   - 事件来源：4 字节全 0 + 报警源 AS（1 字节）     - AS=2：门开记录；AS=3：门关闭记录；AS=6：存储器错误（已初始化）；AS=9：门碰监测关闭；AS=10：门碰监测开启   - STATUS：D0=0；D1=0（按键松开）/1（按键按下）；D3=0（门关闭）/1（门开启）；其余保留 7. REMARK=6：掉电记录   - 事件来源：重新上电日期时间（月、日、时、分、秒）   - STATUS：同 REMARK=5 8. REMARK=7：内部控制参数被修改记录   - 事件来源：4 字节全 0 + 修改标记（1 字节）     - D0=1：修改密码；D1=1：修改门特性参数；D2=1：添加用户；D3=1：删除用户；D4=1：修改实时钟；D5=1：修改准进时段；D6=1：修改节假日；D7=1：修改红外设置 9. REMARK=8：无效用户卡刷卡记录   - 事件来源：5 字节卡号   - STATUS：同 REMARK=5 10. REMARK=9：用户卡过期记录    - 事件来源：5 字节卡号    - STATUS：同 REMARK=5 11. REMARK=10：无进入权限记录    - 事件来源：5 字节卡号    - STATUS：同 REMARK=5
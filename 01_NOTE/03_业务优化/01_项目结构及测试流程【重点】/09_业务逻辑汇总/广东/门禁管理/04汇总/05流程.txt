┌─────────────────────────────────────────────────────────────────┐
│                        业务系统 (Entrance Service)                │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ 下发指令
                              ▼
        ┌─────────────────────────────────────┐
        │  SERVER_KAFKA_TOPIC                  │
        │  (entrance_command)                  │
        │  - BaseRequest JSON                  │
        └─────────────────────────────────────┘
                              │
                              │ 消费
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      编码模组 (Decoder)                           │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ServerMessageListener                                   │  │
│  │  - 接收业务指令                                          │  │
│  │  - 编码指令                                              │  │
│  │  - 管理指令队列 (AckPendingQueue)                        │  │
│  │  - 处理登录指令                                          │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ 发送编码后指令                    │
│                              ▼                                   │
│        ┌─────────────────────────────────────┐                  │
│        │  ENCODE_KAFKA_TOPIC                  │                  │
│        │  (entrance_encode_command)          │                  │
│        │  - DeviceInfoDTO JSON                │                  │
│        └─────────────────────────────────────┘                  │
│                              │                                   │
│                              │ 消费原始响应                      │
│        ┌─────────────────────────────────────┐                  │
│        │  RAW_KAFKA_TOPIC                     │                  │
│        │  (entrance_raw_data)                 │                  │
│        │  - DeviceInfoDTO (原始响应)          │                  │
│        └─────────────────────────────────────┘                  │
│                              ▲                                   │
│                              │                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  RawMessageListener                                      │  │
│  │  - 接收设备响应                                          │  │
│  │  - 从缓存获取请求信息                                    │  │
│  │  - 解码响应                                              │  │
│  │  - 应答队列 (AckPendingQueue.ack)                        │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ 发送解码后响应                    │
│                              ▼                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────────────────────┐
        │  DECODE_KAFKA_TOPIC                  │
        │  (entrance_decode_command)            │
        │  - DeviceInfoDTO (解码后响应)         │
        └─────────────────────────────────────┘
                              │
                              │ 消费
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        业务系统 (Entrance Service)                │
│                        接收响应                                  │
└─────────────────────────────────────────────────────────────────┘






┌─────────────────────────────────────────────────────────────────┐
│                      通信模组 (Gateway)                          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  消费 ENCODE_KAFKA_TOPIC                                  │  │
│  │  - 解析 DeviceInfoDTO                                     │  │
│  │  - 通过UDP/TCP/MQTT发送到设备                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ 设备响应                          │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  接收设备响应                                             │  │
│  │  - UDP/TCP: Netty Channel                                │  │
│  │  - MQTT: MQTT Client                                     │  │
│  │  - 发送到 RAW_KAFKA_TOPIC                                 │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
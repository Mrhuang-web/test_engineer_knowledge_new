# 01总结

```

```





# 02补充

```
其他说明：看wiki

1、服务打包：
	external（这个是最主要的），【这块主要是纯异步的，rbac，kafka】
		需要到116先打个包（具体怎么打包忘记了，需要问一下）
		再到cicd 需要先打全量 （GXgemc_all）,再打capacity
		

2、测试步骤：
	前置准备：
		国密3（加密）
			# 国密3算法其实是一种hash算法，类似md5，基本不可逆
			# 2E#iMr*3:119ab51ceea047eff8938a643438147b40b61aea0572daa16c7a955874306eab
			# wccQKPbCmx8@r*6p:8b2806493d026e11c35fa0427d782dca2520b6976a8bddc63ad2406924e89a99
			# 以下为加密：
			from gmssl import sm3
			body='wccQKPbCmx8@r*6p'
			msg_list = [i for i in bytes(body.encode('utf-8'))]
			digest = sm3.sm3_hash(msg_list)
			print(digest)
		
		
		
	【注意：这里接口传入密码是国密3加密之后的密码，登录使用明文登录即可】
	
	1、新增用户（先修改用户名，密码，手机号，邮箱）然后触发接口 - 需要修改cicd上external服务ip端口 - 登录4a和动环（正常要都能登录）
		curl --location 'http://10.188.99.5:21530/v1/yhzx/addAccount' \
		--header 'Content-Type: application/json' \
		--data-raw '[
			{
				"orgName": "广西网络运营中心动力设备维护室",
				"mail": "1224744444@2239.com",
				"gender": "0",
				"org": "1407980000000000000",
				"groupId": "1407980000000000000",
				"description": "测试新增用户",
				"type": "1",
				"head": "zhangji",
				"password": "119ab51ceea047eff8938a643438147b40b61aea0572daa16c7a955874306eab",
				"externalUserType": "TRUNDLE_EXTERNAL_USER_TYPE_6",
				"groupName": "区公司网络线普通员工",
				"name": "jianshengzhou",
				"idCardNumber": "MzcwMjExMTk4MTA2MTM4NzEx",
				"workOrderNumber": "GX-001-220609-00003",
				"tel": "15920369296",
				"startTime": "2020-12-11 13:10:00",
				"location": "TRUNDLE_CITY_GX_NN",
				"endTime": "2024-12-31 23:59:00",
				"provinceName": "TRUNDLE_PROVINCE_LOCAL",
				"account": "czwtest002",
				"status": "0"
			}
		]'
	
	
	2、更新用户（更具新增接口创建的用户，修改用户名，密码，手机号，邮箱情况）触发接口 - 再次登录4a和动环
		curl --location 'http://localhost:21530/v1/yhzx/updAccount' \
		--header 'Content-Type: application/json' \
		--data-raw 
		'{
			"orgName":"广西玉林网络运营中心动力维护室",
			"mail":"13507808081@139.com",
			"gender":"0","org":"1407981180871118872",
			"groupId":"1407981462610907145",
			"description":"",
			"type":"1",
			"head":"zhangji",
			"password":"346d24535fa71d47923ae7e7e2c94ba81b8c29a95c65f49743241de29b8c8d61",
			"externalUserType":"TRUNDLE_EXTERNAL_USER_TYPE_6",
			"groupName":"地市网络线普通员工",
			"insideTrumpet":"EOMS,MPH,IOM,GOMP,WNS,IRMS,NBMS,SPIDER",
			"name":"阮良杰",
			"idCardNumber":"Vm0xMFlWbFdWWGhUYmxKWFlURndUMVp0ZUdGV1JsbDNXa2M1VlUxV2NIbFdiWGhyVkRGS2MxTnNh\nRmRXTTFKb1dXdGFTMVpXU25OWApiRnBwVWpKb01sWnJaRFJaVmtwelYyNUdWZ3BXUkVFNQ==",
			"workOrderNumber":"GX-001-210810-00077",
			"tel":"Vm0xMFlWbFdWWGhWYmtwT1ZteHdUMVpzV21GWlZuQllaVVYwVlUxV1dubFhhMlF3VkdzeFYxSnFU\nbGRXTTFKb1ZsWmFWMVpWTVVWaAplakE5",
			"startTime":"2020-12-11 13:10:33",
			"location":"TRUNDLE_CITY_GX_YL",
			"endTime":"2025-12-31 23:59:59",
			"position":"TRUNDLE_DUTY_TYPE_YG",
			"provinceName":"TRUNDLE_PROVINCE_LOCAL",
			"account":"ruanliangjie",
			"status":"0"
		}'
		


3、测试方法：
	新增用户后，以及修改密码后，可以4A方式登录， 登录后可以查看姓名、手机号、邮箱
	动环系统中的“人员”、“账号”中均已添加数据
	删除人员可以使用接口，也可以直接在动环的人员、账号中进行手工删除



4、字段说明：
	tel手机号字段base64解密后入库
		包含新增用户和编辑用户接口， 收到包后，对4a_account_sync_log表中存在并同时存在于wb_user表中的用户进行base64手机号码更新
		已有存量用户数据批处理解密: curl --location http://10.1.4.226:21530/v1/yhzx/syncMobile
		base64加解密工具网站：https://zz.ittools.cc/base64-string-converter
		


5、补充说明【重点】：
	1.用户同步过来后初次登录可以同时使用两个密码（国密、初始）进行登录
	2.用户在4A登录页面登录过后，初始密码失效，不再能使用初始密码登录
	3.备注：初始化密码为：lSuXdaQd90U6N2B#
	
	主要涉及：主账号添加、主账号修改、主账号删除
	字段很多，有效的同步字段为：邮箱，电话，性别，密码
		采用国密加密，我方存储在ldap中的是通过标准md5/sha方式对已通过国密加密的串再加密后的串
	密码本身不可逆， 所以最终登录验证方式，是比对
		邮箱、电话均采用原始串（对方post过来的包是加密过的，我方未解密
		接口纯异步，通过external服务，写kafka，由rbac消费，所以返回包基本上是成功， 需要查日志  【重点】
		
	


6、涉及表：
	4a_account_sync_log  --> 新增成功就会入库到4a用户帐表中
```


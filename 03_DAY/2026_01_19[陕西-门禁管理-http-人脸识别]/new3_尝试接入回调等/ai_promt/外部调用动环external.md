\# 机房出入流程对接门禁管理系统需求与接口文档 ## 一、总体需求概述 ### 1.1 背景情况 机房出入管理流程未与门禁系统对接，需对接动环工作台实现人脸开门，达成流程管控目标。 ### 1.2 需求目标 - 基础目标：将机房出入管理流程现场登记环节的人员信息推送给动环平台，动环平台返回人脸门禁写入成功或失败信息。 - 扩展目标（v3.0新增）：支持动环平台通过接口调用推送门禁开启信息及底层人脸操作结果同步信息。 ### 1.3 使用描述 | 用户情况 | 实际岗位 | 职责 | |----------|----------|------| | 全省机房维护人员 | 全省机房维护 | 全省机房维护 | - 应用场景：机房出入运维场景 - 应用频次：每天多次 ## 二、接口文档规则和逻辑 ### 2.1 接口通用规则 - 传输协议：HTTPS（部分接口测试/正式环境明确指定） - 请求方法：均为POST - 字符编码：UTF-8（v1.0明确指定） - 响应格式：统一返回code（返回编码）、desc（返回描述）、data（业务数据信封），其中code=00表示成功，21为接口异常，22为安全校验不通过，23为请求参数错误 ### 2.2 具体接口详情 #### 2.2.1 推送工单及人脸照片接口（v3.0新增，运维平台→动环平台） - 接口用途：向动环平台传入人脸工单信息 - 请求URL：http://{serverRoot}/v1/external/ywgl/addFace - 请求参数（form-data格式）： | 字段名 | 类型 | 必填 | 示例值 | 描述 | |--------|------|------|--------|------| | data | Object | 是 | - | 数据容器 | | workOrdNum | String | 是 | JF-20251222-0313 | 工单号 | | name | String | 是 | 唐建峰 | 姓名 | | account | String | 是 | tangjianfeng | 账号 | | phone | String | 是 | 13800001111 | 联系方式 | | city | String | 是 | 咸阳市 | 城市 | | site | List<String> | 是 | ["安康白河庆华化工厂站点"] | 站点名称列表 | | room | List<String> | 是 | ["咸阳秦都应急楼一楼综合机房"] | 进入机房名称列表 | | deviceId | List<String> | 是 | ["20231201996901"] | 门禁设备ID列表 | | picture | String | 是 | 单张图片的base64字符串 | 人脸照片 | | startDate | String | 是 | 2025-12-26 | 登记时间（格式：YYYY-MM-DD） | - 请求示例： ```json {  "data": {    "workOrdNum": "JF-20251222-0313",    "name": "唐建峰",    "account": "tangjianfeng",    "phone": "13800001111",    "city": "咸阳市",    "site": ["安康白河庆华化工厂站点"],    "room": ["咸阳秦都应急楼一楼综合机房"],    "deviceId": ["20231201996901"],    "picture": "单张图片的base64字符串",    "startDate": "2025-12-26"  } } ``` - 响应示例： ```json {  "code": "00",  "desc": "成功",  "data": "" } ``` #### 2.2.2 接收门禁开启信息接口（v3.0新增，动环平台→运维平台） - 接口用途：动环平台向运维中心推送门禁开启信息 - 请求URL：  - 测试环境：https://10.206.158.133:8443/mtex/webservice/machine/roomDoor/openDoorReceive  - 正式环境：https://10.206.158.57:8443/mtex/webservice/machine/roomDoor/openDoorReceive - 请求参数： | 字段名 | 类型 | 必填 | 示例值 | 描述 | |--------|------|------|--------|------| | workOrdNum | String | 否 | JF-20251222-0313 | 工单号 | | name | String | 否 | 唐建峰 | 人员姓名 | | account | String | 否 | dwtangjianfeng | 账号 | | phone | String | 否 | 13800001111 | 联系方式 | | city | String | 是 | 咸阳市 | 地市 | | site | String | 是 | 安康白河庆华化工厂站点 | 站点名称 | | room | String | 是 | 咸阳秦都应急楼一楼综合机房 | 机房名称 | | deviceId | String | 是 | D20251222001 | 门禁设备ID | | dailyOpenTime | String | 是 | 2025-12-26 10:38:01 | 开门时间（格式：YYYY-MM-DD HH:MM:SS） | - 请求示例： ```json {  "workOrdNum": "JF-20251222-0313",  "name": "唐建峰",  "account": "dwtangjianfeng",  "phone": "13800001111",  "city": "咸阳市",  "site": "安康白河庆华化工厂站点",  "room": "咸阳秦都应急楼一楼综合机房",  "deviceId": "D20251222001",  "dailyOpenTime": "2025-12-26 10:38:01" } ``` - 响应示例： ```json {  "code": "00",  "desc": "成功",  "data": "" } ``` #### 2.2.3 底层人脸操作结果同步接口（v3.0新增，动环平台→运维平台） - 接口用途：动环平台向运维中心同步底层人脸操作结果信息 - 请求URL：  - 测试环境：https://10.206.158.133:8443/mtex/webservice/machine/roomDoor/faceOperationResult  - 正式环境：https://10.206.158.57:8443/mtex/webservice/machine/roomDoor/faceOperationResult - 请求参数： | 字段名 | 类型 | 必填 | 示例值 | 描述 | |--------|------|------|--------|------| | workOrdNum | String | 是 | JF-20251222-0313 | 工单号 | | name | String | 是 | 唐建峰 | 人员姓名 | | account | String | 是 | dwtangjianfeng | 账号 | | phone | String | 是 | 13800001111 | 联系方式 | | city | String | 是 | 咸阳市 | 地市 | | site | String | 是 | 安康白河庆华化工厂站点 | 站点名称 | | room | String | 是 | 咸阳秦都应急楼一楼综合机房 | 机房名称 | | deviceId | String | 是 | ACC2025122001 | 门禁设备ID | | faceWriteResult | String | 是 | 成功 | 人脸写入结果 | - 请求示例： ```json {  "workOrdNum": "JF-20251222-0313",  "name": "唐建峰",  "account": "dwtangjianfeng",  "phone": "13800001111",  "city": "咸阳市",  "site": "安康白河庆华化工厂站点",  "room": "咸阳秦都应急楼一楼综合机房",  "deviceId": "ACC2025122001",  "faceWriteResult": "成功" } ``` - 响应示例： ```json {  "code": "00",  "desc": "成功",  "data": "" } ``` - 接口逻辑：  1. 若底层返回人脸写入失败，动环平台通过该接口同步失败信息，运维中心5分钟后重新调用“推送工单及人脸照片接口”推送信息；  2. 若底层无返回结果（成功/失败），或返回成功但实际不生效，运维中心10分钟后重新调用“推送工单及人脸照片接口”推送信息。 #### 2.2.4 v1.0基础接口（兼容说明） - 接口用途：推送给动环系统机房现场登记人员相关数据 - 接口信息：  - 接口地址：待补充  - 请求方法：POST  - 传输协议：HTTPS  - 数据格式：form-data  - 字符编码：UTF-8  - 接口版本：v1.0 - 核心必填参数： | 字段名 | 类型 | 必填 | 示例值 | 描述 | 所属父级数组 | |--------|------|------|--------|------|--------------| | orderNo | String | 是 | JF-20251222-0313 | 工单号 | - | | registerTime | String | 是 | 2025-12-26 10:38:01 | 登记时间（格式：YYYY-MM-DD HH:MM:SS） | - | | city | String | 是 | 咸阳市 | 机房所在城市 | - | | enterRoomName | String | 是 | 咸阳秦都应急楼一楼综合机房 | 进入机房资源名称 | roomRelation | | operatorInfo | String | 是 | 唐建峰 | 作业人员姓名 | operatorRelation | | contact (作业) | String | 是 | 13800001111 | 作业人员联系方式 | operatorRelation | | operatorFace | File | 是 | - | 作业人员人脸照片 | operatorRelation | | escortInfo | String | 是 | 牛航 | 随工或监理姓名 | escortRelation | | contact (随工) | String | 是 | 13700003333 | 随工或监理联系方式 | escortRelation | | escortFace | File | 是 | - | 随工或监理人脸照片 | escortRelation | ## 三、核心需求说明 实现机房出入管理流程的现场登记环节工单及人员信息推送至动环平台，并接收动环平台返回的人脸门禁写入结果、门禁开启信息及底层人脸操作结果反馈。 ## 四、上线标准 【详细说明】XXX
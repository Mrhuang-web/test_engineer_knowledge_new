\# 机房出入流程对接门禁管理系统需求与接口协议文档（整合v1.0与v3.0） ## 一、总体需求概述 ### 1.1 背景情况 机房出入管理流程未与门禁系统进行对接，需对接动环工作台实现人脸开门，从而实现流程管控。 ### 1.2 需求目标 - 核心目标：将机房出入管理流程现场登记环节的人员信息推送给动环平台，动环平台返回人脸门禁写入成功或失败信息。 - 扩展目标（v3.0新增）：支持动环平台通过接口调用推送门禁开启信息及底层人脸操作结果同步信息。 ### 1.3 使用描述 | 用户情况 | 实际岗位 | 职责 | |----------|----------|------| | 全省机房维护人员 | 全省机房维护 | 全省机房维护 | - 应用场景：机房出入运维场景 - 应用频次：每天多次 ## 二、接口协议结构 | 接口名称 | 接口方向 | 功能描述 | 版本支持 | |----------|----------|----------|----------| | 推送工单及人脸照片接口 | 运维平台 → 动环平台 | 向动环系统传入人脸工单信息（含人员信息、人脸照片、机房相关信息等） | v1.0、v3.0 | | 接收门禁开启信息接口 | 动环平台 → 运维平台 | 动环向运维中心推送门禁开启详细信息 | v3.0新增 | | 底层人脸操作结果同步接口 | 动环平台 → 运维平台 | 动环向运维中心同步底层人脸写入操作的成功/失败结果 | v3.0新增 | ## 三、各接口详细说明（请求+响应） ### 3.1 推送工单及人脸照片接口 #### 3.1.1 基础信息 - 接口地址（v3.0明确）：http://{serverRoot}/v1/external/ywgl/addFace - 请求方法：POST - 传输协议（v1.0明确）：HTTPS - 数据格式（v1.0明确）：form-data - 字符编码（v1.0明确）：UTF-8 - 接口版本：v1.0（基础）、v3.0（优化） #### 3.1.2 请求参数 | 字段名 | 类型 | 必填 | 示例值 | 描述 | 所属父级（v1.0） | 版本说明 | |--------|------|------|--------|------|------------------|----------| | orderNo/workOrdNum | String | 是 | JF-20251222-0313 | 工单号（v3.0统一字段名为workOrdNum） | - | v1.0字段名orderNo，v3.0优化为workOrdNum | | registerTime/startDate | String | 是 | 2025-12-26 10:38:01 / 2025-12-26 | 登记时间（v1.0含时分秒，v3.0仅日期） | - | v1.0格式YYYY-MM-DD HH:MM:SS，v3.0格式YYYY-MM-DD | | city | String | 是 | 咸阳市 | 机房所在城市/地市 | - | 两版本一致 | | siteCode | String | 否 | SITE-359931bfae141528ee7cc7821f781c2 | 机房所属站点资源编码 | siteRelation（v1.0） | 仅v1.0存在 | | site | String/List<String> | 否/是 | 安康白河庆华化工厂站点 | 机房所属站点资源名称/站点名称列表 | siteRelation（v1.0） | v1.0为单个字符串（非必填），v3.0为列表（必填） | | roomCode（站点） | String | 否 | ROOM-fed780868bec4168a625e88231fdd061 | 站点关联的机房资源编码 | siteRelation（v1.0） | 仅v1.0存在 | | roomCode | String | 否 | ROOM-fed780868bec4168a625e88231fdd065 | 机房资源编码 | roomRelation（v1.0） | 仅v1.0存在 | | enterRoomName/room | String/List<String> | 是 | 咸阳秦都应急楼一楼综合机房 | 进入机房资源名称/进入机房名称列表 | roomRelation（v1.0） | v1.0为单个字符串，v3.0为列表 | | operatorInfo/name | String | 是 | 唐建峰 | 作业人员姓名/人员姓名 | operatorRelation（v1.0） | v1.0字段名operatorInfo，v3.0优化为name | | contact (作业)/phone | String | 是 | 13800001111 | 作业人员联系方式/联系方式 | operatorRelation（v1.0） | v1.0字段名contact (作业)，v3.0优化为phone | | operatorFace/picture | File/String | 是 | / 单张图片的base64字符串 | 作业人员人脸照片 | operatorRelation（v1.0） | v1.0为File类型，v3.0为base64字符串 | | escortInfo | String | 是 | 牛航 | 随工或监理姓名 | escortRelation（v1.0） | 仅v1.0存在 | | contact (随工) | String | 是 | 13700003333 | 随工或监理联系方式 | escortRelation（v1.0） | 仅v1.0存在 | | escortFace | File | 是 |  | 随工或监理人脸照片 | escortRelation（v1.0） | 仅v1.0存在 | | account | String | 是 | tangjianfeng | 账号 | - | 仅v3.0新增 | | deviceId | List<String> | 是 | ["20231201996901"] | 门禁设备ID列表 | - | 仅v3.0新增 | #### 3.1.3 请求示例（v3.0） ```json {  "data": {    "workOrdNum": "JF-20251222-0313",    "name": "唐建峰",    "account": "tangjianfeng",    "phone": "13800001111",    "city": "咸阳市",    "site": ["安康白河庆华化工厂站点"],    "room": ["咸阳秦都应急楼一楼综合机房"],    "deviceId": ["20231201996901"],    "picture": "单张图片的base64字符串",    "startDate": "2025-12-26"  } } ``` #### 3.1.4 响应参数 | 序号 | 元素名称 | 约束 | 类型 | 宽度 | 描述 | |------|----------|------|------|------|------| | 1    | code | 必选 | String | 2 | 返回编码：00成功、21接口异常、22接口安全校验不通过、23接口请求参数错误 | | 2    | desc | 必选 | String | 128 | 返回描述 | | 3    | data | 可选 | Object | - | 返回业务数据的数据信封 | #### 3.1.5 响应示例 ```json {  "code": "00",  "desc": "成功",  "data": "" } ``` ### 3.2 接收门禁开启信息接口（v3.0新增） #### 3.2.1 基础信息 - 接口地址：  - 测试环境：https://10.206.158.133:8443/mtex/webservice/machine/roomDoor/openDoorReceive  - 正式环境：https://10.206.158.57:8443/mtex/webservice/machine/roomDoor/openDoorReceive - 请求方法：POST #### 3.2.2 请求参数 | 字段名 | 类型 | 必填 | 示例值 | 描述 | |--------|------|------|--------|------| | workOrdNum | String | 否 | JF-20251222-0313 | 工单号 | | name | String | 否 | 唐建峰 | 人员姓名 | | account | String | 否 | dwtangjianfeng | 账号 | | phone | String | 否 | 13800001111 | 联系方式 | | city | String | 是 | 咸阳市 | 地市 | | site | String | 是 | 安康白河庆华化工厂站点 | 站点名称 | | room | String | 是 | 咸阳秦都应急楼一楼综合机房 | 机房名称 | | deviceId | String | 是 | D20251222001 | 门禁设备ID | | dailyOpenTime | String | 是 | 2025-12-26 10:38:01 | 开门时间（格式：YYYY-MM-DD HH:MM:SS） | #### 3.2.3 请求示例 ```json {  "workOrdNum": "JF-20251222-0313",  "name": "唐建峰",  "account": "dwtangjianfeng",  "phone": "13800001111",  "city": "咸阳市",  "site": "安康白河庆华化工厂站点",  "room": "咸阳秦都应急楼一楼综合机房",  "deviceId": "D20251222001",  "dailyOpenTime": "2025-12-26 10:38:01" } ``` #### 3.2.4 响应参数 | 序号 | 元素名称 | 约束 | 类型 | 宽度 | 描述 | |------|----------|------|------|------|------| | 1    | code | 必选 | String | 2 | 返回编码：00成功、21接口异常、22接口安全校验不通过、23接口请求参数错误 | | 2    | desc | 必选 | String | 128 | 返回描述 | | 3    | data | 可选 | Object | - | 返回业务数据的数据信封 | #### 3.2.5 响应示例 ```json {  "code": "00",  "desc": "成功",  "data": "" } ``` ### 3.3 底层人脸操作结果同步接口（v3.0新增） #### 3.3.1 基础信息 - 接口地址：  - 测试环境：https://10.206.158.133:8443/mtex/webservice/machine/roomDoor/faceOperationResult  - 正式环境：https://10.206.158.57:8443/mtex/webservice/machine/roomDoor/faceOperationResult - 请求方法：POST #### 3.3.2 接口说明 推送最终人脸门禁写入成功/失败应答的结果信息，重试规则如下： 1. 底层返回失败：动环通过该接口同步失败信息给运维中心，5分钟后运维中心再次触发「推送工单及人脸照片接口」推送信息。 2. 底层无返回结果或返回成功但实际不生效：10分钟后运维中心尝试再次通过「推送工单及人脸照片接口」推送信息。 #### 3.3.3 请求参数 | 字段名 | 类型 | 必填 | 示例值 | 描述 | |--------|------|------|--------|------| | workOrdNum | String | 是 | JF-20251222-0313 | 工单号 | | name | String | 是 | 唐建峰 | 人员姓名 | | account | String | 是 | dwtangjianfeng | 账号 | | phone | String | 是 | 13800001111 | 联系方式 | | city | String | 是 | 咸阳市 | 地市 | | site | String | 是 | 安康白河庆华化工厂站点 | 站点名称 | | room | String | 是 | 咸阳秦都应急楼一楼综合机房 | 机房名称 | | deviceId | String | 是 | ACC2025122001 | 门禁设备ID | | faceWriteResult | String | 是 | 成功 | 人脸写入结果 | #### 3.3.4 请求示例 ```json {  "workOrdNum": "JF-20251222-0313",  "name": "唐建峰",  "account": "dwtangjianfeng",  "phone": "13800001111",  "city": "咸阳市",  "site": "安康白河庆华化工厂站点",  "room": "咸阳秦都应急楼一楼综合机房",  "deviceId": "ACC2025122001",  "faceWriteResult": "成功" } ``` #### 3.3.5 响应参数 | 序号 | 元素名称 | 约束 | 类型 | 宽度 | 描述 | |------|----------|------|------|------|------| | 1    | code | 必选 | String | 2 | 返回编码：00成功、21接口异常、22接口安全校验不通过、23接口请求参数错误 | | 2    | desc | 必选 | String | 128 | 返回描述 | | 3    | data | 可选 | Object | - | 返回业务数据的数据信封 | #### 3.3.6 响应示例 ```json {  "code": "00",  "desc": "成功",  "data": "" } ``` ## 四、核心需求说明 1. 数据推送：实现机房出入管理流程现场登记环节的工单及人员信息（含人脸照片）推送至动环平台。 2. 结果反馈：接收动环平台返回的人脸门禁写入成功/失败信息。 3. 信息同步（v3.0新增）：接收动环平台推送的门禁开启信息及底层人脸操作结果同步信息。 4. 重试机制（v3.0新增）：根据人脸操作结果触发对应的接口重试逻辑，确保数据推送有效性。 ## 五、上线标准 【详细说明】XXX（原文档未明确具体内容）
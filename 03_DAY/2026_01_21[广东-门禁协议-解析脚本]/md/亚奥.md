\# 江苏亚奥科技股份有限公司门禁通讯协议 > 公司内部绝密资料，严禁外泄、严禁复制 ## 一、协议格式 ### 1. 数据帧结构 | 字段       | 字节数 | 说明                                                                 | |------------|--------|----------------------------------------------------------------------| | 包头       | 1字节  | 固定值：55H                                                          | | 地址       | 1字节  | 取值范围0-255（部分设备地址跳线仅支持部分地址空间）                   | | 长度       | 1字节  | 数据包的字节数，最大255字节                                          | | 数据包     | 可变   | 最大255字节，由命令（1字节）+ 参数/数据组成                          | | 校验和     | 1字节  | 数据包所有字节的累加和                                               | | 包尾       | 1字节  | 固定值：AAH                                                          | **示例**：55,7F,02,03,00,03,AA - 55：包头 - 7F：地址 - 02：长度（数据包共2字节：03+00） - 03：命令 - 00：命令参数 - 03：校验和（03+00=03） - AA：包尾 ### 2. 通信接口参数 - 接口类型：RS485 - 波特率：9600 - 起始位：1位 - 数据位：8位 - 停止位：1位 - 校验方式：无校验 ## 二、协议命令详情 ### 1. 上报组信息（命令字：01H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(01H) + 校验(01H) + AAH` #### 响应格式 `55H + 地址 + 长度(09H) + 命令字(01H) + 组类型(8字节) + 校验 + AAH` #### 功能 上报设备的组信息，组类型从0-7依次上报（每组1字节） #### 组类型定义 | 类型标识 | 含义 | |----------|------| | 02H      | AI组 | | 04H      | DI组 | | 06H      | DO组 | | FFH      | 空组 | #### 门禁组定义 当前门禁固定为3组：AI一组、DI一组、DO一组 ### 2. 上报门禁运行数据（命令字：02H） #### 命令格式 `55H + 地址 + 长度 + 命令字(02H) + 板识别字(1字节) + 数据 + ... + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度 + 命令字(02H) + 板识别字(1字节) + 数据 + 校验 + AAH` #### 功能 上报各个通道的实时运行数据 #### 板识别字说明 - 高4位：组号（0-7） - 低4位：组类型（AI=02H，DI=04H，DO=06H） - 示例：24H 表示第3号组为DI组（高4位0010=2→组号3，低4位0100=4→DI类型） #### 数据格式 ##### AI组数据 - 字节数：16字节（8个通道×2字节/通道，低字节在前，高字节在后） - 数据类型：带符号BCD码 - 通道定义：  - 0-6号通道：门状态（当前仅支持2个门，其余通道无效）    | 状态值 | 含义       |    |--------|------------|    | 00H    | 门关       |    | 01H    | 刷卡开门   |    | 02H    | 中心遥控开门 |    | 03H    | 门内开门   |    | 04H    | 非正常开门 |  - 7号通道：未上报的新记录个数 ##### DI组数据 - 字节数：1字节（8路数字输入，每bit对应1个通道） - 通道定义（bit0-bit7依次对应0-7号通道）：  | 通道号 | 设备名称       | 状态定义       |  |--------|----------------|----------------|  | 0      | 1号红外        | 0=告警，1=正常 |  | 1      | 2号红外        | 0=告警，1=正常 |  | 2      | 1号出门按钮    | 0=按下，1=未按 |  | 3      | 2号出门按钮    | 0=按下，1=未按 |  | 4      | 1号门磁        | 0=门关，1=门开 |  | 5      | 2号门磁        | 0=门关，1=门开 |  | 6-7    | 预留通道       | 无效           | - 说明：仅红外状态需上位机处理，出门按钮和门磁由控制器自主处理 ##### DO组数据 - 字节数：1字节（8路数字输出，每bit对应1个通道） - 通道定义：  - 0-1号通道：门锁控制（1=打开，0=合上）  - 2-7号通道：预留通道（无效） - 说明：上位机一般无需干预 ### 3. 远程开门控制（命令字：03H） #### 命令格式 `55H + 地址 + 长度(04H) + 命令字(03H) + 组号 + 通道号 + 动作类型 + 校验 + AAH` #### 功能 远程控制指定门开启 #### 参数说明 | 参数       | 取值范围 | 说明                     | |------------|----------|--------------------------| | 组号       | 02H      | 固定为DO组               | | 通道号     | 0-1      | 对应2个门（0=1号门，1=2号门） | | 动作类型   | 01H      | 仅支持开门操作           | #### 说明 一次只能控制一个门开启 ### 4. 查询时间（命令字：09H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(09H) + 校验(09H) + AAH` #### 功能 查询门禁控制器的实时时间 #### 时间格式（16进制表示） | 序号 | 字段 | 范围     | 字节数 | 说明               | |------|------|----------|--------|--------------------| | 1    | 年   | 2000-9999 | 2      | 低字节在前         | | 2    | 月   | 1-12     | 1      |                    | | 3    | 日   | 1-31     | 1      |                    | | 4    | 时   | 0-23     | 1      |                    | | 5    | 分   | 0-59     | 1      |                    | | 6    | 秒   | 0-59     | 1      |                    | #### 说明 控制器内置不掉电实时时钟 ### 5. 设置时间（命令字：10H） #### 命令格式 `55H + 地址 + 长度(08H) + 命令字(10H) + 时间(7字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(08H) + 命令字(10H) + 时间(7字节) + 校验 + AAH` #### 功能 设置门禁控制器的系统时间 #### 时间格式 同4.4节查询时间的格式 ### 6. 发长期卡（命令字：11H） #### 命令格式 `55H + 地址 + 长度(05H) + 命令字(11H) + 卡号(4字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(11H) + 结果(1字节) + 卡号(4字节) + 校验 + AAH` #### 功能 发放长期有效门禁卡（无有效期限制） #### 参数说明 | 参数 | 格式要求                                  | 说明                     | |------|-------------------------------------------|--------------------------| | 卡号 | 32位16进制数，Intel格式（低字节在前）     | 不足32位高位补0         | | 结果 | 0=发卡失败，1=发卡成功（响应中返回）      |                          | #### 说明 - 不可写卡由厂商保证唯一性，可写卡由发卡程序保证唯一性 ### 7. 删除长期卡（命令字：12H） #### 命令格式 `55H + 地址 + 长度(05H) + 命令字(12H) + 卡号(4字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(12H) + 结果(1字节) + 卡号(4字节) + 校验 + AAH` #### 功能 删除指定的长期卡 #### 参数说明 | 参数 | 格式要求                                  | 说明                     | |------|-------------------------------------------|--------------------------| | 卡号 | 32位16进制数，Intel格式（低字节在前）     | 需与发卡时一致           | | 结果 | 0=删除失败，1=删除成功（响应中返回）      |                          | ### 8. 发短期卡（命令字：13H） #### 命令格式 `55H + 地址 + 长度(0DH) + 命令字(13H) + 卡号(4字节) + 有效期(8字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(13H) + 结果(1字节) + 卡号(4字节) + 校验 + AAH` #### 功能 发放有有效期限制的门禁卡 #### 参数说明 | 参数     | 格式要求                                  | 说明                     | |----------|-------------------------------------------|--------------------------| | 卡号     | 32位16进制数，Intel格式（低字节在前）     | 不足32位高位补0         | | 有效期   | 16进制表示（8字节）                       | 含开始时间和结束时间     | | 结果     | 0=发卡失败，1=发卡成功（响应中返回）      |                          | #### 有效期格式 | 序号 | 字段   | 范围     | 字节数 | 说明               | |------|--------|----------|--------|--------------------| | 1    | 开始年 | 2000-9999 | 2      | 低字节在前         | | 2    | 开始月 | 1-12     | 1      |                    | | 3    | 开始日 | 1-31     | 1      |                    | | 4    | 结束年 | 2000-9999 | 2      | 低字节在前         | | 5    | 结束月 | 1-12     | 1      |                    | | 6    | 结束日 | 1-31     | 1      |                    | ### 9. 删除短期卡（命令字：14H） #### 命令格式 `55H + 地址 + 长度(05H) + 命令字(14H) + 卡号(4字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(14H) + 结果(1字节) + 保留(4字节) + 校验 + AAH` #### 功能 删除指定的短期卡 #### 参数说明 | 参数 | 格式要求                                  | 说明                     | |------|-------------------------------------------|--------------------------| | 卡号 | 32位16进制数，Intel格式（低字节在前）     | 需与发卡时一致           | | 结果 | 0=删除失败，1=删除成功（响应中返回）      |                          | ### 10. 删除所有长期卡（命令字：15H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(15H) + 校验(15H) + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(15H) + 结果(1字节) + 保留(4字节) + 校验 + AAH` #### 功能 批量删除所有已发放的长期卡 #### 结果说明 | 结果值 | 含义       | |--------|------------| | 0      | 删除失败   | | 1      | 删除成功   | ### 11. 删除所有短期卡（命令字：16H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(16H) + 校验(16H) + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(16H) + 结果(1字节) + 保留(4字节) + 校验 + AAH` #### 功能 批量删除所有已发放的短期卡 #### 结果说明 | 结果值 | 含义       | |--------|------------| | 0      | 删除失败   | | 1      | 删除成功   | ### 12. 删除所有卡（命令字：17H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(17H) + 校验(17H) + AAH` #### 响应格式 `55H + 地址 + 长度(06H) + 命令字(17H) + 结果(1字节) + 保留(4字节) + 校验 + AAH` #### 功能 删除所有长期卡和短期卡 #### 结果说明 | 结果值 | 含义       | |--------|------------| | 0      | 删除失败   | | 1      | 删除成功   | ### 13. 删除所有开门记录（命令字：18H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(18H) + 校验(18H) + AAH` #### 响应格式 `55H + 地址 + 长度(0BH) + 命令字(18H) + 结果(1字节) + 卡序号(2字节) + 校验 + AAH` #### 功能 删除门禁控制器中所有开门记录 #### 结果说明 | 结果值 | 含义       | |--------|------------| | 0      | 删除失败   | | 1      | 删除成功   | ### 14. 查询参数（命令字：21H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(21H) + 校验(21H) + AAH` #### 响应格式 `55H + 地址 + 长度(0AH) + 命令字(21H) + 参数(10字节) + 校验 + AAH` #### 功能 查询门禁系统的关键参数信息 #### 参数格式（16进制，低字节在前） | 序号 | 参数名称       | 范围     | 字节数 | 说明                     | |------|----------------|----------|--------|--------------------------| | 1    | 最新记录位置   | 0-1499   | 2      | 当前最新开门记录的序号   | | 2    | 当前有效记录数 | 0-1500   | 2      | 总有效开门记录个数       | | 3    | 未读记录数     | 0-1500   | 2      | 未上报的开门记录个数     | | 4    | 长期卡数       | 0-1024   | 2      | 有效长期卡的个数         | | 5    | 短期卡数       | 0-500    | 2      | 有效短期卡的个数         | ### 15. 取长期卡（命令字：22H） #### 命令格式 `55H + 地址 + 长度(03H) + 命令字(22H) + 序号(2字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(0BH) + 命令字(22H) + 结果(1字节) + 卡序号(2字节) + 新序号(2字节) + 卡号(4字节) + 校验 + AAH` #### 功能 按序号读取有效长期卡信息 #### 参数说明 | 参数     | 取值范围 | 说明                     | |----------|----------|--------------------------| | 序号     | 0-1023   | 欲查询的卡序号           | | 卡序号   | -        | 当前读取卡的实际序号     | | 新序号   | -        | 下一个有效卡序号（-1表示无后续） | | 卡号     | 32位16进制 | 卡片唯一标识             | #### 结果说明 | 结果值 | 含义                     | |--------|--------------------------| | 0      | 取卡失败                 | | 1      | 取卡成功，无后续卡       | | 2      | 取卡成功，有后续卡       | #### 说明 采用First-Next方式读取，从指定序号开始读取第一个有效卡及下一个有效卡序号 ### 16. 取短期卡（命令字：23H） #### 命令格式 `55H + 地址 + 长度(03H) + 命令字(23H) + 序号(2字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(13H) + 命令字(23H) + 结果(1字节) + 卡序号(2字节) + 新序号(2字节) + 卡号(4字节) + 保留(1字节) + 有效期(8字节) + 校验 + AAH` #### 功能 按序号读取有效短期卡信息 #### 参数说明 | 参数     | 取值范围 | 说明                     | |----------|----------|--------------------------| | 序号     | 0-499    | 欲查询的卡序号           | | 卡序号   | -        | 当前读取卡的实际序号     | | 新序号   | -        | 下一个有效卡序号（-1表示无后续） | | 卡号     | 32位16进制 | 卡片唯一标识             | | 有效期   | 8字节    | 同13H命令的有效期格式    | #### 结果说明 | 结果值 | 含义                     | |--------|--------------------------| | 0      | 取卡失败                 | | 1      | 取卡成功，无后续卡       | | 2      | 取卡成功，有后续卡       | #### 说明 采用First-Next方式读取，从指定序号开始读取第一个有效卡及下一个有效卡序号 ### 17. 取开门记录（命令字：26H） #### 命令格式 `55H + 地址 + 长度(03H) + 命令字(26H) + 序号(2字节) + 校验 + AAH` #### 响应格式 `55H + 地址 + 长度(14H) + 命令字(26H) + 结果(1字节) + 记录序号(2字节) + 新记录序号(2字节) + 卡号(4字节) + 记录原因(1字节) + 时间(7字节) + 门序号(1字节) + 保留(1字节) + 校验 + AAH` #### 功能 按序号读取开门记录信息 #### 参数说明 | 参数         | 取值范围 | 说明                     | |--------------|----------|--------------------------| | 序号         | 0-1499   | 欲查询的记录序号         | | 记录序号     | -        | 当前读取记录的实际序号   | | 新记录序号   | -        | 下一个有效记录序号（-1表示无后续） | | 卡号         | 32位16进制 | 开门用卡号（全0表示非刷卡开门） | | 门序号       | 0-1      | 发生操作的门序号         | | 时间         | 7字节    | 记录发生时间（同09H命令格式） | #### 记录原因格式（1字节） | 位段       | 含义                     | 取值说明                 | |------------|--------------------------|--------------------------| | D7-D5      | 保留（3BIT）             | 固定为0                  | | D4         | 门状态（1BIT）           | 0=门关，1=门开           | | D3-D0      | 记录状态（低4位）        | 1=刷卡开门，2=中心遥控开门，3=门内按钮开门，4=非正常开门 | #### 结果说明 | 结果值 | 含义                     | |--------|--------------------------| | 0      | 取记录失败               | | 1      | 取记录成功，无后续记录   | | 2      | 取记录成功，有后续记录   | #### 说明 采用First-Next方式读取，从指定序号开始读取第一个有效记录及下一个有效记录序号 ### 18. 取新开门记录（命令字：27H） #### 命令格式 `55H + 地址 + 长度(01H) + 命令字(27H) + 校验(27H) + AAH` #### 响应格式 `55H + 地址 + 长度(14H) + 命令字(27H) + 结果(1字节) + 记录序号(2字节) + 新记录序号(2字节) + 卡号(4字节) + 记录原因(1字节) + 时间(7字节) + 门序号(1字节) + 保留(1字节) + 校验 + AAH` #### 功能 读取未上报的新开门记录 #### 参数说明 同26H命令（取开门记录） #### 结果说明 同26H命令（取开门记录） #### 说明 采用先入先出（FIFO）方式读取，每次返回最早的一条新记录及下一条记录序号